# 火鸟门户权限配置指南

## 🎯 问题诊断结果

基于权限诊断脚本的结果，发现以下关键问题：

### ❌ 主要问题
1. **发布接口会话立即过期** - 表明权限验证机制特殊
2. **系统中无基础数据** - 0个分类，0篇文章
3. **写入权限受限** - 读取正常，写入失败

### ✅ 正常功能
1. **认证机制正常** - 自动登录成功
2. **基础读取权限** - 系统配置、分类列表、文章列表可读取
3. **会话管理** - 能够检测和处理会话过期

## 🔧 具体解决步骤

### 第一步：检查用户权限配置

基于你提供的后台截图，需要在火鸟门户后台进行以下检查：

#### 1.1 进入用户管理
```
路径：火鸟门户后台 → 用户 → 资讯管理
当前页面显示：资讯分类、资讯设置、资讯内容等选项
```

#### 1.2 检查admin用户权限
```sql
-- 如果有数据库访问权限，可以检查：
SELECT * FROM admin_users WHERE username = 'admin';
SELECT * FROM admin_roles WHERE user_id = (SELECT id FROM admin_users WHERE username = 'admin');
```

#### 1.3 确认必需权限
确保admin用户具有以下权限：
- [ ] 资讯管理权限
- [ ] 资讯分类管理
- [ ] 资讯内容发布
- [ ] API接口调用权限

### 第二步：创建基础分类

从截图可以看到"资讯分类"选项，需要：

#### 2.1 手动创建分类
1. 点击"资讯分类"
2. 添加基础分类：
   - ID: 1, 名称: "科技资讯"
   - ID: 2, 名称: "本地新闻"  
   - ID: 3, 名称: "社区动态"

#### 2.2 验证分类创建
```bash
# 运行验证脚本
node scripts/firebird-setup-basic-data.js
```

### 第三步：系统设置检查

#### 3.1 API接口设置
检查是否有以下设置：
- [ ] API接口是否启用
- [ ] 是否需要API密钥
- [ ] IP白名单限制
- [ ] CSRF保护设置

#### 3.2 发布设置
- [ ] 内容发布功能是否开启
- [ ] 审核流程设置
- [ ] 默认发布状态

### 第四步：权限测试

#### 4.1 运行完整诊断
```bash
FIREBIRD_ADMIN_USERNAME=admin FIREBIRD_ADMIN_PASSWORD=admin node scripts/firebird-permission-diagnostics.js
```

#### 4.2 测试发布功能
```bash
FIREBIRD_ADMIN_USERNAME=admin FIREBIRD_ADMIN_PASSWORD=admin node scripts/firebird-setup-basic-data.js
```

## 🔍 深度排查方案

### 方案1：浏览器网络监控

1. **手动发布测试**：
   - 在后台手动发布一篇文章
   - 使用浏览器开发者工具监控网络请求
   - 记录完整的请求头、参数和响应

2. **对比API调用**：
   - 对比手动发布和API调用的差异
   - 重点关注：
     - 请求头部信息
     - POST数据格式
     - 是否有额外的token或验证参数

### 方案2：数据库直接检查

如果有数据库访问权限：

```sql
-- 检查用户权限表
SHOW TABLES LIKE '%admin%';
SHOW TABLES LIKE '%user%';
SHOW TABLES LIKE '%permission%';

-- 检查分类表
SHOW TABLES LIKE '%type%';
SHOW TABLES LIKE '%category%';
SELECT * FROM article_type LIMIT 5;

-- 检查文章表
SHOW TABLES LIKE '%article%';
SELECT COUNT(*) FROM articles;
```

### 方案3：日志分析

检查服务器日志：
```bash
# 错误日志
tail -f /path/to/firebird/logs/error.log

# 访问日志
tail -f /path/to/firebird/logs/access.log

# PHP错误日志
tail -f /var/log/php_errors.log
```

## 🛠️ 可能的解决方案

### 解决方案1：权限配置修复

基于后台界面，可能需要：

1. **角色权限重新分配**
   - 确保admin用户属于超级管理员角色
   - 检查角色是否有内容管理权限

2. **API权限单独配置**
   - 某些系统可能将API权限单独管理
   - 需要在系统设置中启用API发布功能

### 解决方案2：数据初始化

```bash
# 运行数据初始化脚本
node scripts/firebird-setup-basic-data.js
```

这个脚本会：
- 尝试创建基础分类
- 测试不同的发布参数组合
- 分析后台权限配置

### 解决方案3：替代发布方案

如果直接发布仍然失败，考虑：

1. **草稿模式**：
   - 先创建草稿
   - 再通过后台手动发布

2. **队列机制**：
   - API创建发布队列
   - 管理员定期审核发布

3. **邮件通知**：
   - API创建内容后发送邮件通知
   - 管理员手动登录发布

## 📞 技术支持建议

### 联系火鸟门户技术支持

如果以上方法都无法解决，建议：

1. **收集诊断信息**：
   - 权限诊断报告
   - 错误日志截图
   - 后台配置截图

2. **具体问题描述**：
   - API发布接口返回"登录超时"
   - 手动登录正常，API调用失败
   - 需要API发布的具体权限要求

3. **请求技术文档**：
   - 完整的API文档
   - 权限配置说明
   - 故障排除指南

## 📋 检查清单

### 后台配置检查
- [ ] admin用户权限确认
- [ ] 资讯管理权限开启
- [ ] 分类数据创建完成
- [ ] API接口功能启用
- [ ] 系统发布设置正确

### 技术验证检查
- [ ] 自动登录功能正常
- [ ] 基础读取权限正常
- [ ] 会话管理机制正常
- [ ] 错误处理逻辑正确

### 数据准备检查
- [ ] 至少创建一个分类
- [ ] 分类ID=1存在且可用
- [ ] 系统配置数据完整

## 🎯 下一步行动

1. **立即执行**：
   ```bash
   # 运行基础数据设置
   node scripts/firebird-setup-basic-data.js
   ```

2. **后台配置**：
   - 登录后台检查用户权限
   - 创建必要的分类数据
   - 确认API相关设置

3. **测试验证**：
   - 手动发布测试
   - API发布对比测试
   - 完整功能验证

---

**当前状态**: 🔍 诊断完成，等待权限配置  
**关键问题**: 发布权限配置和基础数据缺失  
**解决优先级**: 高 - 影响核心发布功能