import{c as a,a as e,h as t,b as l,r as o,n,f as i,i as s,u as r,j as c,k as d,o as u,l as p,w as g,m,q as h,A as f,t as b,v as k,y as _,F as x,x as v,B as D,G as y,z as w,C as j,D as B}from"./index-cF6skFzP.js";import{r as F,_ as C}from"./uni-app.es.J1otcSEF.js";import{p as $}from"./task.9CwFAmAC.js";import{_ as S}from"./_plugin-vue_export-helper.BCo6x5W8.js";let T=m(),U=null;var I;const P=S({data:()=>({wh:T.globalData.navTop+T.globalData.appFullWh,biasTop_88:T.globalData.biasTop_88,appBack:T.globalData.appBack,masterDomain:T.globalData.masterDomain,tabbarh:0,imgurl:T.globalData.imgPath+"/task/",loadingb:!0,privateb:!1,tabbardata:null,themedata:{},recdata:null,page:1,pageSize:10,imgVersion:null,sharetitle:"",shareimg:"",msgNum:0,pages:"",platForm:T.globalData.platForm,appBoolean:T.globalData.appBoolean,channelDomain:T.globalData.channelDomain,appFullScreen:T.globalData.appFullScreen}),onLoad(a){I=this,-1==T.globalData.wxprivate?T.watchG("wxprivate",(function(e){I.wxprivate=e,e?I.privateb=!0:I.onload(a)})):T.globalData.wxprivate?I.privateb=!0:I.onload(a)},onReady(){},onShow(){let a=this;a.getMessage(),U=setInterval((function(){a.getMessage()}),5e3)},onHide(){clearInterval(U)},onUnload(){clearInterval(U)},onPullDownRefresh(){T.reloadFn()},onReachBottom(){this.$ajax.post({url:"include/ajax.php?"+T.encodeUrl("service=task&action=list"),data:{bid:1,page:++this.page,pageSize:this.pageSize}}).then((a=>{null==a.data.info.list?I.loadingb=!1:a.data.info.list.length>=10?(I.recdata=this.recdata.concat(a.data.info.list),I.loadingb=!0):(I.recdata=this.recdata.concat(a.data.info.list),I.loadingb=!1)}))},onShareAppMessage(a){return{title:this.themedata.title,imageUrl:this.themedata.sharePic}},onShareTimeline(){return{title:this.themedata.title,imageUrl:this.themedata.sharePic}},methods:{onload(o){I.imgVersion=T.globalData.imgVersion;const n=a();I.$nextTick((a=>{n.select(".tabBar").boundingClientRect(),n.exec((a=>{I.tabbarh=a[0].height}))})),e({title:"加载中",mask:!0,success:()=>{I.$ajax.post({url:"include/ajax.php?service=task&action=config"}).then((a=>{null!=a.data.info.themeBackgroundColor?(I.themedata=a.data.info,I.setBgColor(a.data.info.themeBackgroundColor),t()):(t(),l({title:"服务器出错",icon:"error",mask:!0,duration:5e3}))}))}}),I.$ajax.post({url:"include/ajax.php?"+T.encodeUrl("service=task&action=list"),data:{bid:1,page:1,pageSize:10}}).then((a=>{a.data.info.list?(I.loadingb=!(a.data.info.list.length<10),I.recdata=a.data.info.list):I.loadingb=!1})),I.$ajax.post({url:"include/ajax.php?service=siteConfig&action=touchHomePageFooter&version=2.0&module=task"}).then((a=>{for(let e=0;e<a.data.info.length;e++)a.data.info[e].url&&(a.data.info[e].url=T.addUrlParam(a.data.info[e].url));I.tabbardata=a.data.info})),I.$ajax.post({url:"include/ajax.php?"+T.encodeUrl("service=task&action=config")}).then((a=>{I.sharetitle=a.data.info.title,I.shareimg=a.data.info.sharePic})),I.pages=T.pageFn($)},linkTo(a,e=!1){if(a)if("web"==I.platForm){if(window.appBoolean)return window.setupWebViewJavascriptBridge((function(e){e.callHandler("redirectNative",{name:"",code:"",link:a},(function(){}))})),!1;a.indexOf("http")>-1?location.href=a:e?o({url:a}):n({url:a})}else{if(a.includes("tomini")){let e=a.split("?")[1].split("&");for(let t=0;t<e.length;t++)if(e[t].includes("tomini")){a=e[t].replace("tomini=",""),e.splice(t,1);break}a+=`?${e.join("&")}`}e?o({url:a.indexOf("http")>-1?"/pages/redirect/index?url="+encodeURIComponent(a):a}):n({url:a.indexOf("http")>-1?"/pages/redirect/index?url="+encodeURIComponent(a):a})}},setBgColor(a){"web"!=I.platForm&&uni.setBackgroundColor({backgroundColor:a,fail:a=>{console.log(a)}})},getMessage(){if(i("access_token")){var a=T.encodeUrl("service=member&action=message&type=tongji&im=1");I.$ajax.post({url:"include/ajax.php?"+a}).then((a=>{var e=a.data;100==e.state?I.msgNum=e.info.pageInfo.total>99?"99+":e.info.pageInfo.total:"用户信息验证失败"==e.info&&setTimeout((function(){i("access_token")?r.unit(i("refresh_token"),I.masterDomain,(function(a){if(100==a.state){console.log("更新成功"),console.log(a.info);var e=a.info.access_token,t=a.info.refresh_token;c({key:"access_token",data:e}),c({key:"refresh_token",data:t});var l=Date.parse(new Date)/1e3+7200-20;c({key:"token_expired",data:l}),T.globalData.access_token=e,T.globalData.refresh_token=t,T.globalData.token_expired=l}else{s({key:"userid"}),s({key:"access_token"}),s({key:"refresh_token"}),s({key:"token_expired"}),T.globalData.userid=null,T.globalData.access_token=null,T.globalData.refresh_token=null,T.globalData.token_expired=null;var o=I.masterDomain+"/logout.html?redirect="+I.masterDomain+"/login.html";I.linkTo(o)}})):(l({title:"账号状态异常，请重新登录！",icon:"none",duration:2e3}),s({key:"userid"}),s({key:"access_token"}),s({key:"refresh_token"}),s({key:"token_expired"}),T.globalData.userid=null,T.globalData.access_token=null,T.globalData.refresh_token=null,T.globalData.token_expired=null,I.backFn())}),1e3)}))}else I.msgNum=0},tabbarFn(){console.log("占位：函数 tabbarFn 未声明")}}},[["render",function(a,e,t,l,o,n){const i=h,s=j,r=B,c=F(d("private_tip"),C);return u(),p(i,{style:{height:"100%"}},{default:g((()=>[o.appBack?(u(),f(x,{key:0},[b(i,{style:k("height:"+o.wh+"px;background-color: "+o.themedata.themeBackgroundColor+";position: sticky;top: 0rpx;z-index: 99;padding-bottom: 88rpx;")},null,8,["style"]),b(i,{class:"rec-title",style:k("background-color: "+o.themedata.themeBackgroundColor+";top: "+(o.wh+o.biasTop_88)+"px;")},{default:g((()=>[_(" 推荐")])),_:1},8,["style"])],64)):v("",!0),b(i,{class:"rec-content"},{default:g((()=>[(u(!0),f(x,null,D(o.recdata,((a,e)=>(u(),p(i,{onClick:e=>n.linkTo(`${o.appBoolean?o.channelDomain:""}${o.pages.details}?id=${a.id}&number=${a.number}&${o.appFullScreen}`),class:"item",key:e},{default:g((()=>[b(i,{class:"recc-title"},{default:g((()=>[b(s,{src:a.photo,mode:"aspectFill"},null,8,["src"]),b(i,{class:"right"},{default:g((()=>[b(i,{class:"title"},{default:g((()=>[_(y(a.title),1)])),_:2},1024),b(i,{class:"label"},{default:g((()=>[b(i,null,{default:g((()=>[_(y(a.typename),1)])),_:2},1024),b(i,null,{default:g((()=>[_(y(a.project),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),b(i,{class:"recc-data"},{default:g((()=>[b(i,null,{default:g((()=>[b(i,{class:"people"},{default:g((()=>[_(y(a.statistics.valid>9999?"9999+":a.statistics.valid)+"人 ",1)])),_:2},1024),b(i,{class:"text"},{default:g((()=>[_("已赚")])),_:1})])),_:2},1024),b(i,null,{default:g((()=>[b(i,null,{default:g((()=>[_(y(a.statistics.avg_time)+"分钟",1)])),_:2},1024),b(i,{class:"text"},{default:g((()=>[_("平均用时")])),_:1})])),_:2},1024),b(i,null,{default:g((()=>[b(i,null,{default:g((()=>[_(y(a.statistics.avg_audit)+"分钟",1)])),_:2},1024),b(i,{class:"text"},{default:g((()=>[_("平均审核")])),_:1})])),_:2},1024)])),_:2},1024),b(i,{class:"recc-reward"},{default:g((()=>[b(s,{src:o.imgurl+"reward.png?v="+o.imgVersion,mode:"aspectFill"},null,8,["src"]),b(r,null,{default:g((()=>[_(y(a.price),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1}),o.loadingb?(u(),p(i,{key:1,class:"loadingtext"},{default:g((()=>[_("加载中...")])),_:1})):v("",!0),o.loadingb?v("",!0):(u(),p(i,{key:2,class:"nomore"},{default:g((()=>[_("没有更多喽")])),_:1})),b(i,{style:k("height: "+o.tabbarh+"px;")},null,8,["style"]),o.appBoolean?v("",!0):(u(),p(i,{key:3,class:"tabBar"},{default:g((()=>[(u(!0),f(x,null,D(o.tabbardata,((a,e)=>(u(),p(i,{class:w(1==e?"active":""),onClick:n.tabbarFn,"data-index":e,key:e},{default:g((()=>[b(i,{onClick:t=>1!=e?n.linkTo("web"==o.platForm?a.url:a.miniPath||a.url,!0):""},{default:g((()=>[b(s,{src:1!=e?a.icon:a.icon_h,mode:"aspectFill"},null,8,["src"]),a.message&&o.msgNum>0?(u(),p(i,{key:0,class:"msg"},{default:g((()=>[_(y(o.msgNum?o.msgNum:0),1)])),_:1})):v("",!0),b(r,null,{default:g((()=>[_(y(a.name),1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1032,["class","onClick","data-index"])))),128))])),_:1})),b(c,{privateShow:o.privateb},null,8,["privateShow"])])),_:1})}],["__scopeId","data-v-8033b50e"]]);export{P as default};
