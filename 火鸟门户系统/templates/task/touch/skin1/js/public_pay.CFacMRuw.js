import{a8 as a,o as e,l as o,w as t,t as s,x as n,y as l,G as c,C as i,q as p,e as d,r,a as u,h as y,g as h,P as f,k as m,N as w,O as k,z as P,H as g,A as _,B as b,F as C,v as I,m as v,D as x,I as S,n as D}from"./index-cF6skFzP.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{r as T}from"./uni-app.es.J1otcSEF.js";const $=B({data:()=>({animationData:{},content:"提示内容",icon:""}),options:{multipleSlots:!0},methods:{showToast(e,o){var t=a({duration:300,timingFunction:"ease"});this.animation=t,t.opacity(1).step(),this.animationData=t.export(),this.content=e,this.icon=o||"",setTimeout(function(){t.opacity(0).step(),this.animationData=t.export()}.bind(this),1500)}},created:function(){}},[["render",function(a,d,r,u,y,h){const f=i,m=p;return e(),o(m,{class:"wx-toast-box",animation:y.animationData},{default:t((()=>[s(m,{class:"wx-toast-content"},{default:t((()=>[""!=y.icon?(e(),o(m,{key:0,class:"wx-toast-icon"},{default:t((()=>[s(f,{src:y.icon,mode:"aspectFit"},null,8,["src"])])),_:1})):n("",!0),s(m,{class:"wx-toast-toast"},{default:t((()=>[l(c(y.content),1)])),_:1})])),_:1})])),_:1},8,["animation"])}],["__scopeId","data-v-5ea59f62"]]),j=v();const V=B({components:{toast:$},data:()=>({uniPlatform:"",imgstatic:`${j.globalData.masterDomain}/static/images/miniprograme/payPop/`,imgVersion:j.globalData.imgVersion,imgPath:j.globalData.imgPath,paypwd:[],paypwdStr:"",payment:[],onChosePay:"balance",money:0,bouns:0,showPwdPop:!1,showCancelPop:!1,timeInfo:{dd:0,hh:0,ss:0,mm:0,showText:"0"},focus:!0,hasshowPwdPop:!1,checkIn:!1,interVal:null,payInterval:null,keyboardHeight:0,i:"",currency:{code:"RMB",name:"人民币",rate:"1",short:"元",symbol:"￥"},timeoutpay:!0,userid:j.globalData.userid,keyboardShow:!1,userInfo:""}),props:{showPayPop:{type:Boolean,default:!1},action:{type:String,default:"payPhone"},service:{type:String,default:"siteConfig"},payInfo:{type:Object,default:{order_amount:"",order_sn:"",ordernum:"",service:"",timeout:0}},callType:{type:Number,default:0},needPayTime:{type:Boolean,default:!0},needSuccess:{type:Boolean,default:!0}},emits:["paypopb","keepToCall"],methods:{ready:function(){const a=this;var e=setInterval((function(){j.globalData.appConfig&&j.globalData.appConfig.currency&&(a.currency=j.globalData.appConfig.currency,clearInterval(e))}),1e3)},inputCodeFn(){},getPayment(){const a=this;var e=j.encodeUrl("service=siteConfig&action=payment");a.$ajax.get({url:"include/ajax.php?"+e}).then((e=>{var o=e.data;if(100==o.state){let e=j.globalData.platForm;if("mp-weixin"==e)for(let t=0;t<o.info.length;t++){let e=o.info[t];("alipay"==e.pay_code||!a.userid&&"huoniao_bonus"==e.pay_code)&&o.info.splice(t,1)}else if("mp-toutiao"==e)for(let t=0;t<o.info.length;t++){let e=o.info[t];("alipay"==e.pay_code||"wxpay"==e.pay_code||!a.userid&&"huoniao_bonus"==e.pay_code)&&o.info.splice(t,1)}else if("web"==e&&!a.userid)for(let a=0;a<o.info.length;a++){"huoniao_bonus"==o.info[a].pay_code&&o.info.splice(a,1)}j.globalData.userid||(a.onChosePay=o.info[0].pay_code),a.payment=o.info}}))},getMemberInfo:function(){const a=this;var e="service=member&action=detail&id="+j.globalData.userid,o=j.encodeUrl(e);a.$ajax.get({url:"include/ajax.php?"+o}).then((e=>{100==e.data.state&&(j.globalData.userInfo=e.data.info,a.money=1*e.data.info.money,a.bouns=1*e.data.info.bonus)}))},changePay(a){const e=this;var o=a.currentTarget.dataset.code;0!=a.currentTarget.dataset.click&&(e.onChosePay=o)},cancelConfirm(){this.showCancelPop=!0},cancelPay(){const a=this;clearInterval(a.interVal),a.showCancelPop=!1,a.showPwdPop=!1,this.$emit("paypopb",!1),a.interVal=null,"发布任务"==a.payInfo.subject&&d({delta:2,success:a=>{r({url:"web"==j.globalData.platForm?"/taskmanage?index=0":"/pages/packages/task/taskmanage/taskmanage?index=0"})}})},keepPay(){this.showCancelPop=!1},toPay(){const a=this;"balance"==a.onChosePay?(a.showPwdPop=!0,a.keyboardShow=!0,a.hasshowPwdPop=!0):(console.log("开始支付"),a.checkPwd())},hidePwdPop(){const a=this;a.showPwdPop=!1,a.keyboardShow=!1,a.hasshowPwdPop=!1,a.paypwd=[],a.paypwdStr=""},focusin(){const a=this;a.hasshowPwdPop=!0,"web"!=a.uniplatform?a.focus=!0:a.keyboardShow=!0},showKeyboard(a){const e=this;a.detail.height&&e.keyboardHeight!=a.detail.height&&(e.keyboardHeight=a.detail.height),e.showPwdPop&&a.detail.height&&(e.hasshowPwdPop=!0,"web"!=e.uniplatform?e.focus=!0:(e.focus=!1,e.keyboardShow=!0))},goLink(a){var e=j.globalData.appConfig.cfg_user_index+a.currentTarget.dataset.href;j.linkTo(e)},inputPwd(a){const e=this;var o=a.detail.value,t=o.split("");if(t.length>6&&8!=a.detail.keyCode)return!1;e.paypwd=o.split(""),6==t.length&&e.checkPwd()},keyBoardIn(a){const e=this;e.paypwd.length>=6||(e.paypwd.push(a),6==e.paypwd.length&&e.checkPwd())},checkPwd(a){const e=this;if(e.checkIn||1!=e.userInfo.paypwdCheck&&!a&&"balance"==e.onChosePay)return!1;e.checkIn=!0;let o={service:e.service,action:e.action,ordernum:e.payInfo.ordernum,paytype:e.onChosePay};"balance"==e.onChosePay?(o.useBalance=1,o.paypwd=e.paypwd.join(""),o.balance=e.payInfo.order_amount):o.useBalance=0;let t=j.globalData.platForm;if("mp-toutiao"==t)if("bytemini"==e.onChosePay){let a="";for(let t in o)a+=`&${t}=${o[t]}`;let e=`${j.globalData.masterDomain}/include/ajax.php?${a}`;D({url:"/pages/redirect/index?url="+encodeURIComponent(e)})}else e.payRequest(o,(function(a){e.paySuccess(),e.paypwd=[],e.paypwdStr=""}));else if("mp-weixin"==t)"wxpay"==e.onChosePay?e.payRequest(o,(function(a){e.payBywxChat(a.data.info)})):e.payRequest(o,(function(a){e.paySuccess(),e.paypwd=[],e.paypwdStr=""}));else if("web"==t)if(!window.appBoolean||"wxpay"!=e.onChosePay&&"alipay"!=e.onChosePay)if("wxpay"==e.onChosePay||"alipay"==e.onChosePay){let a="";for(let e in o)a+=`&${e}=${o[e]}`;a=a.slice(1),location.href=`${j.globalData.masterDomain}/include/ajax.php?${a}`}else e.payRequest(o,(function(a){e.paySuccess(),e.paypwd=[],e.paypwdStr=""}));else e.$ajax.post({url:j.encodeUrl("include/ajax.php?mark=pay"),data:o}).then((a=>{100==a.data.state&&window.setupWebViewJavascriptBridge((function(o){o.callHandler("wxpay"==e.onChosePay?"wechatPay":"aliPay",{orderInfo:a.data.info},(function(a){}))}))}))},payRequest(a,e){const o=this;u({title:"支付中..."}),o.$ajax.post({url:j.encodeUrl("include/ajax.php?mark=pay"),data:a}).then((a=>{y(),o.checkIn=!1,a.data.state&&100!=a.data.state?(o.$refs.toasts.showToast(a.data.info),o.paypwd=[],o.paypwdStr=""):100==a.data.state?e(a):(o.paypwd=[],o.paypwdStr="",o.$refs.toasts.showToast("网络请求失败，请稍后重新请求，错误代码："+JSON.stringify(a.data)))}))},payBywxChat(a){const e=this;uni.requestPayment({timeStamp:a.timeStamp,nonceStr:a.nonceStr,package:a.package,signType:a.signType,paySign:decodeURIComponent(a.paySign),success:function(a){e.paySuccess()},fail:function(a){console.log(a),e.$refs.toasts.showToast("支付失败！")}})},paybytoutiao(a){console.log(a)},initData(a){const e=this;e.$emit("keepToCall",{detail:a}),e.$emit("paypopb",!1),e.paypwd=[],e.onChosePay="balance",e.money=0,e.bouns=0,e.showPwdPop=!1,e.showCancelPop=!1,e.hasshowPwdPop=!1,e.getMemberInfo()},paySuccess(){const a=this;if(clearInterval(a.interVal),a.needSuccess){var e=a.imgPath+"/payPop/successIcon.png?v="+a.imgVersion;a.$refs.toasts.showToast("支付成功",e)}a.getPhoneInfo()},getPhoneInfo(){const a=this;var e="service=member&action=tradePayResult&order="+a.payInfo.ordernum;a.$ajax.post({url:"include/ajax.php?"+e}).then((e=>{var o=e.data;100==o.state&&a.initData(o)}))},setPayPwd:function(){const a=this;var e=this;if(e.loading)return!1;if(6!=e.paypwd.length)return showErrAlert("请输入新密码"),!1;e.loading=!0;var o="service=member&action=updateAccount&do=paypwdAdd"+("&pay1="+e.paypwd.join("")+"&pay2="+e.paypwd.join("")),t=j.encodeUrl(o);e.$ajax.post({url:"include/ajax.php?"+t}).then((o=>{var t=o.data;if(e.loading=!1,100==t.state){var s=a.imgPath+"/payPop/successIcon.png?v="+a.imgVersion;e.$refs.toasts.showToast("支付密码设置成功",s),e.checkPwd(1)}}))},payCutDown(a,e,o=0){const t=this;e=parseInt((new Date).valueOf()/1e3)+1800,a.order_amount>t.money&&(t.onChosePay=t.payment[0].pay_code),t.interVal&&clearInterval(t.interVal),t.timeInfo={dd:"0",hh:"00",mm:"00",ss:"00",showText:"0天0小时0分钟0秒"},t.interVal=setInterval((function(){var a=parseInt(Date.parse(new Date));if(1e3*e-a>0)var o=1e3*e-a;else o=0;o||clearInterval(t.interVal);var s=Math.floor(o/864e5),n=Math.floor(o/36e5%24),l=Math.floor(o/6e4%60),c=Math.floor(o/1e3%60),i={dd:s>9?s:"0"+s,hh:n>9?n:"0"+n,mm:l>9?l:"0"+l,ss:c>9?c:"0"+c,showText:s?s+"天":n?n+"小时":l?l+"分钟":c+"秒"};t.timeInfo=i}),1e3)},showtoast(){console.log("测试方法")},trueFun(){console.log("占位：函数 true 未声明")}},created(){const a=this;a.getPayment(),j.globalData.userid&&a.getMemberInfo(),setTimeout((e=>{a.timeoutpay=!1}),400)},mounted(){const a=this;this.uniPlatform=h().uniPlatform,"web"==this.uniPlatform&&(this.focus=!1,this.hasshowPwdPop=!1),"{}"!=JSON.stringify(j.globalData.userInfo)?this.userInfo=j.globalData.userInfo:f({key:"userid",success:e=>{j.memberInfo(e.data,(function(e){a.userInfo=e}))}}),this.$nextTick((()=>this.ready()))},unmounted(){clearInterval(this.interVal)}},[["render",function(a,d,r,u,y,h){const f=p,v=x,D=i,B=S,j=T(m("toast"),$);return w((e(),o(f,{class:"payPopContainer"},{default:t((()=>[s(f,{class:P("payPopMask "+(r.showPayPop?"showPop":"")),onTouchmove:g(h.trueFun,["stop","prevent"])},null,8,["class","onTouchmove"]),s(f,{class:P("payPop payPhonePop "+(r.showPayPop?"showPop":""))},{default:t((()=>[s(f,{class:"payInfoShow"},{default:t((()=>[s(f,{class:"pi-title"},{default:t((()=>[l(c(r.payInfo.subject)+"需支付",1)])),_:1}),s(f,{class:"h2",onClick:h.showtoast},{default:t((()=>[y.currency?(e(),o(v,{key:0,class:"span"},{default:t((()=>[l(c(y.currency.symbol),1)])),_:1})):n("",!0),s(v,{class:"b",id:"amout"},{default:t((()=>[l(c(r.payInfo.order_amount),1)])),_:1})])),_:1},8,["onClick"]),r.needPayTime?(e(),o(f,{key:0,class:"p"},{default:t((()=>[l(" 支付时间: "),s(v,{class:"payCutDown span"},{default:t((()=>[s(v,{class:"em"},{default:t((()=>[l(c(y.timeInfo.hh),1)])),_:1}),l(" : "),s(v,{class:"em"},{default:t((()=>[l(c(y.timeInfo.mm),1)])),_:1}),l(" : "),s(v,{class:"em"},{default:t((()=>[l(c(y.timeInfo.ss),1)])),_:1})])),_:1})])),_:1})):n("",!0)])),_:1}),s(f,{class:"payListBox"},{default:t((()=>[s(f,{class:"close_pay_pop",onClick:h.cancelConfirm},{default:t((()=>[s(D,{mode:"aspectFit",src:y.imgPath+"/payPop/close.png?v="+y.imgVersion},null,8,["src"])])),_:1},8,["onClick"]),s(f,{class:"ul"},{default:t((()=>[y.userid?(e(),o(f,{key:0,class:P("check-item li "+("balance"==y.onChosePay&&r.payInfo.order_amount<=y.money?"paychosed":"")+" "+(r.payInfo.order_amount>y.money?"disabled_pay":"")),id:"balance","data-code":"balance",onClick:h.changePay,"data-click":r.payInfo.order_amount>y.money?0:1},{default:t((()=>[s(f,{class:"left_item div"},{default:t((()=>[s(f,{class:"check-item-img"},{default:t((()=>[s(D,{class:"img",mode:"aspectFit",src:y.imgPath+"/payPop/balance.png?v="+y.imgVersion},null,8,["src"])])),_:1}),s(f,{class:"check-item-txt"},{default:t((()=>[s(f,{class:"h3"},{default:t((()=>[l(" 余额 "),r.payInfo.order_amount<=y.money?(e(),o(v,{key:0},{default:t((()=>[l("(可用余额"+c(y.currency.symbol)+c(y.money)+")",1)])),_:1})):(e(),o(v,{key:1},{default:t((()=>[l("(余额不足，可用余额"+c(y.currency.symbol)+c(y.money)+")",1)])),_:1}))])),_:1})])),_:1})])),_:1}),s(f,{class:"check-item-right"},{default:t((()=>[s(f,{class:"checkbox-icon-round span"},{default:t((()=>[s(D,{mode:"aspectFiill",src:y.imgPath+"/payPop/chosed.png?v="+y.imgVersion},null,8,["src"])])),_:1})])),_:1}),r.payInfo.order_amount>y.money?(e(),o(f,{key:0,class:"investMoney","data-href":"/deposit.html?paytype=deposit",onClick:h.goLink},{default:t((()=>[l("充值")])),_:1},8,["onClick"])):n("",!0)])),_:1},8,["class","onClick","data-click"])):n("",!0),(e(!0),_(C,null,b(y.payment,((a,n)=>(e(),o(f,{key:n,class:P("check-item li "+(a.pay_code==y.onChosePay?"paychosed":"")+"  "+(r.payInfo.order_amount>y.bouns&&"huoniao_bonus"==a.pay_code?"disabled_pay":"")),"data-code":a.pay_code,"data-click":r.payInfo.order_amount>y.bouns&&"huoniao_bonus"==a.pay_code?0:1,onClick:h.changePay},{default:t((()=>[s(f,{class:"left_item div"},{default:t((()=>[s(f,{class:"check-item-img"},{default:t((()=>["huoniao_bonus"==a.pay_code?(e(),o(D,{key:0,class:"img",mode:"aspectFit",src:y.imgPath+"/payPop/bonus_pay.png?v="+y.imgVersion},null,8,["src"])):(e(),o(D,{key:1,class:"img",mode:"aspectFit",src:a.pay_icon},null,8,["src"]))])),_:2},1024),s(f,{class:"check-item-txt"},{default:t((()=>["huoniao_bonus"==a.pay_code?(e(),o(f,{key:0,class:"h3"},{default:t((()=>[l(c(a.pay_name)+" ",1),r.payInfo.order_amount<=y.bouns?(e(),o(v,{key:0},{default:t((()=>[l("(可用余额"+c(y.currency.symbol)+c(y.bouns)+")",1)])),_:1})):(e(),o(v,{key:1},{default:t((()=>[l("(余额不足，可用余额"+c(y.currency.symbol)+c(y.bouns)+")",1)])),_:1}))])),_:2},1024)):(e(),o(f,{key:1,class:"h3"},{default:t((()=>[l(c(a.pay_name),1)])),_:2},1024))])),_:2},1024)])),_:2},1024),r.payInfo.order_amount>y.bouns&&"huoniao_bonus"==a.pay_code?(e(),o(f,{key:0,class:"investMoney",onClick:h.goLink,"data-href":"/recharge.html"},{default:t((()=>[l("充值")])),_:1},8,["onClick"])):(e(),o(f,{key:1,class:"check-item-right"},{default:t((()=>[s(f,{class:"checkbox-icon-round span"},{default:t((()=>[s(D,{mode:"aspectFiill",src:y.imgPath+"/payPop/chosed.png?v="+y.imgVersion},null,8,["src"])])),_:1})])),_:1}))])),_:2},1032,["class","data-code","data-click","onClick"])))),128))])),_:1})])),_:1}),s(f,{class:"btn_pay a",onClick:h.toPay},{default:t((()=>[s(v,{style:{display:"block"},class:"span"},{default:t((()=>[l("立即付款")])),_:1})])),_:1},8,["onClick"]),s(f,{class:P("payCancelMask "+(y.showCancelPop?"showPop":""))},null,8,["class"]),s(f,{class:P("payCancelPop "+(y.showCancelPop?"showPop":"")),style:I(r.needPayTime?"":"height:250rpx;")},{default:t((()=>[s(f,{class:"h4"},{default:t((()=>[l("确定放弃本次付款？")])),_:1}),r.needPayTime?(e(),o(f,{key:0,class:"p"},{default:t((()=>[l(" 您的订单在 "),s(v,{class:"daojs_order span"},{default:t((()=>[l(c(y.timeInfo.showText),1)])),_:1}),l(" 内未支付将被取消， 请尽快完成支付 ")])),_:1})):n("",!0),s(f,{class:"payBtns"},{default:t((()=>[s(f,{class:"cancelPay a",onClick:h.cancelPay},{default:t((()=>[l("放弃")])),_:1},8,["onClick"]),s(f,{class:"keepPay a",onClick:h.keepPay},{default:t((()=>[l("继续支付")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["class","style"])])),_:1},8,["class"]),s(f,{class:"inputBox"},{default:t((()=>[s(B,{type:"number","hold-keyboard":!0,focus:y.hasshowPwdPop&&y.focus,class:"keyInp",onKeyboardheightchange:h.showKeyboard,onInput:h.inputPwd,maxlength:"6",modelValue:y.paypwdStr,"onUpdate:modelValue":d[0]||(d[0]=a=>y.paypwdStr=a)},null,8,["focus","onKeyboardheightchange","onInput","modelValue"])])),_:1}),s(f,{class:P("payPwdPop "+(y.showPwdPop?"showPop":""))},{default:t((()=>[s(f,{class:"payBackBtn a",onClick:h.hidePwdPop},{default:t((()=>[s(D,{src:y.imgPath+"/payPop/arr_back.png?v="+y.imgVersion,mode:"aspectFit"},null,8,["src"])])),_:1},8,["onClick"]),s(f,{class:"h4"},{default:t((()=>[l(c(1==y.userInfo.paypwdCheck?"输入":"设置")+"支付密码",1)])),_:1}),s(f,{class:"payPwdBox",style:I("padding-bottom:"+(y.keyboardHeight+10)+"px;")},{default:t((()=>[s(f,{class:"p"},{default:t((()=>[l("请"+c(1==y.userInfo.paypwdCheck?"输入":"设置")+"6位数字密码确认支付",1)])),_:1}),s(f,{class:"payPwdInp"},{default:t((()=>[s(f,{class:"ul",onClick:h.focusin},{default:t((()=>[(e(),_(C,null,b(6,((a,c)=>s(f,{class:"li",key:c},{default:t((()=>[y.paypwd[c]||0==y.paypwd[c]?(e(),o(v,{key:0,class:"em"},{default:t((()=>[l("•")])),_:1})):n("",!0)])),_:2},1024))),64))])),_:1},8,["onClick"])])),_:1}),1==y.userInfo.paypwdCheck?(e(),o(f,{key:0,class:"fpwtbox"},{default:t((()=>[s(f,{"data-href":"/security-paypwdEdit.html?step=2",class:"fpwt a",onClick:h.goLink},{default:t((()=>[l("忘记密码?")])),_:1},8,["onClick"])])),_:1})):(e(),o(f,{key:1,class:"spwtbox"},{default:t((()=>[s(f,{class:"p"},{default:t((()=>[l("·避免使用连续或重复数字，类似“123456”“112233”")])),_:1}),s(f,{class:"p"},{default:t((()=>[l("·避免使用手机号、证件号中的连续数字")])),_:1})])),_:1})),1!=y.userInfo.paypwdCheck?(e(),o(f,{key:2,class:"setPwdUp",onClick:h.setPayPwd},{default:t((()=>[l("确认并支付")])),_:1},8,["onClick"])):n("",!0)])),_:1},8,["style"]),"web"==y.uniPlatform?(e(),o(f,{key:0,class:P({keyboard:!0,showKeyBoard:y.keyboardShow})},{default:t((()=>[s(f,null,{default:t((()=>[s(v,{onClick:d[1]||(d[1]=a=>h.keyBoardIn(1))},{default:t((()=>[l("1")])),_:1}),s(v,{onClick:d[2]||(d[2]=a=>h.keyBoardIn(2))},{default:t((()=>[l("2")])),_:1}),s(v,{onClick:d[3]||(d[3]=a=>h.keyBoardIn(3))},{default:t((()=>[l("3")])),_:1}),s(v,{onClick:d[4]||(d[4]=a=>h.keyBoardIn(4))},{default:t((()=>[l("4")])),_:1}),s(v,{onClick:d[5]||(d[5]=a=>h.keyBoardIn(5))},{default:t((()=>[l("5")])),_:1}),s(v,{onClick:d[6]||(d[6]=a=>h.keyBoardIn(6))},{default:t((()=>[l("6")])),_:1}),s(v,{onClick:d[7]||(d[7]=a=>h.keyBoardIn(7))},{default:t((()=>[l("7")])),_:1}),s(v,{onClick:d[8]||(d[8]=a=>h.keyBoardIn(8))},{default:t((()=>[l("8")])),_:1}),s(v,{onClick:d[9]||(d[9]=a=>h.keyBoardIn(9))},{default:t((()=>[l("9")])),_:1}),s(v,{class:"none"}),s(v,{onClick:d[10]||(d[10]=a=>h.keyBoardIn(0))},{default:t((()=>[l("0")])),_:1}),s(v,{class:"backSpace",style:I(`background: url(${y.imgstatic}del_num.png) no-repeat 50%/60rpx;`),onClick:d[11]||(d[11]=a=>y.paypwd=y.paypwd.slice(0,-1))},null,8,["style"])])),_:1})])),_:1},8,["class"])):n("",!0)])),_:1},8,["class"]),s(f,{style:{position:"relative","z-index":"9999999999"}},{default:t((()=>[s(j,{id:"toast",ref:"toasts"},null,512)])),_:1})])),_:1},512)),[[k,!y.timeoutpay]])}],["__scopeId","data-v-22f96a84"]]);export{V as p};
