import{a,P as e,i as t,j as i,h as s,b as l,d as o,e as n,r,n as d,k as c,o as p,l as m,w as u,m as h,q as g,A as f,t as k,v as b,y as v,G as w,F as x,x as y,B as F,H as C,C as _,D,X as B,W as S}from"./index-cF6skFzP.js";import{_ as j}from"./previewMedia.C3gYMXHd.js";import{r as T,_ as $}from"./uni-app.es.J1otcSEF.js";import{p as I}from"./task.9CwFAmAC.js";import{_ as V}from"./_plugin-vue_export-helper.BCo6x5W8.js";let J=h();var M;const O=V({data:()=>({wh:J.globalData.navTop+J.globalData.appFullWh,masterDomain:J.globalData.masterDomain,biasTop_88:J.globalData.biasTop_88,appBack:J.globalData.appBack,imgurl:J.globalData.imgPath+"/task/",themedata:{},privateb:!1,warningb:!1,complaintb:!1,merchantb:!1,previewb:!1,staticSrc:[],currentIndex:0,formdata:{images:"",video:""},minlength:10,info:null,oid:"",tid:"",imgVersion:"",pages:"",platForm:J.globalData.platForm,appFullWh:J.globalData.appFullWh,appBoolean:J.globalData.appBoolean,appFullScreen:J.globalData.appFullScreen}),onLoad(a){M=this,-1==J.globalData.wxprivate?J.watchG("wxprivate",(function(e){M.wxprivate=e,e?M.privateb=!0:M.onload(a)})):J.globalData.wxprivate?M.privateb=!0:M.onload(a)},onReady(){},onShow(){},onHide(){},onUnload(){},onPullDownRefresh(){},onReachBottom(){},onShareAppMessage(a){return{title:this.themedata.title,imageUrl:this.themedata.sharePic,path:"/pages/packages/task/my/my"}},onShareTimeline(){return{title:this.themedata.title,imageUrl:this.themedata.sharePic,path:"/pages/packages/task/my/my"}},methods:{onload(o){a({title:"加载中",mask:!0,success:()=>{e({key:"warnColor",success:a=>{e({key:"warnColor",success:a=>{M.themedata=a.data.themeDate,M.setBgColor(this.themedata.themeBackgroundColor),a.data.outtime<Date.parse(new Date)&&t({key:"warnColor",success:()=>{M.$ajax.post({url:"include/ajax.php?service=task&action=config"}).then((a=>{null!=a.data.info.themeBackgroundColor?(M.themedata=a.data.info,i({key:"warnColor",data:{themeDate:this.themedata,outtime:Date.parse(new Date)+36e5}}),M.setBgColor(this.themedata.themeBackgroundColor),s()):(s(),l({title:"服务器出错",icon:"error",mask:!0,duration:5e3}))}))}})}}),s()},fail:a=>{M.$ajax.post({url:"include/ajax.php?service=task&action=config"}).then((a=>{null!=a.data.info.themeBackgroundColor?(M.themedata=a.data.info,i({key:"warnColor",data:{themeDate:this.themedata,outtime:Date.parse(new Date)+36e5}}),M.setBgColor(this.themedata.themeBackgroundColor),s()):(s(),l({title:"服务器出错",icon:"error",mask:!0,duration:5e3}))}))}})}}),M.complaintb=1==o.complaint,M.oid=o.oid,M.merchantb=0!=o.state,M.tid=o.tid?o.tid:this.tid,M.pages=J.pageFn(I)},backFn(){if(M.appBoolean)return window.setupWebViewJavascriptBridge((function(a){a.callHandler("goBack",{},(function(a){}))})),!1;{let a=o();a&&a.length>1?n({delta:1}):"web"==M.platForm?location.href=`${M.masterDomain}${window.pathname}${M.pages.index}`:r({url:"/pages/packages/task/index/index"})}},linkTo(a){if(a)if("web"==M.platForm){if(window.appBoolean)return window.setupWebViewJavascriptBridge((function(e){e.callHandler("redirectNative",{name:"",code:"",link:a},(function(){}))})),!1;a.indexOf("http")>-1?location.href=a:d({url:a})}else{if(a.includes("tomini")){let e=a.split("?")[1].split("&");for(let t=0;t<e.length;t++)if(e[t].includes("tomini")){a=e[t].replace("tomini=",""),e.splice(t,1);break}a+=`?${e.join("&")}`}d({url:a.indexOf("http")>-1?"/pages/redirect/index?url="+encodeURIComponent(a):a})}},setBgColor(a){"web"!=M.platForm&&uni.setBackgroundColor({backgroundColor:a,fail:a=>{console.log(a)}})},warningFn(){M.warningb=!this.warningb,setTimeout((()=>{M.warningb=!this.warningb}),2e3)},textFn(a){this.formdata.note=a.detail.value},mediaFn(a){if(0==a.currentTarget.dataset.state){this.formdata.images||(this.formdata.images=[]);let a=this.formdata.images.length,e={mod:"task",type:"atlas"},t={count:6-this.formdata.images.length,sizeType:[],sourceType:["album","camera"]};this.$ajax.upMedia({seFile:!0,type:"image",formData:e,upConfig:t}).then((e=>{for(let t=0;t<e.length;t++){let i=JSON.parse(e[t].data);"SUCCESS"!=i.state?(this.info=i.state,this.warnFn()):this.formdata.images[a+t]=i.turl}this.formdata=JSON.parse(JSON.stringify(this.formdata))}))}else{let a={mod:"task",type:"video",filetype:"video",utype:"video"};this.$ajax.upMedia({seFile:!0,type:"video",formData:a}).then((a=>{let e=JSON.parse(a.data);this.$set(this.formdata,"video",e.turl)}))}},delFn(a){if(0==a.currentTarget.dataset.state){let e=a.currentTarget.dataset.index;this.formdata.images.splice(e,1)}else this.formdata.video="";M.formdata=this.formdata},clickmediaFn(a){if(0==a.currentTarget.dataset.state){let e=a.currentTarget.dataset.index;for(let a=0;a<this.formdata.images.length;a++)this.staticSrc[a]={type:"image",value:this.formdata.images[a]};this.currentIndex=e+1}else this.staticSrc=[{type:"video",value:this.formdata.video}],this.currentIndex=1;this.previewb=!0},submitFn(){if(this.formdata.note&&!this.warningb)if(0==this.formdata.note.length)M.info="请填写举报理由",this.warningFn();else if(this.formdata.note.length<this.minlength)M.info="举报理由不低于10个字",this.warningFn();else{let a={};a.id=this.oid,a.content=this.formdata.note,this.formdata.images&&(a.pics=this.formdata.images.join("||")),this.formdata.video&&(a.video=this.formdata.video),M.$ajax.post({url:"include/ajax.php?"+J.encodeUrl("service=task&action="+(this.complaintb?"sendReport":"pleaReport")),data:a}).then((a=>{100==a.data.state&&(M.info=a.data.info,this.warningFn(),setTimeout((()=>{if(!this.merchantb&&this.complaintb){let a=this.oid,e=this.tid;n({delta:1,success:()=>{M.linkTo(`${M.appBoolean?window.channelDomain:""}${M.pages.orderhistory}?orderid=${a}&date=0&explain=0&state=0&tid=${e}&merchant=0&${M.appFullScreen}`)}})}else this.backFn()}),2200))}))}else this.warningb||(M.info="请填写举报理由",this.warningFn())}}},[["render",function(a,e,t,i,s,l){const o=g,n=_,r=D,d=B,h=S,I=T(c("previewMedia"),j),V=T(c("private_tip"),$);return p(),m(o,{style:{height:"100%"}},{default:u((()=>[s.appBack?(p(),f(x,{key:0},[k(o,{style:b("height:"+s.wh+"px;background-color: "+s.themedata.themeBackgroundColor+";position: sticky;top: 0rpx;z-index: 99;padding-bottom: 88rpx;"),catchtouchmove:""},null,8,["style"]),k(o,{class:"rec-title",style:b("background-color: "+s.themedata.themeBackgroundColor+";top: "+(s.wh+s.biasTop_88)+"px;")},{default:u((()=>[k(n,{src:s.imgurl+"bl-arrow.png?v="+s.imgVersion,onClick:l.backFn,mode:"aspectFill"},null,8,["src","onClick"]),k(o,null,{default:u((()=>[v(w(s.complaintb?"发起举报":"待我辩诉"),1)])),_:1})])),_:1},8,["style"])],64)):y("",!0),k(o,{class:"warning"},{default:u((()=>[k(o,null,{default:u((()=>[v("1、平台希望用户和商家在对审核结果有疑问时，能先私下进行积极的沟通，争取双方能够私下协商达成一致。")])),_:1}),k(o,null,{default:u((()=>[v("2、举报维权环节，请保证提交内容的真实性，否则可能会遭到平台严厉的处罚!")])),_:1})])),_:1}),k(o,{class:"formpaper"},{default:u((()=>[k(o,{class:"f-reason"},{default:u((()=>[k(o,{class:"fr-title"},{default:u((()=>[k(r,null,{default:u((()=>[v("*")])),_:1}),v(" "+w(s.complaintb?"举报":"辩诉")+"理由 ",1)])),_:1}),k(o,{class:"fr-text"},{default:u((()=>[k(d,{placeholder:"请填写您的"+(s.complaintb?"举报":"辩诉")+"理由，至少"+s.minlength+"个字",onInput:l.textFn},null,8,["placeholder","onInput"])])),_:1})])),_:1}),k(o,{class:"f-picture"},{default:u((()=>[k(o,{class:"title"},{default:u((()=>[v(" 证据截图 "),k(r,null,{default:u((()=>[v("( 最多添加6张 )")])),_:1})])),_:1}),k(o,{class:"picture"},{default:u((()=>[s.formdata.images?(p(!0),f(x,{key:0},F(s.formdata.images,((a,e)=>(p(),m(o,{style:{position:"relative","margin-right":"60rpx"},key:e},{default:u((()=>[k(n,{src:a,class:"exhibition",mode:"aspectFill","data-index":e,onClick:C(l.clickmediaFn,["stop","prevent"]),"data-state":"0"},null,8,["src","data-index","onClick"]),k(n,{src:s.imgurl+"circleClose.png?v="+s.imgVersion,class:"close",onClick:C(l.delFn,["stop","prevent"]),"data-index":e,mode:"aspectFill","data-state":"0"},null,8,["src","onClick","data-index"])])),_:2},1024)))),128)):y("",!0),s.formdata.images.length<6||!s.formdata.images?(p(),m(o,{key:1,class:"add",onClick:l.mediaFn,"data-state":"0"},{default:u((()=>[k(n,{src:s.imgurl+"crossadd.png?v="+s.imgVersion,mode:"aspectFill"},null,8,["src"]),k(o,null,{default:u((()=>[v("添加图片")])),_:1})])),_:1},8,["onClick"])):y("",!0)])),_:1})])),_:1}),k(o,{class:"f-video"},{default:u((()=>[k(o,{class:"title"},{default:u((()=>[v(" 证据视频 "),k(r,null,{default:u((()=>[v("( 大小不超过100M )")])),_:1})])),_:1}),k(o,{class:"video"},{default:u((()=>[s.formdata.video?(p(),m(o,{key:0,style:{position:"relative"}},{default:u((()=>[k(h,{src:s.formdata.video,class:"exhibition",onClick:C(l.clickmediaFn,["stop","prevent"]),controls:!1,"show-center-play-btn":!1,"data-state":"1"},{default:u((()=>[k(n,{class:"pause",src:s.imgurl+"pause.png?v="+s.imgVersion,mode:"aspectFill"},null,8,["src"])])),_:1},8,["src","onClick"]),k(n,{src:s.imgurl+"circleClose.png?v="+s.imgVersion,class:"close",onClick:C(l.delFn,["stop","prevent"]),mode:"aspectFill","data-state":"1"},null,8,["src","onClick"])])),_:1})):y("",!0),s.formdata.video?y("",!0):(p(),m(o,{key:1,class:"add",onClick:l.mediaFn,"data-state":"1"},{default:u((()=>[k(n,{src:s.imgurl+"crossadd.png?v="+s.imgVersion,mode:"aspectFill"},null,8,["src"]),k(o,null,{default:u((()=>[v("添加视频")])),_:1})])),_:1},8,["onClick"]))])),_:1})])),_:1})])),_:1}),k(o,{class:"btobtn"},{default:u((()=>[k(o,{style:b("background-color: "+s.themedata.themeBackgroundColor+";"),onClick:C(l.submitFn,["stop","prevent"])},{default:u((()=>[v(" 提交"+w(s.complaintb?"举报":"辩诉"),1)])),_:1},8,["style","onClick"])])),_:1}),k(o,{class:"pop-warning",style:b(s.warningb?"transform:scale(1);":"transform:scale(0);z-index:-1;")},{default:u((()=>[k(o,{class:"text",style:{transform:"translate(-50%, -50%)"}},{default:u((()=>[v(w(s.info),1)])),_:1})])),_:1},8,["style"]),k(I,{previewb:s.previewb,staticSrc:s.staticSrc,onPreviewClose:e[0]||(e[0]=a=>s.previewb=!1),currentIndex:s.currentIndex},null,8,["previewb","staticSrc","currentIndex"]),k(V,{privateShow:s.privateb},null,8,["privateShow"])])),_:1})}],["__scopeId","data-v-04333403"]]);export{O as default};
