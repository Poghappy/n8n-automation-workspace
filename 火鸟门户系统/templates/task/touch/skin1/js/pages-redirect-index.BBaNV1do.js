import{s as e,i as a,j as t,r as i,a as n,b as o,h as l,J as r,d as s,e as c,n as d,Q as g,o as u,l as p,m as f,a6 as h}from"./index-cF6skFzP.js";import{_ as m}from"./_plugin-vue_export-helper.BCo6x5W8.js";var x;const k=f();const b=m({data:()=>({url:"",shareObj:""}),onLoad(d){x=this,"1"==d.delUser&&(e("logoutSelf",1),a({key:"userid",success:e=>{k.globalData.userid=""}}),a({key:"access_token"}),a({key:"refresh_token"}),a({key:"token_expired"}),k.globalData.userid=null,k.globalData.access_token=null,k.globalData.refresh_token=null,k.globalData.token_expired=null);let g=decodeURIComponent(d.url),u=parseInt(decodeURIComponent(d.scene));if(g=g.replace("huoniaowh","?").replace(/huoniaolj/g,"&").replace(/huoniaodh/g,"="),g=g.replace(/[?]/g,"&").replace("&","?"),g=k.addUrlParam(g),console.log("链接地址：",decodeURIComponent(g)),x.getTitle(),d.uid||d.userid){t({key:"userid",data:d.uid||d.userid,success:e=>{k.globalData.userid=d.uid||d.userid}}),t({key:"access_token",data:d.access_token}),t({key:"refresh_token",data:d.refresh_token});var p=Date.parse(new Date)/1e3+7200-20;t({key:"token_expired",data:p}),k.globalData.userid=d.uid,k.globalData.access_token=d.access_token,k.globalData.refresh_token=d.refresh_token,k.globalData.token_expired=p}if(d.redirectPath&&(d.redirectPath=d.redirectPath.replace("loginwh","?").replace(/loginlg/g,"&").replace(/logindh/g,"="),0==k.globalData.loginMode?c({delta:2,success:function(e){i({url:d.redirectPath})},fail:function(){i({url:d.redirectPath})}}):i({url:d.redirectPath})),u)console.log(u),n({title:"加载中..."}),x.$ajax.get({url:"include/ajax.php?service=siteConfig&action=getWxMiniProgramScene&scene="+u}).then((e=>{let a=e.data;if("100"==a.state){let e=a.info;if(e.indexOf("miniProgramLive_")>-1)i({url:"plugin-private://wx2b03c6e691cd7370/pages/live-player-plugin?room_id="+e.replace("miniProgramLive_","")});else if(e.includes("wxMiniprogram://")){let a=k.globalData.platForm;var n=e.replace("wxMiniprogram://",""),s=n.split("?/")[0],d=n.split("?/")[1],g=s.split("/")[0],u=s.split("/")[1],p=d?"/"+d:"";"web"==a&&window.appBoolean?window.setupWebViewJavascriptBridge((function(e){d&&d.indexOf("huoniao/")>-1?e.callHandler("redirectToWxMiniProgram",{id:g,path:d.replace("huoniao/","/pages/redirect/index?url=/")},(function(e){})):e.callHandler("redirectToWxMiniProgram",{id:g,path:d},(function(e){}))})):"mp-weixin"==a?uni.navigateToMiniProgram({appId:u,path:p,success(e){c()},fail(e){o({title:e,icon:"none",duration:2e3})}}):o({title:"请在微信小程序中打开",icon:"none",mask:!0})}else if(e.indexOf("http")<0)if(e.indexOf("cityid")>-1){console.log("发现cityid："+e);var f=e.split("?"),h=k.getUrlPara(f[1],"cityid");h?x.$ajax.post({url:k.globalData.masterDomain+"/include/ajax.php?service=siteConfig&action=cityInfoById&cityid="+h}).then((a=>{console.log("cityid信息："),console.log(a);var n=a.data;"100"==n.state&&(t({key:"cityInfo",data:JSON.stringify(n.info)}),k.globalData.cityInfo=n.info),i({url:e})})):i({url:e})}else i({url:e});else x.url=e;setTimeout((function(){l()}),2e3)}else l(),r({title:"温馨提示",content:a.info,showCancel:!1,success:function(e){e.confirm&&i({url:"/pages/index/index"})}})})).catch((e=>{l(),r({title:"温馨提示",content:"解析失败，请确认二维码是否过期！",showCancel:!1,success:function(e){e.confirm&&i({url:"/pages/index/index"})}})}));else{if(g.indexOf("%3A%2F%2F")>-1&&g.indexOf("://")<0&&(g=decodeURIComponent(g)),g.indexOf("path=/pages/")>-1&&-1==g.indexOf("http")){var f=k.getUrlPara(g,"path"),h=s()[0].__displayReporter.showReferpagepath;return"/pages/goback"==f?h?c({delta:1}):i({url:"/pages/index/index"}):i({url:f}),!1}g.indexOf("http")<0&&(g=k.globalData.masterDomain+g),n({title:"加载中..."}),x.url=g,setTimeout((function(){l()}),2e3)}},onShareAppMessage(e){let a=x.shareObj,t=a.title;return t=t||k.globalData.appConfig.share.title,{title:t,path:"/pages/redirect/index?url="+encodeURIComponent(a.link),success:function(e){console.log("成功")},fail:function(e){console.log("失败")}}},onShareTimeline:e=>({title:k.globalData.appConfig.share.title}),methods:{bindmessage(e){if(!e.detail)return;let a=e.detail.data;if(!a||0===a.length)return;let t=a[a.length-1];if(console.log("通讯数据：",t),x.shareObj=t,"微信小程序登录"==t.title)return console.log("小程序登录"),n({title:"授权中..."}),void k.login((function(){d({url:"/pages/redirect/index?url="+encodeURIComponent(t.link)})}));t.title?x.title=t.title:console.error("分享信息错误",a)},getTitle(){x.$ajax.get({url:"include/ajax.php?service=siteConfig&action=config"}).then((e=>{let a=e.data;if("100"==a.state){let e=a.info;g({title:e.shortName,success(e){console.log("setNavigationBarTitle 调用成功")},fail(e){console.log("setNavigationBarTitle 调用失败:",e.errMsg)}})}}))}}},[["render",function(e,a,t,i,n,o){const l=h;return u(),p(l,{src:n.url,onMessage:o.bindmessage},null,8,["src","onMessage"])}]]);export{b as default};
