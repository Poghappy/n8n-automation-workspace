import{a as e,P as a,i as t,j as s,h as l,b as d,c as o,d as i,e as r,r as n,R as p,k as c,o as u,l as m,w as f,m as v,q as g,A as h,t as _,v as y,y as k,F as b,x,G as j,B as w,C,H as F,I as D,D as B,W as S}from"./index-cF6skFzP.js";import{_ as T}from"./previewMedia.C3gYMXHd.js";import{r as V,_ as z}from"./uni-app.es.J1otcSEF.js";import{_ as $}from"./_plugin-vue_export-helper.BCo6x5W8.js";let U=v();var M;const P=$({data:()=>({wh:U.globalData.navTop+U.globalData.appFullWh,masterDomain:U.globalData.masterDomain,biasTop_88:U.globalData.biasTop_88,appBack:U.globalData.appBack,placeholderh:0,imgsrc:U.globalData.imgPath+"/task/",projectdata:{},themedata:{},popb:!1,privateb:!1,submitb:!1,warningb:!1,resetb:!1,previewb:!1,staticSrc:[],billdata:{},info:null,imgVersion:null,type:"",note:"",value:"",data:"",platForm:U.globalData.platForm,appFullWh:U.globalData.appFullWh}),onLoad(e){M=this,-1==U.globalData.wxprivate?U.watchG("wxprivate",(function(a){M.wxprivate=a,a?M.privateb=!0:M.onload(e)})):U.globalData.wxprivate?M.privateb=!0:M.onload(e)},onReady(){},onShow(){},onHide(){},onUnload(){},onPullDownRefresh(){},onReachBottom(){},onShareAppMessage(e){return{title:this.projectdata.title,imageUrl:this.themedata.sharePic,path:"/pages/packages/task/my/my"}},onShareTimeline(){return{title:this.projectdata.title,imageUrl:this.themedata.sharePic,path:"/pages/packages/task/my/my"}},methods:{onload(i){M.imgVersion=U.globalData.imgVersion,M.resetb=1==i.reset,e({title:"加载中",mask:!0,success:()=>{a({key:"warnColor",success:e=>{a({key:"warnColor",success:e=>{M.themedata=e.data.themeDate,M.setBgColor(this.themedata.themeBackgroundColor),e.data.outtime<Date.parse(new Date)&&t({key:"warnColor",success:()=>{M.$ajax.post({url:"include/ajax.php?service=task&action=config"}).then((e=>{null!=e.data.info.themeBackgroundColor?(M.themedata=e.data.info,s({key:"warnColor",data:{themeDate:this.themedata,nowarning:this.nowarningb,outtime:Date.parse(new Date)+36e5}}),M.setBgColor(this.themedata.themeBackgroundColor),l()):(l(),d({title:"服务器出错",icon:"error",mask:!0,duration:5e3}))}))}})}}),l()},fail:e=>{M.$ajax.post({url:"include/ajax.php?service=task&action=config"}).then((e=>{null!=e.data.info.themeBackgroundColor?(M.themedata=e.data.info,s({key:"warnColor",data:{themeDate:this.themedata,nowarning:this.nowarningb,outtime:Date.parse(new Date)+36e5}}),M.setBgColor(this.themedata.themeBackgroundColor),l()):(l(),d({title:"服务器出错",icon:"error",mask:!0,duration:5e3}))}))}})}});var r="service=task&action=detail&id="+i.id,n=U.encodeUrl(r);M.$ajax.post({url:"include/ajax.php?"+n}).then((e=>{for(let t=0;t<e.data.info.steps.length;t++)"save-text"!=e.data.info.steps[t].type&&(e.data.info.steps[t].value=e.data.info.steps[t].value.split("<br/>").join("\n")),e.data.info.steps[t].note=e.data.info.steps[t].note.split("<br/>").join("\n");M.projectdata=e.data.info;let a=o();a.select(".modify").boundingClientRect(),a.exec((e=>{M.placeholderh=e[0].height})),this.projectdata.order_data.tj_data.map((e=>{this.projectdata.steps[e.step-1].data=e.value}))}))},backFn(){if(M.appBoolean)return window.setupWebViewJavascriptBridge((function(e){e.callHandler("goBack",{},(function(e){}))})),!1;{let e=i();e&&e.length>1?r({delta:1}):"web"==M.platForm?location.href=`${M.masterDomain}${window.pathname}${M.pages.index}`:n({url:"/pages/packages/task/index/index"})}},setBgColor(e){"web"!=M.platForm&&uni.setBackgroundColor({backgroundColor:e,fail:e=>{console.log(e)}})},uploadFn(e){if("video"==e.currentTarget.dataset.type){let a={mod:"task",type:"video",filetype:"video",utype:"video"};this.$ajax.upMedia({seFile:!0,type:"video",formData:a}).then((a=>{let t=JSON.parse(a.data);if("SUCCESS"!=t.state)M.info=t.state,this.warningFn();else{let a=e.currentTarget.dataset.index;this.projectdata.steps[a].data=t.turl}}))}else{let a={mod:"task",type:"atlas"};this.$ajax.upMedia({seFile:!0,type:"image",formData:a,upConfig:{count:1}}).then((a=>{let t=JSON.parse(a[0].data);if("SUCCESS"!=t.state)M.info=t.state,this.warningFn();else{let a=e.currentTarget.dataset.index;this.projectdata.steps[a].data=t.turl}}))}},deleteimgFn(e){let a=e.currentTarget.dataset.index;this.projectdata.steps[a].data="",M.projectdata=this.projectdata},previewFn(e){"mp-weixin"==M.platForm?uni.previewMedia({sources:[{type:-1!=e.type.indexOf("image")?"image":"video",url:e.value}]}):e.type.includes("image")?p({urls:[e.value]}):(this.previewb=!0,this.staticSrc[0]={type:"video",value:e.value})},inputFn(e){let a=e.currentTarget.dataset.index;this.projectdata.steps[a].data=e.detail.value,M.projectdata=this.projectdata},confirmFn(e){let a=e.currentTarget.dataset.state;M.billdata="giveup"==a?{title:"放弃修改",state:"giveup"}:{title:this.resetb?"确认提交":"确认修改",state:"confirm"},M.popb=!0,M.submitb=!0},agreeFn(a){if("giveup"==a.currentTarget.dataset.state)this.backFn();else{let a=[];this.projectdata.steps.map(((e,t)=>{e.data&&(a[t]={type:e.type,value:e.data})})),a=a.filter((e=>e));let t="service=task&action=modifyOrder&id="+this.projectdata.order_data.orderid,s=U.encodeUrl(t);e({title:"加载中",mask:!0}),M.$ajax.post({url:"include/ajax.php?"+s,data:{data:JSON.stringify(a)}}).then((e=>{l(),M.warningb=!0,M.info=e.data.info,M.popb=!1,M.submitb=!1,setTimeout((()=>{M.warningb=!1,r()}),2e3)}))}},closeFn(){M.popb=!1,M.submitb=!1}}},[["render",function(e,a,t,s,l,d){const o=g,i=C,r=D,n=B,p=S,v=V(c("previewMedia"),T),$=V(c("private_tip"),z);return u(),m(o,{style:{height:"100%"}},{default:f((()=>[l.appBack?(u(),h(b,{key:0},[_(o,{style:y("height:"+l.wh+"px;background-color: "+l.themedata.themeBackgroundColor+";position: sticky;top: 0rpx;z-index: 99;padding-bottom: 88rpx;"),catchtouchmove:""},null,8,["style"]),_(o,{class:"rec-title",style:y("background-color: "+l.themedata.themeBackgroundColor+";top: "+(l.wh+l.biasTop_88)+"px;")},{default:f((()=>[_(i,{src:l.imgsrc+"bl-arrow.png?v="+l.imgVersion,onClick:d.backFn,mode:"aspectFill"},null,8,["src","onClick"]),_(o,null,{default:f((()=>[k("修改提交内容")])),_:1})])),_:1},8,["style"])],64)):x("",!0),_(o,{class:"wp-step"},{default:f((()=>[_(o,{class:"wps-title"},{default:f((()=>[_(o,{class:"text"},{default:f((()=>[k("任务步骤")])),_:1})])),_:1}),_(o,{class:"wps-deposit"},{default:f((()=>[_(o,{class:"title"},{default:f((()=>[_(i,{src:l.imgsrc+"warning.png?v="+l.imgVersion,mode:"aspectFill"},null,8,["src"]),_(o,{class:"title"},{default:f((()=>[k("领取条件/限制")])),_:1})])),_:1}),_(o,{class:"object"},{default:f((()=>[k(j(l.projectdata.note),1)])),_:1})])),_:1}),(u(!0),h(b,null,w(l.projectdata.steps,((e,a)=>(u(),m(o,{class:"wps-step",key:a},{default:f((()=>["website"==l.projectdata.steps[a].type?(u(),m(o,{key:0,class:"login"},{default:f((()=>[_(o,{class:"title"},{default:f((()=>[_(o,{class:"step"},{default:f((()=>[_(o,{style:{position:"relative","z-index":"1"}},{default:f((()=>[k("步骤"+j(a+1),1)])),_:2},1024)])),_:2},1024),_(o,{class:"text"},{default:f((()=>[k(j(l.projectdata.steps[a].note),1)])),_:2},1024)])),_:2},1024),_(o,{class:"borders"},{default:f((()=>[_(o,{class:"copyurl"},{default:f((()=>[k("复制链接")])),_:1})])),_:1})])),_:2},1024)):x("",!0),"qr"==l.projectdata.steps[a].type?(u(),m(o,{key:1,class:"code"},{default:f((()=>[_(o,{class:"title"},{default:f((()=>[_(o,{class:"step"},{default:f((()=>[_(o,{style:{position:"relative","z-index":"1"}},{default:f((()=>[k("步骤"+j(a+1),1)])),_:2},1024)])),_:2},1024),_(o,{class:"text"},{default:f((()=>[k(j(l.projectdata.steps[a].note),1)])),_:2},1024)])),_:2},1024),_(o,{class:"borders"},{default:f((()=>[_(i,{src:l.projectdata.steps[a].value,onClick:F((e=>d.previewFn({type:"image",value:l.projectdata.steps[a].value})),["stop","prevent"]),"data-index":a,"data-value":l.projectdata.steps[a].value,mode:"aspectFill"},null,8,["src","onClick","data-index","data-value"])])),_:2},1024)])),_:2},1024)):x("",!0),"copy"==l.projectdata.steps[a].type?(u(),m(o,{key:2,class:"invite"},{default:f((()=>[_(o,{class:"title"},{default:f((()=>[_(o,{class:"step"},{default:f((()=>[_(o,{style:{position:"relative","z-index":"1"}},{default:f((()=>[k("步骤"+j(a+1),1)])),_:2},1024)])),_:2},1024),_(o,{class:"text"},{default:f((()=>[k(j(l.projectdata.steps[a].note),1)])),_:2},1024)])),_:2},1024),_(o,{class:"borders"},{default:f((()=>[_(r,{type:"text",disabled:"",value:l.projectdata.steps[a].value},null,8,["value"]),_(o,null,{default:f((()=>[k("复制数据")])),_:1})])),_:2},1024)])),_:2},1024)):x("",!0),"image"==l.projectdata.steps[a].type?(u(),m(o,{key:3,class:"inputcode"},{default:f((()=>[_(o,{class:"title"},{default:f((()=>[_(o,{class:"step"},{default:f((()=>[_(o,{style:{position:"relative","z-index":"1"}},{default:f((()=>[k("步骤"+j(a+1),1)])),_:2},1024)])),_:2},1024),_(o,{class:"text"},{default:f((()=>[k(j(l.projectdata.steps[a].note),1)])),_:2},1024)])),_:2},1024),_(o,{class:"borders"},{default:f((()=>[_(i,{src:l.projectdata.steps[a].value,onClick:F((e=>d.previewFn({type:"image",value:l.projectdata.steps[a].value})),["stop","prevent"]),"data-index":a,"data-value":l.projectdata.steps[a].value,mode:"aspectFill"},null,8,["src","onClick","data-index","data-value"]),_(o,{class:"imgLabel"},{default:f((()=>[k("说明图")])),_:1})])),_:2},1024)])),_:2},1024)):x("",!0),"text"==l.projectdata.steps[a].type?(u(),m(o,{key:4,class:"destext"},{default:f((()=>[_(o,{class:"title"},{default:f((()=>[_(o,{class:"step"},{default:f((()=>[_(o,{style:{position:"relative","z-index":"10"}},{default:f((()=>[k("步骤"+j(a+1),1)])),_:2},1024)])),_:2},1024),_(o,{class:"text"},{default:f((()=>[k(j(l.projectdata.steps[a].note),1)])),_:2},1024)])),_:2},1024),_(o,{class:"borders"},{default:f((()=>[_(n,null,{default:f((()=>[k(j(l.projectdata.steps[a].value),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)):x("",!0),"video"==l.projectdata.steps[a].type?(u(),m(o,{key:5,class:"desvideo"},{default:f((()=>[_(o,{class:"title"},{default:f((()=>[_(o,{class:"step"},{default:f((()=>[_(o,{style:{position:"relative","z-index":"10"}},{default:f((()=>[k("步骤"+j(a+1),1)])),_:2},1024)])),_:2},1024),_(o,{class:"text"},{default:f((()=>[k(j(l.projectdata.steps[a].note),1)])),_:2},1024)])),_:2},1024),_(o,{class:"borders"},{default:f((()=>[_(p,{src:l.projectdata.steps[a].value,onClick:F((e=>d.previewFn(l.projectdata.steps[a])),["stop","prevent"]),"data-index":a,"data-video":"video",controls:!1,"show-center-play-btn":!1,"data-value":l.projectdata.steps[a].value},{default:f((()=>[_(i,{class:"pause",src:l.imgsrc+"pause.png?v="+l.imgVersion,mode:"aspectFill"},null,8,["src"])])),_:2},1032,["src","onClick","data-index","data-value"]),_(o,{class:"imgLabel"},{default:f((()=>[k("说明视频")])),_:1})])),_:2},1024)])),_:2},1024)):x("",!0),"save-video"==l.projectdata.steps[a].type?(u(),m(o,{key:6,class:"desvideo"},{default:f((()=>[_(o,{class:"title"},{default:f((()=>[_(o,{class:"step"},{default:f((()=>[_(o,{style:{position:"relative","z-index":"10"}},{default:f((()=>[k("步骤"+j(a+1),1)])),_:2},1024)])),_:2},1024),_(o,{class:"text"},{default:f((()=>[k(j(l.projectdata.steps[a].note),1)])),_:2},1024)])),_:2},1024),_(o,{class:"borders"},{default:f((()=>[_(p,{src:l.projectdata.steps[a].value,onClick:F((e=>d.previewFn(l.projectdata.steps[a])),["stop","prevent"]),"data-index":a,"data-video":"video",controls:!1,"show-center-play-btn":!1,"data-value":l.projectdata.steps[a].value},{default:f((()=>[_(i,{class:"pause",src:l.imgsrc+"pause.png?v="+l.imgVersion,mode:"aspectFill"},null,8,["src"])])),_:2},1032,["src","onClick","data-index","data-value"]),l.projectdata.steps[a].data?(u(),m(p,{key:0,class:"addedvideo",src:l.projectdata.steps[a].data,controls:!1,"show-center-play-btn":!1,onClick:F((e=>d.previewFn({type:"video",value:l.projectdata.steps[a].value})),["stop","prevent"]),"data-video":"video","data-index":a,"data-value":l.projectdata.steps[a].data},{default:f((()=>[_(i,{src:l.imgsrc+"radiusClose.png?v="+l.imgVersion,class:"close",onClick:F(d.deleteimgFn,["stop","prevent"]),"data-index":a,mode:"aspectFill"},null,8,["src","onClick","data-index"]),_(i,{class:"pause",src:l.imgsrc+"pause.png?v="+l.imgVersion,mode:"aspectFill"},null,8,["src"])])),_:2},1032,["src","onClick","data-index","data-value"])):x("",!0),l.projectdata.steps[a].data?x("",!0):(u(),m(o,{key:1,class:"addvideo","data-state":"0",onClick:d.uploadFn,"data-index":a,"data-type":"video"},{default:f((()=>[_(o,{style:{"text-align":"center"}},{default:f((()=>[_(i,{src:l.imgsrc+"crossadd.png?v="+l.imgVersion,mode:"aspectFill"},null,8,["src"]),_(o,{class:"text"},{default:f((()=>[k("添加视频")])),_:1})])),_:1})])),_:2},1032,["onClick","data-index"])),_(o,{class:"imgLabel"},{default:f((()=>[k("提交视频")])),_:1})])),_:2},1024)])),_:2},1024)):x("",!0),"save-image"==l.projectdata.steps[a].type?(u(),m(o,{key:7,class:"cutimg"},{default:f((()=>[_(o,{class:"title"},{default:f((()=>[_(o,{class:"step"},{default:f((()=>[_(o,{style:{position:"relative","z-index":"1"}},{default:f((()=>[k("步骤"+j(a+1),1)])),_:2},1024)])),_:2},1024),_(o,{class:"text"},{default:f((()=>[k(j(l.projectdata.steps[a].note),1)])),_:2},1024)])),_:2},1024),_(o,{class:"borders"},{default:f((()=>[_(i,{class:"showimg",src:l.projectdata.steps[a].value,onClick:F((e=>d.previewFn({type:"image",value:l.projectdata.steps[a].value})),["stop","prevent"]),"data-index":a,mode:"aspectFill","data-value":l.projectdata.steps[a].value},null,8,["src","onClick","data-index","data-value"]),l.projectdata.steps[a].data?(u(),m(o,{key:0,class:"addedimg"},{default:f((()=>[_(i,{src:l.projectdata.steps[a].data,class:"picture",onClick:F((e=>d.previewFn({type:"image",value:l.projectdata.steps[a].value})),["stop","prevent"]),"data-index":a,mode:"aspectFill","data-value":l.projectdata.steps[a].data},null,8,["src","onClick","data-index","data-value"]),_(i,{src:l.imgsrc+"radiusClose.png?v="+l.imgVersion,class:"close",onClick:d.deleteimgFn,"data-index":a,mode:"aspectFill"},null,8,["src","onClick","data-index"])])),_:2},1024)):x("",!0),l.projectdata.steps[a].data?x("",!0):(u(),m(o,{key:1,class:"addimg",onClick:d.uploadFn,"data-index":a,"data-type":"image"},{default:f((()=>[_(o,{style:{"text-align":"center"}},{default:f((()=>[_(i,{src:l.imgsrc+"crossadd.png?v="+l.imgVersion,mode:"aspectFill"},null,8,["src"]),_(o,{class:"text"},{default:f((()=>[k("添加图片")])),_:1})])),_:1})])),_:2},1032,["onClick","data-index"])),_(o,{class:"imgLabel"},{default:f((()=>[k("说明图")])),_:1})])),_:2},1024)])),_:2},1024)):x("",!0),"save-text"==l.projectdata.steps[a].type?(u(),m(o,{key:8,class:"in-name"},{default:f((()=>[_(o,{class:"title"},{default:f((()=>[_(o,{class:"step"},{default:f((()=>[_(o,{style:{position:"relative","z-index":"1"}},{default:f((()=>[k("步骤"+j(a+1),1)])),_:2},1024)])),_:2},1024),_(o,{class:"text"},{default:f((()=>[k(j(l.projectdata.steps[a].note),1)])),_:2},1024)])),_:2},1024),_(r,{type:"text",placeholder:"请按提示要求输入文内容","placeholder-style":"font-size: 26rpx;color: #999999;","data-index":a,onBlur:d.inputFn,value:l.projectdata.steps[a].data},null,8,["data-index","onBlur","value"])])),_:2},1024)):x("",!0)])),_:2},1024)))),128))])),_:1}),_(o,{style:y("height: "+l.placeholderh+"px;width: 100%;")},null,8,["style"]),_(o,{class:"modify"},{default:f((()=>[_(o,{class:"m-content",onClick:d.confirmFn,"data-state":"giveup",style:y("color: "+l.themedata.themeBackgroundColor+";border-color: "+l.themedata.themeBackgroundColor+";")},{default:f((()=>[k(" 放弃修改 ")])),_:1},8,["onClick","style"]),_(o,{class:"l-submit",onClick:d.confirmFn,"data-state":"agree",style:y("background-color: "+l.themedata.themeBackgroundColor+";")},{default:f((()=>[k(j(l.resetb?"重新提交":"确认修改"),1)])),_:1},8,["onClick","style"])])),_:1}),_(o,{class:"pop-warning",style:y(l.warningb?"transform:scale(1);":"transform:scale(0);z-index:-1;")},{default:f((()=>[_(o,{class:"text",style:{transform:"translate(-50%, -50%)"}},{default:f((()=>[k(j(l.info),1)])),_:1})])),_:1},8,["style"]),_(o,{class:"pop-rules",style:y("display: "+(l.popb?"block":"none")+" ;")},{default:f((()=>[_(o,{class:"pr-confirm",style:y("display: "+(l.submitb?"block":"none")+";")},{default:f((()=>[_(o,{class:"title"},{default:f((()=>[k("请确认是否"+j(l.billdata.title)+"？",1)])),_:1}),_(o,{class:"btn"},{default:f((()=>[_(o,{class:"back",onClick:d.closeFn},{default:f((()=>[k("返回")])),_:1},8,["onClick"]),_(o,{class:"sconfirm",onClick:d.agreeFn,"data-state":l.billdata.state,style:y("background: "+l.themedata.themeBackgroundColor+";")},{default:f((()=>[k(j(l.billdata.title),1)])),_:1},8,["onClick","data-state","style"])])),_:1})])),_:1},8,["style"])])),_:1},8,["style"]),_(v,{previewb:l.previewb,staticSrc:l.staticSrc,onPreviewClose:a[0]||(a[0]=e=>l.previewb=!1)},null,8,["previewb","staticSrc"]),_($,{privateShow:l.privateb},null,8,["privateShow"])])),_:1})}],["__scopeId","data-v-e17c3b72"]]);export{P as default};
