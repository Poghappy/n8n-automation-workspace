import{af as a,q as e,m as t,a3 as l,ag as o,x as n,ah as s,M as i,ai as c,s as r,U as d,aj as g,Z as u,g as h,o as p,a as m,w as f,b as y,D as k,e as b,d as v,t as _,B as C,E as x,F as I,C as D,a5 as B,G as w,I as T,i as P,f as F,L as M,S,K as L,c as V}from"./index-160de7c6.js";import{b as N,_ as j}from"./job.cbea1f04.js";const H=h();const U=j({components:{bottomNav:N},data:()=>({globalData:H.globalData,navTop:H.globalData.navTop,menuTop:0,navLeft:0,offTop:0,imgVersion:H.globalData.imgVersion,imgPath:H.globalData.imgPath,headMenuShow:!1,msgNum:0,cityurl:"/pages/redirect/index?url="+H.globalData.masterDomain+"/changecity.htmlhuoniaowhcurrentPageOpenhuoniaodh1huoniaoljbackModulehuoniaodhinfohuoniaoljfromOriginalhuoniaodh1",grayscale:"1"==H.globalData.appConfig.sitePageGray||"2"==H.globalData.appConfig.sitePageGray?"grayscale":"",lng:"",lat:"",cityNum:"",navList:[],msgNumClone:0,cityInfoClone:{name:""},homeBackClone:!1,showClone:!1,navWidth:0,platForm:H.globalData.platForm,click_disabled:!1,timerHead:null}),props:{ifIndex:{type:Boolean,default:!1},headerTitle:{type:String,default:"分类信息"},headerBgImg:{type:Boolean,default:!1},headerBgOpacity:{type:String,default:"1"},headerBg:{type:String,default:"#fff"},headerBack:{type:Boolean,default:!0},homeBack:{type:Boolean,default:!1},pullend:{type:Boolean,default:!1},backOnly:{type:Boolean,default:!1},noBorder:{type:Boolean,default:!1},module:{type:String,default:"info"},activeIndex:{type:Number,default:0},showBottom:{type:Boolean,default:!1},cityInfo:{type:Object,default:{name:H.globalData.cityInfo.name?H.globalData.cityInfo.name:"加载中",cityid:H.globalData.cityInfo.cityid}},posiInfo:{type:Object,default:{address:"定位中"}},scanIcon:{type:Boolean,default:!1},temp:{type:String,default:" "},searchInp:{type:Boolean,default:!1},searchHot:{type:Array,default:[]},needMessage:{type:Boolean,default:!1},pageHide:{type:Boolean,default:!1},show:{type:Boolean,default:!1},rightGrow:{type:Boolean,default:!1},backDefine:{type:String,default:""}},mounted(){"mp-weixin"==H.globalData.platForm?(this.wexin(),this.$nextTick((a=>{this.attached()}))):"mp-toutiao"==H.globalData.platForm?this.toutiao():H.globalData.platForm,this.handlePageShow()},unmounted(){clearInterval(this.timerHead)},methods:{pageChangeVisible(a){a?this.needMessage&&Boolean(H.globalData.userid)&&(this.timerHead=setInterval((a=>{this.getMessage()}),5e3),this.pageShowCheck(5)):clearInterval(this.timerHead)},attached(){const e=this;a({success:a=>{if("windows"==a.platform)H.globalData.biasTop_88=0,e.offTop=0;else if(0!=H.globalData.biasTop_88){e.offTop=H.globalData.biasTop_88;var t=uni.getMenuButtonBoundingClientRect();e.navWidth=t.width}else{t=uni.getMenuButtonBoundingClientRect();e.navWidth=t.width;const a=V().in(this);this.$nextTick((l=>{a.select(".head").boundingClientRect((a=>{e.offTop=-(a.height-t.height)/2-(e.navTop-e.menuTop),H.globalData.biasTop_88=e.offTop})).exec()}))}}})},handlePageShow(){var a=this;if("web"!=a.platForm){let e=uni.getMenuButtonBoundingClientRect();a.menuTop=e.top}a.grayscale="1"==H.globalData.appConfig.sitePageGray||"2"==H.globalData.appConfig.sitePageGray?"grayscale":"",e({key:"cityInfo",success(e){console.log(typeof e.data),a.cityInfoClone="string"==typeof e.data?JSON.parse(e.data):e.data;try{var l=t("currlocation");l?(a.lng=l.split(",")[0],a.lat=l.split(",")[1]):a.getCurrLocation()}catch(o){console.log("CatchClause",o),console.log("CatchClause",o),a.getCurrLocation()}},fail(l){console.log(l);try{var o=t("currlocation");o?(a.lng=o.split(",")[0],a.lat=o.split(",")[1],H.globalData.cityInfo={},H.getCityInfo(o.split(",")[0],o.split(",")[1])):a.getCurrLocation()}catch(s){console.log("CatchClause",s),console.log("CatchClause",s),a.getCurrLocation()}var n=setInterval((function(){e({key:"cityInfo",success(e){a.cityInfoClone=e.data,clearInterval(n)}})}),1e3)}}),1==l().length&&(this.homeBackClone=!0);var o=setInterval((function(){H.globalData.cityNum&&(a.cityNum=H.globalData.cityNum,clearInterval(o))}),1e3),n=setInterval((function(){H.globalData.appConfig&&H.globalData.appConfig.cfg_user_index&&(a.navList=[{url:"/pages/index/index",title:"返回首页",icon:"home_icon.png",type:"3"},{url:H.addUrlParam(H.globalData.appConfig.cfg_user_index+"/message.html"),title:"消息",icon:"msg_icon.png",type:"2",msg:!0},{url:H.addUrlParam(H.globalData.appConfig.cfg_user_index),title:"个人中心",icon:"member_icon.png",type:"2"},{url:H.addUrlParam(H.globalData.appConfig.cfg_user_index+"/collection.html?module=info"),title:"我的收藏",icon:"star_icon.png",type:"2"},{url:H.addUrlParam(H.globalData.appConfig.cfg_user_index+"/history?module=info"),title:"我的足迹",icon:"clock_icon.png",type:"2"}],clearInterval(n))}),1e3);a.getMessage(),a.needMessage&&(console.log("测试1"),this.timerHead=setInterval((function(){a.getMessage()}),5e3)),Boolean(H.globalData.userid)&&a.pageShowCheck(5)},wexin(){const a=uni.getMenuButtonBoundingClientRect();this.navLeft=a.left-10+"px",this.showClone=!0,this.platForm="mp-weixin"},toutiao(){this.navLeft="100%",this.platForm="mp-toutiao"},handlePageResize(a){},backIndex(){this.$emit("backIndex",{detail:{}})},homeBackFun(){o({url:"/pages/index/index"})},goback(){H.backFn("/pages/index/index")},showMenu(a){this.headMenuShow=!0},hideMenu(a){this.headMenuShow=!1},goLink(a){var e=a.currentTarget,t=e.dataset.url;if(!t)return!1;1==e.dataset.type?n({url:H.addUrlParam(t)}):2==e.dataset.type?n({url:"/pages/redirect/index?url="+t.replace("?","huoniaowh").replace(/&/g,"huoniaolj").replace(/=/g,"huoniaodh")}):3==e.dataset.type?o({url:H.addUrlParam(t)}):o({url:"/pages/index/index"})},getMessage(){var a=this;if(t("access_token")){var e=H.encodeUrl("service=member&action=message&type=tongji&im=1");this.$ajax.post({url:"include/ajax.php?"+e}).then((e=>{var l=e.data;100==l.state?a.msgNum=l.info.pageInfo.total>99?"99+":l.info.pageInfo.total:"用户信息验证失败"==l.info&&setTimeout((function(){t("access_token")?c.unit(t("refresh_token"),H.globalData.masterDomain,(function(a){if(100==a.state){console.log("更新成功"),console.log(a.info);var e=a.info.access_token,t=a.info.refresh_token;r({key:"access_token",data:e}),r({key:"refresh_token",data:t});var l=Date.parse(new Date)/1e3+7200-20;r({key:"token_expired",data:l}),H.globalData.access_token=e,H.globalData.refresh_token=t,H.globalData.token_expired=l}else{i({key:"userid"}),i({key:"access_token"}),i({key:"refresh_token"}),i({key:"token_expired"}),H.globalData.userid=null,H.globalData.access_token=null,H.globalData.refresh_token=null,H.globalData.token_expired=null;var o=encodeURIComponent(H.globalData.masterDomain+"/logout.html?redirect="+H.globalData.masterDomain+"/login.html");d({url:"/pages/redirect/index?url="+encodeURIComponent(o),success:a=>{console.log("跳转")}})}})):(s({title:"账号状态异常，请重新登录！",icon:"none",duration:2e3}),i({key:"userid"}),i({key:"access_token"}),i({key:"refresh_token"}),i({key:"token_expired"}),H.globalData.userid=null,H.globalData.access_token=null,H.globalData.refresh_token=null,H.globalData.token_expired=null,H.tologin("/pages/goback"))}),1e3)}))}else a.msgNum=0},getCurrLocation(){var a=this;H.globalData.locationFn({type:"web"==a.platForm?"wgs84":"gcj02",success(e){const t=e.latitude||e.lat,l=e.longitude||e.lng;a.lng=e.longitude||e.lng,a.lat=e.latitude||e.lat,H.globalData.lnglat=t+","+l,r({key:"currlocation",data:l+","+t}),H.globalData.cityInfo={},H.getCityInfo(l,t)},fail(e){console.log(a.platForm,666);try{var l=t("cityInfo");l?H.globalData.cityInfo=l:H.getdefaultCity()}catch(o){console.log("CatchClause",o),console.log("CatchClause",o),H.getdefaultCity()}}})},scanQr(){g({success(a){var e=a.result;/^((http|https):\/\/)?(([A-Za-z0-9]+-[A-Za-z0-9]+|[A-Za-z0-9]+)\.)+([A-Za-z]+)[/\?\:]?.*$/.test(e)?n({url:"/pages/redirect/index?url="+e.replace("?","huoniaowh").replace(/&/g,"huoniaolj").replace(/=/g,"huoniaodh")}):"EAN_13"==a.scanType?n({url:"/pages/redirect/index?url="+encodeURIComponent(H.globalData.masterDomain+"/include/ajax.php?service=shop&action=barcodeSearch&type=redirect&code="+e)}):u({title:"扫码结果",content:a.result,showCancel:!1})}})},toSearchPage(a){if(e=a.currentTarget.dataset.url)this.goLink(a);else{var e=H.globalData.masterDomain,l=0,o=t("cityInfo");o&&(l=o.cityid),n({url:"/pages/redirect/index?url="+encodeURIComponent(e+"/siteSearch.html?cityid="+l)})}},catchTouchMove(){console.log("占位：函数 catchTouchMove 未声明")},gobackFn(){const a=this;if(a.click_disabled)return!1;a.click_disabled=!0;let e=l();if(a.$nextTick((()=>{a.click_disabled=!1})),"web"==H.globalData.platForm){document.body.style.overflow="",document.removeEventListener("touchmove",(function(a){a.preventDefault()}),!1)}if("web"==H.globalData.platForm&&H.globalData.webMini)return jWeixin.miniProgram.navigateBack(),!1;"web"!=H.globalData.platForm||H.globalData.appBoolean||e&&e.length>1?H.backFn(this.module?`/pages/packages/${this.module}/index/index`:"/pages/index/index",H.globalData.masterDomain):window.history.go(-1)},pageShowCheck(a){const e=this;let t=a,l=5;switch(a){case 5:t=10,l=10;break;case 10:t=20,l=20;break;case 20:t=30,l=30;break;case 30:t=60,l=60;break;case 60:t=0,l=0}setTimeout((()=>{clearInterval(e.timerHead),a&&l&&(e.timerHead=setInterval(this.getMessage,1e3*l)),t&&e.pageShowCheck(t)}),60*a*1e3)}},watch:{cityInfo:{handler(a,e){this.cityInfoClone=a},immediate:!0},homeBack:{handler(a,e){this.homeBackClone=a},immediate:!0},pageHide(a,e){a?clearInterval(this.timerHead):Boolean(H.globalData.userid)&&(this.timerHead=setInterval((a=>{this.getMessage()}),5e3))}}},[["render",function(a,e,t,l,o,n){const s=T,i=P,c=F,r=M,d=S,g=L("bottom-nav");return t.show||o.showClone?(p(),m(i,{key:0,style:k(`height: calc(${o.navTop||0}px + 88rpx)`)},{default:f((()=>[y(i,{class:D("headTop "+o.grayscale),style:k("padding-top:"+o.navTop+"px; background-color:"+t.headerBg+"; ")},{default:f((()=>[y(i,{class:"headBgBox headBg",style:k("padding-top:"+o.navTop+"px; opacity:"+(t.headerBgImg?1:0))},{default:f((()=>["siteConfig"!=t.module&&t.headerBgImg?(p(),m(s,{key:0,src:o.imgPath+"/"+t.module+"/bg_index.png?v="+o.imgVersion,mode:"widthFix",class:"headBgImg img"},null,8,["src"])):b("",!0)])),_:1},8,["style"]),y(i,{class:"head",style:k("margin-top:"+o.offTop+"px")},{default:f((()=>["siteConfig"==t.module?(p(),m(i,{key:0,class:"headCon",style:k(`width:${o.navLeft}`)},{default:f((()=>[o.cityNum>1?(p(),m(i,{key:0,class:"city index","data-url":"/pages/changeCity/index?module=siteConfig",onClick:n.goLink,"data-type":"1"},{default:f((()=>[y(c,null,{default:f((()=>[v(_(o.cityInfoClone.name),1)])),_:1}),y(s,{class:"arr",src:o.imgPath+"/info/arr_down.png?v="+o.imgVersion,mode:"widthFix"},null,8,["src"])])),_:1},8,["onClick"])):b("",!0),y(i,{class:"searchInp"},{default:f((()=>[y(i,{class:"searchIcon"},{default:f((()=>[y(s,{src:o.imgPath+"/skin1/search_icon.png?v="+o.imgVersion,mode:"aspectFit"},null,8,["src"])])),_:1}),y(i,{class:"swiperBox"},{default:f((()=>[y(d,{class:"searchSwipe search",interval:"2000",circular:!0,autoplay:t.searchHot.length>0,vertical:!0},{default:f((()=>[t.searchHot.length>0?(p(!0),C(I,{key:0},x(t.searchHot,((a,e)=>(p(),m(r,{key:e,"data-keys":a.oldkeyword,onTouchmove:w(n.catchTouchMove,["stop","prevent"]),onClick:n.toSearchPage,"data-url":"","data-type":"2"},{default:f((()=>[y(i,{class:"searchInp"},{default:f((()=>[v(_(a.oldkeyword),1)])),_:2},1024)])),_:2},1032,["data-keys","onTouchmove","onClick"])))),128)):b("",!0),0==t.searchHot.length?(p(),m(r,{key:1,onClick:n.toSearchPage,"data-url":"",class:"swiperItem"},{default:f((()=>[y(i,{class:"searchInp"},{default:f((()=>[v("搜索")])),_:1})])),_:1},8,["onClick"])):b("",!0)])),_:1},8,["autoplay"])])),_:1})])),_:1}),y(i,{class:"scanIcon",onClick:n.scanQr},{default:f((()=>[y(s,{src:o.imgPath+"/skin1/scanIcon.png?v="+o.imgVersion,mode:"aspectFit"},null,8,["src"])])),_:1},8,["onClick"])])),_:1},8,["style"])):"waimai"!=t.module||t.backOnly?"job"==t.module?(p(),m(i,{key:2,class:"headerCon"},{default:f((()=>[y(i,{class:"leftCon",onClick:n.gobackFn},{default:f((()=>[t.ifIndex&&t.headerBack?b("",!0):(p(),m(i,{key:0,class:D("headBtns "+(!t.headerBack||t.backOnly?"circle":"")+" "+(t.noBorder?"noCircle":""))},{default:f((()=>[y(i,{class:"navBack navbtn"},{default:f((()=>[t.backDefine?(p(),m(s,{key:1,class:"navbtnImg img",src:t.backDefine,mode:"aspectFill"},null,8,["src"])):(p(),m(s,{key:0,class:"navbtnImg img",src:o.imgPath+"/info/navBack.png?v="+o.imgVersion,mode:"aspectFill"},null,8,["src"]))])),_:1})])),_:1},8,["class"])),y(i,{class:"headerTitle"},{default:f((()=>[B(a.$slots,"headTitle",{},void 0,!0)])),_:3})])),_:3},8,["onClick"]),y(i,{class:"rightBtns",style:k(t.rightGrow?"flex-grow:1;":"")},{default:f((()=>[B(a.$slots,"rightbtns",{},void 0,!0)])),_:3},8,["style"])])),_:3})):(p(),C(I,{key:3},[t.ifIndex&&t.headerBack?t.ifIndex&&o.cityNum>1?(p(),m(i,{key:1,class:"city","data-url":"/pages/changeCity/index?module="+t.module,onClick:n.goLink,"data-type":"3"},{default:f((()=>[y(c,null,{default:f((()=>[v(_(o.cityInfoClone.name),1)])),_:1}),y(s,{class:"arr img",src:o.imgPath+"/info/arr_down.png?v="+o.imgVersion,mode:"widthFix"},null,8,["src"])])),_:1},8,["data-url","onClick"])):b("",!0):(p(),m(i,{key:0,class:D("headBtns "+(!t.headerBack||t.backOnly?"circle":"")+" "+(t.noBorder?"noCircle":""))},{default:f((()=>[t.headerBack&&!o.homeBackClone?(p(),m(i,{key:0,class:"navBack navbtn",onClick:n.goback},{default:f((()=>[y(s,{class:"navbtnImg img",src:o.imgPath+"/info/navBack.png?v="+o.imgVersion,mode:"aspectFill"},null,8,["src"])])),_:1},8,["onClick"])):b("",!0),o.homeBackClone&&t.headerBack?(p(),m(i,{key:1,class:"navBack navbtn",onClick:n.homeBackFun},{default:f((()=>[y(s,{class:"navbtnImg img",src:o.imgPath+"/info/homepage.png?v="+o.imgVersion,mode:"aspectFill"},null,8,["src"])])),_:1},8,["onClick"])):b("",!0),t.headerBack?b("",!0):(p(),m(i,{key:2,class:"navBack navbtn",onClick:n.backIndex},{default:f((()=>[y(s,{class:"navbtnImg img",src:o.imgPath+"/info/navBack.png?v="+o.imgVersion,mode:"aspectFill"},null,8,["src"])])),_:1},8,["onClick"])),y(i,{class:"navLine"}),y(i,{class:"navMenu navbtn",onClick:n.showMenu},{default:f((()=>[y(s,{src:o.imgPath+"/info/menu_icon.png?v="+o.imgVersion,mode:"aspectFill",class:"navbtnImg"},null,8,["src"]),o.headMenuShow?(p(),m(i,{key:0,class:"bg_mask",onTouchstart:w(n.hideMenu,["stop","prevent"])},null,8,["onTouchstart"])):b("",!0),o.headMenuShow?(p(),m(i,{key:1,class:"navMenuBox"},{default:f((()=>[y(i,{class:"arr_top"},{default:f((()=>[y(s,{src:o.imgPath+"/info/arr_top.png?v="+o.imgVersion,mode:"aspectFill",class:"topImg"},null,8,["src"])])),_:1}),(p(!0),C(I,null,x(o.navList,((a,e)=>(p(),m(i,{key:e,class:"navMenuLi","data-url":a.url,onClick:n.goLink,"data-type":a.type},{default:f((()=>[y(s,{src:o.imgPath+"/info/"+a.icon+"?v="+o.imgVersion,mode:"aspectFill",class:"navImg"},null,8,["src"]),y(i,{class:"navText"},{default:f((()=>[v(_(a.title)+" ",1),a.msg&&o.msgNum>0?(p(),m(i,{key:0,class:"circle_txt"},{default:f((()=>[v(_(o.msgNum),1)])),_:1})):b("",!0)])),_:2},1024)])),_:2},1032,["data-url","onClick","data-type"])))),128))])),_:1})):b("",!0)])),_:1},8,["onClick"])])),_:1},8,["class"])),y(c,{class:"text"},{default:f((()=>[v(_(t.headerTitle),1)])),_:1})],64)):(p(),m(i,{key:1,class:"leftCon"},{default:f((()=>[y(i,{class:"backBtn",onClick:n.goback},{default:f((()=>[y(s,{class:"img",src:o.imgPath+"/waimai/header_back_index.png?v="+o.imgVersion},null,8,["src"])])),_:1},8,["onClick"]),y(c,{class:"text"},{default:f((()=>[v(_(t.headerTitle),1)])),_:1}),y(i,{class:"posi"},{default:f((()=>[y(i,{class:"posiIcon"},{default:f((()=>[y(s,{class:"img",src:o.imgPath+"/waimai/posi.png?v="+o.imgVersion,mode:"aspectFill"},null,8,["src"])])),_:1}),y(i,{class:"posiText","data-url":"/pages/packages/waimai/local/local","data-type":"1",onClick:n.goLink},{default:f((()=>[v(_(t.posiInfo&&t.posiInfo.address?t.posiInfo.address:"定位中..."),1)])),_:1},8,["onClick"]),y(i,{class:"arr_r"},{default:f((()=>[y(s,{class:"img",src:o.imgPath+"/waimai/arr_r.png?v="+o.imgVersion,mode:"aspectFill"},null,8,["src"])])),_:1})])),_:1})])),_:1})),o.showClone?(p(),m(i,{key:4,class:"navPlace",style:k(o.navWidth?"width:"+o.navWidth+"px;height:2rpx;opciaty:0; ":"")},null,8,["style"])):b("",!0)])),_:3},8,["style"])])),_:3},8,["class","style"]),y(i,{class:"pullDownRefresh",style:k("top:"+o.navTop+"px")},{default:f((()=>[t.pullend?t.pullend?b("",!0):(p(),m(i,{key:1,class:"icon rotate"},{default:f((()=>[y(s,{src:o.imgPath+"/info/refresh.png?v="+o.imgVersion},null,8,["src"])])),_:1})):(p(),m(i,{key:0,class:"icon"},{default:f((()=>[y(s,{src:o.imgPath+"/info/pullDown.png?v="+o.imgVersion},null,8,["src"])])),_:1})),y(i,{class:"pullState"},{default:f((()=>[v(_(t.pullend?"正在刷新":"松开刷新"),1)])),_:1})])),_:1},8,["style"]),t.showBottom?(p(),m(g,{key:0,module:t.module,active:"0",msgNum:o.msgNum,needMessage:!1},null,8,["module","msgNum"])):b("",!0)])),_:3},8,["style"])):b("",!0)}],["__scopeId","data-v-340f7ad3"]]);export{U as h};
