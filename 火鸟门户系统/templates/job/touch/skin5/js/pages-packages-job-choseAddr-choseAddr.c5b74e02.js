import{k as a,m as e,v as t,s,r as o,o as l,a as i,w as n,g as c,i as r,b as d,d as p,D as u,t as m,e as g,B as f,E as h,F as _,R as k,T as y,K as P,f as b,I as D,J as C}from"./index-160de7c6.js";import{h as I}from"./public_header.cca239c9.js";import{_ as w,j as x}from"./job.cbea1f04.js";const L=c();var M;const v=w({components:{headerTop:I},data:()=>({uniPlatform:"",navTop:L.globalData.navTop,masterDomain:L.globalData.masterDomain,imgPath:L.globalData.masterDomain+"/static/images/miniprograme/job",imgVersion:"?v="+L.globalData.imgVersion,siteCityInfo:{},keywords:"",location:{},searchList:[],surroundingPois:[],chineseIn:!1,isload:!1,loadEnd:!1,memberDomain:"",backPage:"",pages:{},site_map:""}),onLoad(e){const t=this;t.uniPlatform=a().uniPlatform,"web"==t.uniPlatform&&(t.site_map=site_map),t.backPage=e.back,t.pages=L.pageFn(x),t.getCityInfo(),t.getCurrPosi(),t.$nextTick((()=>{t.memberDomain=L.globalData.appConfig.cfg_user_index})),"web"==_this.platform&&L.globalData.webWeixin&&L.wxShareFn({title:"选择定位"})},methods:{getCurrPosi(){const a=this;let s=e("locationData");const o=parseInt((new Date).valueOf()/1e3);if(s&&"string"==typeof s&&(s=JSON.parse(s)),!s||s&&s.expiredTime&&s.expiredTime<=o){const o=e("currlocation");if(!s&&o){let e=o.split(",")[1],s=o.split(",")[0];isNaN(e)||isNaN(s)?a.relocation():L.getCityInfo(s,e,"gcj02ll",(function(e){a.location=e;let s={expiredTime:parseInt((new Date).valueOf()/1e3+86400),location:e};a.getLocation(e),t("locationData",s)}))}else a.relocation()}else a.location=s.location,a.getLocation(a.location)},relocation(){const a=this;L.globalData.locationFn({success:function(e){var t=e.lng+","+e.lat;s({key:"currlocation",data:t}),L.getCityInfo(e.lng,e.lat,"gcj02ll",(function(e){a.location=e;let t=parseInt((new Date).valueOf()/1e3+86400);s({key:"locationData",data:{expiredTime:t,location:e}}),a.getLocation(e)}))}})},searchkey(){const a=this;a.chineseIn||a.toSearch()},compositionstart(){this.chineseIn=!0},compositionend(){this.chineseIn=!1,this.toSearch()},toSearch(){const a=this;let e=a.siteCityInfo;const t="action=getMapSuggestion&lat="+a.location.lat+"&lng="+a.location.lng+"&query="+a.keywords+"&region="+e.name+"&service=siteConfig";var s=L.encodeUrl(t);a.$ajax.post({url:"include/ajax.php?"+s}).then((e=>{let t=e.data;100==t.state&&(a.searchList=t.info)}))},rePosi(){o("locationData"),this.getCurrPosi()},backLastPage(a,e){const s=this;let o={};if("baidu"==site_map&&(e?(o.title=a.name,o.lng=a.lng,o.lat=a.lat,o.address=a.address):(o.title=a.title,o.lng=a.point.lng,o.lat=a.point.lat,o.address=a.address)),t("chosePosi",o),s.backPage){let a=s.pages[s.backPage];L.linkTo(a,!0)}},mapDistance(a,e,t,s){var o=180/3.14169,l=a/o,i=e/o,n=t/o,c=s/o,r=Math.cos(l)*Math.cos(i)*Math.cos(n)*Math.cos(c),d=Math.cos(l)*Math.sin(i)*Math.cos(n)*Math.sin(c),p=Math.sin(l)*Math.sin(n),u=6366e3*Math.acos(r+d+p)/1e3;return u=u<1?(1e3*u).toFixed(0)+"m":u.toFixed(1)+"km"},getCityInfo(){const a=e("cityInfo");this.siteCityInfo=a||{}},async getLocation(a){const e=this;let t=a.lng,s=a.lat;if("baidu"==site_map){const a=new BMap.Point(t,s);(new BMap.Geocoder).getLocation(a,(function(a){e.surroundingPois=[...a.surroundingPois],e.loadEnd=!0}),{poiRadius:5e3,numPois:50})}else if("amap"==siet_map)AMap.plugin(["AMap.PlaceSearch"],(function(){new AMap.PlaceSearch({pageSize:20}).searchNearBy("",point,1e3,(function(a,t){if("complete"==a&&"OK"==t.info){let a=t.poiList.pois;e.surroundingPois=a.map((a=>({address:a.address,title:a.name,point:{lng:a.location.lng,lat:a.location.lat}})))}}))}));else if("google"==site_map){const{Map:t}=await google.maps.importLibrary("maps");M=new t(document.getElementById("map"),{center:{lat:a.lat,lng:a.lng},zoom:8});new google.maps.places.PlacesService(M).nearbySearch({location:a,radius:500},((a,t,s)=>{"OK"===t&&a&&(e.surroundingPois=a.map((a=>({address:a.vicinity,title:a.name,point:{lng:a.geometry.location.lng,lat:a.geometry.location.lat}}))))}))}},toLink(a){let e=a.currentTarget.dataset.url;L.linkTo(e)}}},[["render",function(a,e,t,s,o,c){const I=r,w=P("headerTop"),x=b,L=D,M=C;return l(),i(I,null,{default:n((()=>[d(I,{class:"choseAddrPage"},{default:n((()=>[d(I,{class:"header"},{default:n((()=>[d(w,{show:!0,module:"job",backOnly:!0,noBorder:!0},{headTitle:n((()=>[d(I,{class:"flexLeft"},{default:n((()=>[d(I,{class:"h4"},{default:n((()=>[p("选择定位")])),_:1})])),_:1})])),_:1}),d(I,{class:"searchContainerBox",style:u("top:calc("+o.navTop+"px + 88rpx);")},{default:n((()=>[d(I,{"data-url":o.masterDomain+"/changecity.html?currentPageOpen=1",class:"city"},{default:n((()=>[d(x,{class:"span"},{default:n((()=>[p(m(o.siteCityInfo.name),1)])),_:1}),d(L,{class:"after",src:o.imgPath+"/arr_down_black.png"+o.imgVersion,mode:"aspectFill"},null,8,["src"])])),_:1},8,["data-url"]),d(I,{class:"searchBox"},{default:n((()=>[d(L,{class:"before",src:o.imgPath+"/searchLg.png"+o.imgVersion,mode:"aspectFill"},null,8,["src"]),d(M,{type:"text",ref:"searchInp",onInput:c.searchkey,onCompositionend:c.compositionend,onCompositionstart:c.compositionstart,name:"",id:"search",autocomplete:"off",placeholder:"搜索地址",modelValue:o.keywords,"onUpdate:modelValue":e[0]||(e[0]=a=>o.keywords=a)},null,8,["onInput","onCompositionend","onCompositionstart","modelValue"]),o.keywords?(l(),i(L,{key:0,class:"clear_btn a",mode:"aspectFill",src:o.imgPath+"/clear_icon.png"+o.imgVersion,onClick:e[1]||(e[1]=a=>o.keywords="")},null,8,["src"])):g("",!0)])),_:1})])),_:1},8,["style"])])),_:1}),d(I,{class:"pageCon"},{default:n((()=>[o.keywords?g("",!0):(l(),i(I,{key:0,class:"addrListBox moreHeight"},{default:n((()=>[d(I,{class:"currPosi"},{default:n((()=>[d(I,{class:"title_p p"},{default:n((()=>[p("当前定位")])),_:1}),d(I,{class:"local"},{default:n((()=>[d(I,{class:"h4"},{default:n((()=>[d(L,{class:"before",src:o.imgPath+"/posi.png"+o.imgVersion,mode:"aspectFill"},null,8,["src"]),d(x,null,{default:n((()=>[p(m(o.location.name),1)])),_:1})])),_:1}),d(I,{class:"rePosi span",onClick:c.rePosi},{default:n((()=>[d(L,{class:"before",src:o.imgPath+"/currPosi.png"+o.imgVersion,mode:"aspectFill"},null,8,["src"]),d(x,null,{default:n((()=>[p("重新定位")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1}),d(I,{class:"addrList"},{default:n((()=>[d(I,{class:"title_p p"},{default:n((()=>[p("附近热门")])),_:1}),d(I,{class:"ul"},{default:n((()=>[(l(!0),f(_,null,h(o.surroundingPois,((a,e)=>(l(),i(I,{class:"li",key:e,onClick:e=>c.backLastPage(a)},{default:n((()=>[d(I,{class:"a"},{default:n((()=>[d(I,{class:"addrInfo"},{default:n((()=>[d(I,{class:"h3"},{default:n((()=>[p(m(a.title),1)])),_:2},1024),d(I,{class:"p"},{default:n((()=>[p(m(a.address)+" ",1)])),_:2},1024)])),_:2},1024),d(I,{class:"addrDistance"},{default:n((()=>[p(m(c.mapDistance(o.location.lat,o.location.lng,a.point.lat,a.point.lng)),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})])),_:1})),k(d(I,{class:"addrListBox"},{default:n((()=>[d(I,{class:"addrList"},{default:n((()=>[d(I,{class:"ul"},{default:n((()=>[(l(!0),f(_,null,h(o.searchList,((a,e)=>(l(),i(I,{class:"li",key:e,onClick:e=>c.backLastPage(a,1)},{default:n((()=>[d(I,{class:"a"},{default:n((()=>[d(I,{class:"addrInfo"},{default:n((()=>[d(I,{class:"h3"},{default:n((()=>[p(m(a.name),1)])),_:2},1024),d(I,{class:"p"},{default:n((()=>[p(m(a.address)+" ",1)])),_:2},1024)])),_:2},1024),d(I,{class:"addrDistance"},{default:n((()=>[p(m(c.mapDistance(o.location.lat,o.location.lng,a.lat,a.lng)),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),o.loadEnd?(l(),i(I,{key:0,class:"toDefine li",onClick:c.toLink,"data-url":o.memberDomain+"/mapDefine.html"},{default:n((()=>[d(I,{class:"a"},{default:n((()=>[d(L,{src:o.imgPath+"/add_addr.png"+o.imgVersion,mode:"aspectFill",class:"before"},null,8,["src"]),d(I,{class:"addrInfo"},{default:n((()=>[d(I,{class:"h3"},{default:n((()=>[p("以上都不是")])),_:1}),d(I,{class:"p"},{default:n((()=>[p("点击添加自定义位置")])),_:1})])),_:1})])),_:1})])),_:1},8,["onClick","data-url"])):g("",!0)])),_:1})])),_:1})])),_:1},512),[[y,o.keywords]])])),_:1}),o.site_map&&"google"==o.site_map?(l(),i(I,{key:0,class:"mapbox"},{default:n((()=>[d(I,{id:"map"})])),_:1})):g("",!0)])),_:1})])),_:1})}],["__scopeId","data-v-a442c69d"]]);export{v as default};
