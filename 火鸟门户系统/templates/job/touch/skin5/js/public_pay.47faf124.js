import{a7 as a,U as e,n as o,p as t,k as s,q as n,R as l,T as c,o as i,a as p,w as d,b as r,C as y,G as u,d as h,t as f,e as m,B as w,E as k,F as P,D as g,g as _,i as b,f as C,I,J as v,H as x,x as S}from"./index-160de7c6.js";import{_ as D}from"./toast.b19c5451.js";import{r as B}from"./uni-app.es.bf317389.js";import{_ as T}from"./job.cbea1f04.js";const j=_();const $=T({components:{toast:D},data:()=>({uniPlatform:"",imgstatic:`${j.globalData.masterDomain}/static/images/miniprograme/payPop/`,imgVersion:j.globalData.imgVersion,imgPath:j.globalData.imgPath,paypwd:[],paypwdStr:"",payment:[],onChosePay:"balance",money:0,bouns:0,showPwdPop:!1,showCancelPop:!1,timeInfo:{dd:0,hh:0,ss:0,mm:0,showText:"0"},focus:!0,hasshowPwdPop:!1,checkIn:!1,interVal:null,payInterval:null,keyboardHeight:0,i:"",currency:{code:"RMB",name:"人民币",rate:"1",short:"元",symbol:"￥"},timeoutpay:!0,userid:j.globalData.userid,keyboardShow:!1,userInfo:""}),props:{showPayPop:{type:Boolean,default:!1},action:{type:String,default:"payPhone"},service:{type:String,default:"siteConfig"},payInfo:{type:Object,default:{order_amount:"",order_sn:"",ordernum:"",service:"",timeout:0}},callType:{type:Number,default:0},needPayTime:{type:Boolean,default:!0},needSuccess:{type:Boolean,default:!0}},emits:["paypopb","keepToCall"],methods:{ready:function(){const a=this;var e=setInterval((function(){j.globalData.appConfig&&j.globalData.appConfig.currency&&(a.currency=j.globalData.appConfig.currency,clearInterval(e))}),1e3)},inputCodeFn(){},getPayment(){const a=this;var e=j.encodeUrl("service=siteConfig&action=payment");a.$ajax.get({url:"include/ajax.php?"+e}).then((e=>{var o=e.data;if(100==o.state){let e=j.globalData.platForm;if("mp-weixin"==e)for(let t=0;t<o.info.length;t++){let e=o.info[t];("alipay"==e.pay_code||!a.userid&&"huoniao_bonus"==e.pay_code)&&o.info.splice(t,1)}else if("mp-toutiao"==e)for(let t=0;t<o.info.length;t++){let e=o.info[t];("alipay"==e.pay_code||"wxpay"==e.pay_code||!a.userid&&"huoniao_bonus"==e.pay_code)&&o.info.splice(t,1)}else if("web"==e&&!a.userid)for(let a=0;a<o.info.length;a++){"huoniao_bonus"==o.info[a].pay_code&&o.info.splice(a,1)}j.globalData.userid||(a.onChosePay=o.info[0].pay_code),a.payment=o.info}}))},getMemberInfo:function(){const a=this;var e="service=member&action=detail&id="+j.globalData.userid,o=j.encodeUrl(e);a.$ajax.get({url:"include/ajax.php?"+o}).then((e=>{100==e.data.state&&(j.globalData.userInfo=e.data.info,a.money=1*e.data.info.money,a.bouns=1*e.data.info.bonus)}))},changePay(a){const e=this;var o=a.currentTarget.dataset.code;0!=a.currentTarget.dataset.click&&(e.onChosePay=o)},cancelConfirm(){this.showCancelPop=!0},cancelPay(){const o=this;clearInterval(o.interVal),o.showCancelPop=!1,o.showPwdPop=!1,this.$emit("paypopb",!1),o.interVal=null,"发布任务"==o.payInfo.subject&&a({delta:2,success:a=>{e({url:"web"==j.globalData.platForm?"/taskmanage?index=0":"/pages/packages/task/taskmanage/taskmanage?index=0"})}})},keepPay(){this.showCancelPop=!1},toPay(){const a=this;"balance"==a.onChosePay?(a.showPwdPop=!0,a.keyboardShow=!0,a.hasshowPwdPop=!0):(console.log("开始支付"),a.checkPwd())},hidePwdPop(){const a=this;a.showPwdPop=!1,a.keyboardShow=!1,a.hasshowPwdPop=!1,a.paypwd=[],a.paypwdStr=""},focusin(){const a=this;a.hasshowPwdPop=!0,"web"!=a.uniplatform?a.focus=!0:a.keyboardShow=!0},showKeyboard(a){const e=this;a.detail.height&&e.keyboardHeight!=a.detail.height&&(e.keyboardHeight=a.detail.height),e.showPwdPop&&a.detail.height&&(e.hasshowPwdPop=!0,"web"!=e.uniplatform?e.focus=!0:(e.focus=!1,e.keyboardShow=!0))},goLink(a){var e=j.globalData.appConfig.cfg_user_index+a.currentTarget.dataset.href;j.linkTo(e)},inputPwd(a){const e=this;var o=a.detail.value,t=o.split("");if(t.length>6&&8!=a.detail.keyCode)return!1;e.paypwd=o.split(""),6==t.length&&e.checkPwd()},keyBoardIn(a){const e=this;e.paypwd.length>=6||(e.paypwd.push(a),6==e.paypwd.length&&e.checkPwd())},checkPwd(a){const e=this;if(e.checkIn||1!=e.userInfo.paypwdCheck&&!a&&"balance"==e.onChosePay)return!1;e.checkIn=!0;let o={service:e.service,action:e.action,ordernum:e.payInfo.ordernum,paytype:"pay"==e.action&&"balance"==e.onChosePay?"money":e.onChosePay};"balance"==e.onChosePay?(o.useBalance=1,o.paypwd=e.paypwd.join(""),o.balance=e.payInfo.order_amount):o.useBalance=0;let t=j.globalData.platForm;if("mp-toutiao"==t)if("bytemini"==e.onChosePay){let a="";for(let t in o)a+=`&${t}=${o[t]}`;let e=`${j.globalData.masterDomain}/include/ajax.php?${a}`;S({url:"/pages/redirect/index?url="+encodeURIComponent(e)})}else e.payRequest(o,(function(a){e.paySuccess(),e.paypwd=[],e.paypwdStr=""}));else if("mp-weixin"==t)"wxpay"==e.onChosePay?e.payRequest(o,(function(a){e.payBywxChat(a.data.info)})):e.payRequest(o,(function(a){e.paySuccess(),e.paypwd=[],e.paypwdStr=""}));else if("web"==t)if(!window.appBoolean||"wxpay"!=e.onChosePay&&"alipay"!=e.onChosePay)if("wxpay"==e.onChosePay||"alipay"==e.onChosePay){let a="";for(let e in o)a+=`&${e}=${o[e]}`;a=a.slice(1),location.href=`${j.globalData.masterDomain}/include/ajax.php?${a}`}else e.payRequest(o,(function(a){e.paySuccess(),e.paypwd=[],e.paypwdStr=""}));else e.$ajax.post({url:j.encodeUrl("include/ajax.php?mark=pay&app=1"),data:o}).then((a=>{100==a.data.state&&window.setupWebViewJavascriptBridge((function(o){o.callHandler("wxpay"==e.onChosePay?"wechatPay":"aliPay",{orderInfo:a.data.info},(function(a){}))}))}))},payRequest(a,e){const s=this;o({title:"支付中..."}),s.$ajax.post({url:j.encodeUrl("include/ajax.php?mark=pay"),data:a}).then((a=>{t(),s.checkIn=!1,a.data.state&&100!=a.data.state?(s.$refs.toasts.showToast(a.data.info),s.paypwd=[],s.paypwdStr=""):100==a.data.state?e(a):(s.paypwd=[],s.paypwdStr="",s.$refs.toasts.showToast("网络请求失败，请稍后重新请求，错误代码："+JSON.stringify(a.data)))}))},payBywxChat(a){const e=this;uni.requestPayment({timeStamp:a.timeStamp,nonceStr:a.nonceStr,package:a.package,signType:a.signType,paySign:decodeURIComponent(a.paySign),success:function(a){e.paySuccess()},fail:function(a){console.log(a),e.$refs.toasts.showToast("支付失败！")}})},paybytoutiao(a){console.log(a)},initData(a){const e=this;e.$emit("keepToCall",{detail:a}),e.$emit("paypopb",!1),e.paypwd=[],e.onChosePay="balance",e.money=0,e.bouns=0,e.showPwdPop=!1,e.showCancelPop=!1,e.hasshowPwdPop=!1,e.getMemberInfo()},paySuccess(){const a=this;if(clearInterval(a.interVal),a.needSuccess){var e=a.imgPath+"/payPop/successIcon.png?v="+a.imgVersion;a.$refs.toasts.showToast("支付成功",e)}a.getPhoneInfo()},getPhoneInfo(){const a=this;var e="service=member&action=tradePayResult&order="+a.payInfo.ordernum;a.$ajax.post({url:"include/ajax.php?"+e}).then((e=>{var o=e.data;100==o.state&&a.initData(o)}))},setPayPwd:function(){const a=this;var e=this;if(e.loading)return!1;if(6!=e.paypwd.length)return showErrAlert("请输入新密码"),!1;e.loading=!0;var o="service=member&action=updateAccount&do=paypwdAdd"+("&pay1="+e.paypwd.join("")+"&pay2="+e.paypwd.join("")),t=j.encodeUrl(o);e.$ajax.post({url:"include/ajax.php?"+t}).then((o=>{var t=o.data;if(e.loading=!1,100==t.state){var s=a.imgPath+"/payPop/successIcon.png?v="+a.imgVersion;e.$refs.toasts.showToast("支付密码设置成功",s),e.checkPwd(1)}}))},payCutDown(a,e,o=0){const t=this;e=parseInt((new Date).valueOf()/1e3)+1800,a.order_amount>t.money&&(t.onChosePay=t.payment[0].pay_code),t.interVal&&clearInterval(t.interVal),t.timeInfo={dd:"0",hh:"00",mm:"00",ss:"00",showText:"0天0小时0分钟0秒"},t.interVal=setInterval((function(){var a=parseInt(Date.parse(new Date));if(1e3*e-a>0)var o=1e3*e-a;else o=0;o||clearInterval(t.interVal);var s=Math.floor(o/864e5),n=Math.floor(o/36e5%24),l=Math.floor(o/6e4%60),c=Math.floor(o/1e3%60),i={dd:s>9?s:"0"+s,hh:n>9?n:"0"+n,mm:l>9?l:"0"+l,ss:c>9?c:"0"+c,showText:s?s+"天":n?n+"小时":l?l+"分钟":c+"秒"};t.timeInfo=i}),1e3)},showtoast(){console.log("测试方法")},trueFun(){console.log("占位：函数 true 未声明")}},created(){const a=this;a.getPayment(),j.globalData.userid&&a.getMemberInfo(),setTimeout((e=>{a.timeoutpay=!1}),400)},mounted(){const a=this;this.uniPlatform=s().uniPlatform,"web"==this.uniPlatform&&(this.focus=!1,this.hasshowPwdPop=!1),"{}"!=JSON.stringify(j.globalData.userInfo)?this.userInfo=j.globalData.userInfo:n({key:"userid",success:e=>{j.memberInfo(e.data,(function(e){a.userInfo=e}))}}),this.$nextTick((()=>this.ready()))},unmounted(){clearInterval(this.interVal)}},[["render",function(a,e,o,t,s,n){const _=b,S=C,T=I,j=v,$=B(x("toast"),D);return l((i(),p(_,{class:"payPopContainer"},{default:d((()=>[r(_,{class:y("payPopMask "+(o.showPayPop?"showPop":"")),onTouchmove:u(n.trueFun,["stop","prevent"])},null,8,["class","onTouchmove"]),r(_,{class:y("payPop payPhonePop "+(o.showPayPop?"showPop":""))},{default:d((()=>[r(_,{class:"payInfoShow"},{default:d((()=>[r(_,{class:"pi-title"},{default:d((()=>[h(f(o.payInfo.subject)+"需支付",1)])),_:1}),r(_,{class:"h2",onClick:n.showtoast},{default:d((()=>[s.currency?(i(),p(S,{key:0,class:"span"},{default:d((()=>[h(f(s.currency.symbol),1)])),_:1})):m("",!0),r(S,{class:"b",id:"amout"},{default:d((()=>[h(f(o.payInfo.order_amount),1)])),_:1})])),_:1},8,["onClick"]),o.needPayTime?(i(),p(_,{key:0,class:"p"},{default:d((()=>[h(" 支付时间: "),r(S,{class:"payCutDown span"},{default:d((()=>[r(S,{class:"em"},{default:d((()=>[h(f(s.timeInfo.hh),1)])),_:1}),h(" : "),r(S,{class:"em"},{default:d((()=>[h(f(s.timeInfo.mm),1)])),_:1}),h(" : "),r(S,{class:"em"},{default:d((()=>[h(f(s.timeInfo.ss),1)])),_:1})])),_:1})])),_:1})):m("",!0)])),_:1}),r(_,{class:"payListBox"},{default:d((()=>[r(_,{class:"close_pay_pop",onClick:n.cancelConfirm},{default:d((()=>[r(T,{mode:"aspectFit",src:s.imgPath+"/payPop/close.png?v="+s.imgVersion},null,8,["src"])])),_:1},8,["onClick"]),r(_,{class:"ul"},{default:d((()=>[s.userid?(i(),p(_,{key:0,class:y("check-item li "+("balance"==s.onChosePay&&o.payInfo.order_amount<=s.money?"paychosed":"")+" "+(o.payInfo.order_amount>s.money?"disabled_pay":"")),id:"balance","data-code":"balance",onClick:n.changePay,"data-click":o.payInfo.order_amount>s.money?0:1},{default:d((()=>[r(_,{class:"left_item div"},{default:d((()=>[r(_,{class:"check-item-img"},{default:d((()=>[r(T,{class:"img",mode:"aspectFit",src:s.imgPath+"/payPop/balance.png?v="+s.imgVersion},null,8,["src"])])),_:1}),r(_,{class:"check-item-txt"},{default:d((()=>[r(_,{class:"h3"},{default:d((()=>[h(" 余额 "),o.payInfo.order_amount<=s.money?(i(),p(S,{key:0},{default:d((()=>[h("(可用余额"+f(s.currency.symbol)+f(s.money)+")",1)])),_:1})):(i(),p(S,{key:1},{default:d((()=>[h("(余额不足，可用余额"+f(s.currency.symbol)+f(s.money)+")",1)])),_:1}))])),_:1})])),_:1})])),_:1}),r(_,{class:"check-item-right"},{default:d((()=>[r(_,{class:"checkbox-icon-round span"},{default:d((()=>[r(T,{mode:"aspectFiill",src:s.imgPath+"/payPop/chosed.png?v="+s.imgVersion},null,8,["src"])])),_:1})])),_:1}),o.payInfo.order_amount>s.money?(i(),p(_,{key:0,class:"investMoney","data-href":"/deposit.html?paytype=deposit",onClick:n.goLink},{default:d((()=>[h("充值")])),_:1},8,["onClick"])):m("",!0)])),_:1},8,["class","onClick","data-click"])):m("",!0),(i(!0),w(P,null,k(s.payment,((a,e)=>(i(),p(_,{key:e,class:y("check-item li "+(a.pay_code==s.onChosePay?"paychosed":"")+"  "+(o.payInfo.order_amount>s.bouns&&"huoniao_bonus"==a.pay_code?"disabled_pay":"")),"data-code":a.pay_code,"data-click":o.payInfo.order_amount>s.bouns&&"huoniao_bonus"==a.pay_code?0:1,onClick:n.changePay},{default:d((()=>[r(_,{class:"left_item div"},{default:d((()=>[r(_,{class:"check-item-img"},{default:d((()=>["huoniao_bonus"==a.pay_code?(i(),p(T,{key:0,class:"img",mode:"aspectFit",src:s.imgPath+"/payPop/bonus_pay.png?v="+s.imgVersion},null,8,["src"])):(i(),p(T,{key:1,class:"img",mode:"aspectFit",src:a.pay_icon},null,8,["src"]))])),_:2},1024),r(_,{class:"check-item-txt"},{default:d((()=>["huoniao_bonus"==a.pay_code?(i(),p(_,{key:0,class:"h3"},{default:d((()=>[h(f(a.pay_name)+" ",1),o.payInfo.order_amount<=s.bouns?(i(),p(S,{key:0},{default:d((()=>[h("(可用余额"+f(s.currency.symbol)+f(s.bouns)+")",1)])),_:1})):(i(),p(S,{key:1},{default:d((()=>[h("(余额不足，可用余额"+f(s.currency.symbol)+f(s.bouns)+")",1)])),_:1}))])),_:2},1024)):(i(),p(_,{key:1,class:"h3"},{default:d((()=>[h(f(a.pay_name),1)])),_:2},1024))])),_:2},1024)])),_:2},1024),o.payInfo.order_amount>s.bouns&&"huoniao_bonus"==a.pay_code?(i(),p(_,{key:0,class:"investMoney",onClick:n.goLink,"data-href":"/recharge.html"},{default:d((()=>[h("充值")])),_:1},8,["onClick"])):(i(),p(_,{key:1,class:"check-item-right"},{default:d((()=>[r(_,{class:"checkbox-icon-round span"},{default:d((()=>[r(T,{mode:"aspectFiill",src:s.imgPath+"/payPop/chosed.png?v="+s.imgVersion},null,8,["src"])])),_:1})])),_:1}))])),_:2},1032,["class","data-code","data-click","onClick"])))),128))])),_:1})])),_:1}),r(_,{class:"btn_pay a",onClick:n.toPay},{default:d((()=>[r(S,{style:{display:"block"},class:"span"},{default:d((()=>[h("立即付款")])),_:1})])),_:1},8,["onClick"]),r(_,{class:y("payCancelMask "+(s.showCancelPop?"showPop":""))},null,8,["class"]),r(_,{class:y("payCancelPop "+(s.showCancelPop?"showPop":"")),style:g(o.needPayTime?"":"height:250rpx;")},{default:d((()=>[r(_,{class:"h4"},{default:d((()=>[h("确定放弃本次付款？")])),_:1}),o.needPayTime?(i(),p(_,{key:0,class:"p"},{default:d((()=>[h(" 您的订单在 "),r(S,{class:"daojs_order span"},{default:d((()=>[h(f(s.timeInfo.showText),1)])),_:1}),h(" 内未支付将被取消， 请尽快完成支付 ")])),_:1})):m("",!0),r(_,{class:"payBtns"},{default:d((()=>[r(_,{class:"cancelPay a",onClick:n.cancelPay},{default:d((()=>[h("放弃")])),_:1},8,["onClick"]),r(_,{class:"keepPay a",onClick:n.keepPay},{default:d((()=>[h("继续支付")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["class","style"])])),_:1},8,["class"]),r(_,{class:"inputBox"},{default:d((()=>[r(j,{type:"number","hold-keyboard":!0,focus:s.hasshowPwdPop&&s.focus,class:"keyInp",onKeyboardheightchange:n.showKeyboard,onInput:n.inputPwd,maxlength:"6",modelValue:s.paypwdStr,"onUpdate:modelValue":e[0]||(e[0]=a=>s.paypwdStr=a)},null,8,["focus","onKeyboardheightchange","onInput","modelValue"])])),_:1}),r(_,{class:y("payPwdPop "+(s.showPwdPop?"showPop":""))},{default:d((()=>[r(_,{class:"payBackBtn a",onClick:n.hidePwdPop},{default:d((()=>[r(T,{src:s.imgPath+"/payPop/arr_back.png?v="+s.imgVersion,mode:"aspectFit"},null,8,["src"])])),_:1},8,["onClick"]),r(_,{class:"h4"},{default:d((()=>[h(f(1==s.userInfo.paypwdCheck?"输入":"设置")+"支付密码",1)])),_:1}),r(_,{class:"payPwdBox",style:g("padding-bottom:"+(s.keyboardHeight+10)+"px;")},{default:d((()=>[r(_,{class:"p"},{default:d((()=>[h("请"+f(1==s.userInfo.paypwdCheck?"输入":"设置")+"6位数字密码确认支付",1)])),_:1}),r(_,{class:"payPwdInp"},{default:d((()=>[r(_,{class:"ul",onClick:n.focusin},{default:d((()=>[(i(),w(P,null,k(6,((a,e)=>r(_,{class:"li",key:e},{default:d((()=>[s.paypwd[e]||0==s.paypwd[e]?(i(),p(S,{key:0,class:"em"},{default:d((()=>[h("•")])),_:1})):m("",!0)])),_:2},1024))),64))])),_:1},8,["onClick"])])),_:1}),1==s.userInfo.paypwdCheck?(i(),p(_,{key:0,class:"fpwtbox"},{default:d((()=>[r(_,{"data-href":"/security-paypwdEdit.html?step=2",class:"fpwt a",onClick:n.goLink},{default:d((()=>[h("忘记密码?")])),_:1},8,["onClick"])])),_:1})):(i(),p(_,{key:1,class:"spwtbox"},{default:d((()=>[r(_,{class:"p"},{default:d((()=>[h("·避免使用连续或重复数字，类似“123456”“112233”")])),_:1}),r(_,{class:"p"},{default:d((()=>[h("·避免使用手机号、证件号中的连续数字")])),_:1})])),_:1})),1!=s.userInfo.paypwdCheck?(i(),p(_,{key:2,class:"setPwdUp",onClick:n.setPayPwd},{default:d((()=>[h("确认并支付")])),_:1},8,["onClick"])):m("",!0)])),_:1},8,["style"]),"web"==s.uniPlatform?(i(),p(_,{key:0,class:y({keyboard:!0,showKeyBoard:s.keyboardShow})},{default:d((()=>[r(_,null,{default:d((()=>[r(S,{onClick:e[1]||(e[1]=a=>n.keyBoardIn(1))},{default:d((()=>[h("1")])),_:1}),r(S,{onClick:e[2]||(e[2]=a=>n.keyBoardIn(2))},{default:d((()=>[h("2")])),_:1}),r(S,{onClick:e[3]||(e[3]=a=>n.keyBoardIn(3))},{default:d((()=>[h("3")])),_:1}),r(S,{onClick:e[4]||(e[4]=a=>n.keyBoardIn(4))},{default:d((()=>[h("4")])),_:1}),r(S,{onClick:e[5]||(e[5]=a=>n.keyBoardIn(5))},{default:d((()=>[h("5")])),_:1}),r(S,{onClick:e[6]||(e[6]=a=>n.keyBoardIn(6))},{default:d((()=>[h("6")])),_:1}),r(S,{onClick:e[7]||(e[7]=a=>n.keyBoardIn(7))},{default:d((()=>[h("7")])),_:1}),r(S,{onClick:e[8]||(e[8]=a=>n.keyBoardIn(8))},{default:d((()=>[h("8")])),_:1}),r(S,{onClick:e[9]||(e[9]=a=>n.keyBoardIn(9))},{default:d((()=>[h("9")])),_:1}),r(S,{class:"none"}),r(S,{onClick:e[10]||(e[10]=a=>n.keyBoardIn(0))},{default:d((()=>[h("0")])),_:1}),r(S,{class:"backSpace",style:g(`background: url(${s.imgstatic}del_num.png) no-repeat 50%/60rpx;`),onClick:e[11]||(e[11]=a=>s.paypwd=s.paypwd.slice(0,-1))},null,8,["style"])])),_:1})])),_:1},8,["class"])):m("",!0)])),_:1},8,["class"]),r(_,{style:{position:"relative","z-index":"9999999999"}},{default:d((()=>[r($,{id:"toast",ref:"toasts"},null,512)])),_:1})])),_:1},512)),[[c,!s.timeoutpay]])}],["__scopeId","data-v-406453c0"]]);export{$ as p};
