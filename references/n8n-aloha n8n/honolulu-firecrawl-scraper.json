{
  "name": "æª€é¦™å±±ç¤¾åŒºFirecrawlæ™ºèƒ½çˆ¬è™«",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 6
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [200, 300],
      "id": "schedule-trigger",
      "name": "æ¯6å°æ—¶æ‰§è¡Œ"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "target_sites",
              "name": "ç›®æ ‡ç½‘ç«™åˆ—è¡¨",
              "value": [
                {
                  "name": "Hawaii Reddit",
                  "url": "https://www.reddit.com/r/Hawaii/",
                  "search_terms": ["need", "looking for", "problem", "issue", "recommend", "help"]
                },
                {
                  "name": "Honolulu Reddit", 
                  "url": "https://www.reddit.com/r/Honolulu/",
                  "search_terms": ["éœ€è¦", "å¯»æ‰¾", "é—®é¢˜", "å»ºè®®", "æ¨è"]
                },
                {
                  "name": "Hawaii Forum",
                  "url": "https://www.hawaiiforum.com/",
                  "search_terms": ["ç—›ç‚¹", "å›°éš¾", "éœ€æ±‚", "å»ºè®®"]
                },
                {
                  "name": "Yelp Hawaii",
                  "url": "https://www.yelp.com/hawaii",
                  "search_terms": ["review", "complaint", "issue", "problem"]
                },
                {
                  "name": "TripAdvisor Hawaii",
                  "url": "https://www.tripadvisor.com/Tourism-g28932-Hawaii-Vacations.html",
                  "search_terms": ["problem", "issue", "need", "difficult"]
                }
              ],
              "type": "array"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [400, 300],
      "id": "set-target-sites",
      "name": "è®¾ç½®ç›®æ ‡ç½‘ç«™"
    },
    {
      "parameters": {
        "batchSize": 1,
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [600, 300],
      "id": "split-sites",
      "name": "åˆ†æ‰¹å¤„ç†ç½‘ç«™"
    },
    {
      "parameters": {
        "url": "https://api.firecrawl.dev/v1/scrape",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "httpHeaderAuth": {
          "name": "Authorization",
          "value": "Bearer YOUR_FIRECRAWL_API_KEY"
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "url",
              "value": "={{ $json.url }}"
            },
            {
              "name": "formats",
              "value": ["markdown", "json"]
            },
            {
              "name": "jsonOptions",
              "value": {
                "prompt": "æå–ç”¨æˆ·éœ€æ±‚ã€ç—›ç‚¹ã€é—®é¢˜å’Œå»ºè®®ã€‚é‡ç‚¹å…³æ³¨æª€é¦™å±±æœ¬åœ°ç”Ÿæ´»ç›¸å…³çš„å†…å®¹ã€‚è¿”å›JSONæ ¼å¼ï¼š{\"éœ€æ±‚ç±»å‹\": \"\", \"å…·ä½“éœ€æ±‚\": \"\", \"ç—›ç‚¹æè¿°\": \"\", \"æƒ…æ„Ÿå€¾å‘\": \"\", \"ç´§æ€¥ç¨‹åº¦\": \"\", \"ç›®æ ‡ç”¨æˆ·\": \"\", \"å•†ä¸šæœºä¼š\": \"\"}"
              }
            },
            {
              "name": "onlyMainContent",
              "value": true
            },
            {
              "name": "timeout",
              "value": 60000
            }
          ]
        },
        "options": {
          "timeout": 120000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [800, 300],
      "id": "firecrawl-scrape",
      "name": "Firecrawlæ™ºèƒ½æŠ“å–"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false
          },
          "conditions": [
            {
              "leftValue": "={{ $json.success }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equal"
              }
            }
          ]
        }
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2,
      "position": [1000, 300],
      "id": "filter-success",
      "name": "è¿‡æ»¤æˆåŠŸç»“æœ"
    },
    {
      "parameters": {
        "jsCode": "// å¤„ç†Firecrawlè¿”å›çš„æ•°æ®\nconst data = $input.first().json.data;\nconst siteName = $input.first().json.name;\nconst siteUrl = $input.first().json.url;\n\nconst results = [];\n\n// å¤„ç†markdownå†…å®¹\nif (data.markdown) {\n  const markdown = data.markdown;\n  \n  // ä½¿ç”¨å…³é”®è¯è¿‡æ»¤ç›¸å…³å†…å®¹\n  const keywords = ['need', 'looking for', 'problem', 'issue', 'recommend', 'help', 'éœ€è¦', 'å¯»æ‰¾', 'é—®é¢˜', 'å»ºè®®', 'æ¨è', 'ç—›ç‚¹', 'å›°éš¾'];\n  \n  const lines = markdown.split('\\n');\n  const relevantLines = lines.filter(line => \n    keywords.some(keyword => \n      line.toLowerCase().includes(keyword.toLowerCase())\n    )\n  );\n  \n  if (relevantLines.length > 0) {\n    results.push({\n      site: siteName,\n      url: siteUrl,\n      content_type: 'markdown',\n      content: relevantLines.join('\\n'),\n      timestamp: new Date().toISOString(),\n      ai_analysis: data.json || null\n    });\n  }\n}\n\n// å¤„ç†AIæå–çš„JSONæ•°æ®\nif (data.json) {\n  results.push({\n    site: siteName,\n    url: siteUrl,\n    content_type: 'ai_extracted',\n    content: JSON.stringify(data.json, null, 2),\n    timestamp: new Date().toISOString(),\n    ai_analysis: data.json\n  });\n}\n\nreturn results.map(item => ({ json: item }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1200, 300],
      "id": "process-firecrawl-data",
      "name": "å¤„ç†Firecrawlæ•°æ®"
    },
    {
      "parameters": {
        "model": "gpt-3.5-turbo",
        "messages": {
          "messageValues": [
            {
              "role": "system",
              "message": "ä½ æ˜¯æª€é¦™å±±ç¤¾åŒºéœ€æ±‚åˆ†æä¸“å®¶ã€‚åˆ†æä»¥ä¸‹å†…å®¹ï¼Œè¯†åˆ«ç”¨æˆ·éœ€æ±‚å’Œç—›ç‚¹ï¼Œç‰¹åˆ«å…³æ³¨å¤å¨å¤·æœ¬åœ°ç”Ÿæ´»ç›¸å…³çš„å†…å®¹ã€‚è¿”å›è¯¦ç»†çš„JSONåˆ†æï¼š{\"éœ€æ±‚åˆ†ç±»\": \"\", \"å…·ä½“éœ€æ±‚\": \"\", \"ç—›ç‚¹æè¿°\": \"\", \"æƒ…æ„Ÿå¼ºåº¦\": \"1-10\", \"ç´§æ€¥ç¨‹åº¦\": \"ä½/ä¸­/é«˜\", \"ç›®æ ‡ç”¨æˆ·ç¾¤ä½“\": \"\", \"æ½œåœ¨è§£å†³æ–¹æ¡ˆ\": \"\", \"å•†ä¸šæœºä¼šè¯„ä¼°\": \"\", \"å…³é”®è¯æ ‡ç­¾\": []}"
            },
            {
              "role": "user",
              "message": "ç½‘ç«™: {{ $json.site }}\\nå†…å®¹: {{ $json.content }}\\nå·²æœ‰AIåˆ†æ: {{ $json.ai_analysis }}"
            }
          ]
        }
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.3,
      "position": [1400, 300],
      "id": "enhanced-ai-analysis",
      "name": "å¢å¼ºAIåˆ†æ"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "your-google-sheet-id",
          "mode": "list"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "æ—¶é—´æˆ³": "={{ $json.timestamp }}",
            "æ¥æºç½‘ç«™": "={{ $json.site }}",
            "ç½‘ç«™URL": "={{ $json.url }}",
            "å†…å®¹ç±»å‹": "={{ $json.content_type }}",
            "åŸå§‹å†…å®¹": "={{ $json.content.substring(0, 500) }}",
            "Firecrawlåˆ†æ": "={{ JSON.stringify($json.ai_analysis) }}",
            "å¢å¼ºAIåˆ†æ": "={{ $json.choices[0].message.content }}",
            "å¤„ç†çŠ¶æ€": "å·²åˆ†æ"
          }
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.4,
      "position": [1600, 300],
      "id": "save-to-sheets",
      "name": "ä¿å­˜åˆ°Google Sheets"
    },
    {
      "parameters": {
        "url": "https://api.firecrawl.dev/v1/search",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "httpHeaderAuth": {
          "name": "Authorization",
          "value": "Bearer YOUR_FIRECRAWL_API_KEY"
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "query",
              "value": "æª€é¦™å±± å¤å¨å¤· ç”Ÿæ´» é—®é¢˜ éœ€æ±‚ ç—›ç‚¹ å»ºè®® site:reddit.com OR site:yelp.com OR site:tripadvisor.com"
            },
            {
              "name": "limit",
              "value": 10
            },
            {
              "name": "formats",
              "value": ["markdown", "json"]
            },
            {
              "name": "jsonOptions",
              "value": {
                "prompt": "ä»æœç´¢ç»“æœä¸­æå–æª€é¦™å±±æœ¬åœ°ç”Ÿæ´»ç›¸å…³çš„ç”¨æˆ·éœ€æ±‚å’Œç—›ç‚¹"
              }
            }
          ]
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [800, 500],
      "id": "firecrawl-search",
      "name": "Firecrawlæ™ºèƒ½æœç´¢"
    },
    {
      "parameters": {
        "chatId": "YOUR_TELEGRAM_CHAT_ID",
        "text": "ğŸï¸ æª€é¦™å±±ç¤¾åŒºçˆ¬è™«æŠ¥å‘Š\\n\\nğŸ“Š æœ¬æ¬¡æŠ“å–ç»Ÿè®¡ï¼š\\n- å¤„ç†ç½‘ç«™ï¼š{{ $json.site }}\\n- å‘ç°éœ€æ±‚ï¼š{{ $json.ai_analysis ? Object.keys($json.ai_analysis).length : 0 }}ä¸ª\\n- æ—¶é—´ï¼š{{ $json.timestamp }}\\n\\nğŸ” ä¸»è¦å‘ç°ï¼š\\n{{ $json.choices[0].message.content.substring(0, 200) }}...\\n\\nğŸ“‹ è¯¦ç»†æ•°æ®å·²ä¿å­˜åˆ°Google Sheets"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [1800, 300],
      "id": "telegram-notification",
      "name": "Telegramé€šçŸ¥"
    }
  ],
  "connections": {
    "æ¯6å°æ—¶æ‰§è¡Œ": {
      "main": [
        [{"node": "è®¾ç½®ç›®æ ‡ç½‘ç«™", "type": "main", "index": 0}]
      ]
    },
    "è®¾ç½®ç›®æ ‡ç½‘ç«™": {
      "main": [
        [
          {"node": "åˆ†æ‰¹å¤„ç†ç½‘ç«™", "type": "main", "index": 0},
          {"node": "Firecrawlæ™ºèƒ½æœç´¢", "type": "main", "index": 0}
        ]
      ]
    },
    "åˆ†æ‰¹å¤„ç†ç½‘ç«™": {
      "main": [
        [{"node": "Firecrawlæ™ºèƒ½æŠ“å–", "type": "main", "index": 0}]
      ]
    },
    "Firecrawlæ™ºèƒ½æŠ“å–": {
      "main": [
        [{"node": "è¿‡æ»¤æˆåŠŸç»“æœ", "type": "main", "index": 0}]
      ]
    },
    "è¿‡æ»¤æˆåŠŸç»“æœ": {
      "main": [
        [{"node": "å¤„ç†Firecrawlæ•°æ®", "type": "main", "index": 0}]
      ]
    },
    "å¤„ç†Firecrawlæ•°æ®": {
      "main": [
        [{"node": "å¢å¼ºAIåˆ†æ", "type": "main", "index": 0}]
      ]
    },
    "å¢å¼ºAIåˆ†æ": {
      "main": [
        [
          {"node": "ä¿å­˜åˆ°Google Sheets", "type": "main", "index": 0},
          {"node": "Telegramé€šçŸ¥", "type": "main", "index": 0}
        ]
      ]
    }
  }
}
