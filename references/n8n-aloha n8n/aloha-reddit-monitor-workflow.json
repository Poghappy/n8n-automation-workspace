{
  "name": "ğŸï¸ Aloha Redditæ•°æ®ç›‘æ§å·¥ä½œæµ",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 6
            }
          ]
        }
      },
      "id": "schedule-trigger",
      "name": "å®šæ—¶è§¦å‘å™¨",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [240, 300]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://www.reddit.com/r/Hawaii/hot.json?limit=25",
        "options": {
          "headers": {
            "User-Agent": "Aloha-Bot/1.0"
          }
        }
      },
      "id": "reddit-hawaii",
      "name": "Reddit r/Hawaii",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [460, 200]
    },
    {
      "parameters": {
        "method": "GET", 
        "url": "https://www.reddit.com/r/Honolulu/hot.json?limit=25",
        "options": {
          "headers": {
            "User-Agent": "Aloha-Bot/1.0"
          }
        }
      },
      "id": "reddit-honolulu",
      "name": "Reddit r/Honolulu", 
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [460, 300]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://www.reddit.com/r/VisitingHawaii/hot.json?limit=25", 
        "options": {
          "headers": {
            "User-Agent": "Aloha-Bot/1.0"
          }
        }
      },
      "id": "reddit-visiting",
      "name": "Reddit r/VisitingHawaii",
      "type": "n8n-nodes-base.httpRequest", 
      "typeVersion": 4.1,
      "position": [460, 400]
    },
    {
      "parameters": {
        "jsCode": "// åˆå¹¶æ‰€æœ‰Redditæ•°æ®å¹¶æå–å…³é”®ä¿¡æ¯\nconst allPosts = [];\n\n// å¤„ç†æ¯ä¸ªè¾“å…¥é¡¹\nfor (const inputData of $input.all()) {\n  const data = inputData.json;\n  \n  if (data && data.data && data.data.children) {\n    for (const post of data.data.children) {\n      const postData = post.data;\n      \n      // è¿‡æ»¤ç›¸å…³å†…å®¹\n      const relevantKeywords = ['ä½å®¿', 'ä»·æ ¼', 'æ–‡åŒ–', 'æœ¬åœ°', 'æ¸¸å®¢', 'expensive', 'cheap', 'local', 'tourist', 'culture', 'aloha', 'mai tai', 'waikiki'];\n      const title = postData.title.toLowerCase();\n      const selftext = (postData.selftext || '').toLowerCase();\n      \n      const isRelevant = relevantKeywords.some(keyword => \n        title.includes(keyword) || selftext.includes(keyword)\n      );\n      \n      if (isRelevant && postData.score > 5) {\n        allPosts.push({\n          id: postData.id,\n          title: postData.title,\n          content: postData.selftext,\n          score: postData.score,\n          num_comments: postData.num_comments,\n          created_utc: postData.created_utc,\n          subreddit: postData.subreddit,\n          url: `https://reddit.com${postData.permalink}`,\n          author: postData.author,\n          collected_at: new Date().toISOString()\n        });\n      }\n    }\n  }\n}\n\n// æŒ‰åˆ†æ•°æ’åºï¼Œå–å‰20ä¸ª\nallPosts.sort((a, b) => b.score - a.score);\nconst topPosts = allPosts.slice(0, 20);\n\nreturn topPosts.map(post => ({ json: post }));"
      },
      "id": "data-processor",
      "name": "æ•°æ®å¤„ç†å™¨",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [680, 300]
    },
    {
      "parameters": {
        "resource": "chat",
        "operation": "message",
        "model": "gpt-4",
        "messages": {
          "values": [
            {
              "role": "system",
              "content": "ä½ æ˜¯ä¸€ä¸ªä¸“é—¨åˆ†æå¤å¨å¤·æœ¬åœ°ç”¨æˆ·éœ€æ±‚çš„AIåŠ©æ‰‹ã€‚è¯·åˆ†æRedditå¸–å­å†…å®¹ï¼Œè¯†åˆ«ç”¨æˆ·ç—›ç‚¹å’Œéœ€æ±‚ã€‚\n\nè¯·æŒ‰ä»¥ä¸‹æ ¼å¼è¿”å›JSONï¼š\n{\n  \"pain_point_category\": \"æ–‡åŒ–å†²çª|ç»æµè´Ÿæ‹…|å†³ç­–å›°éš¾|æœŸæœ›ç®¡ç†|ä¿¡æ¯è·å–\",\n  \"user_group\": \"æœ¬åœ°å±…æ°‘|æ–°ç§»æ°‘|æ¸¸å®¢\",\n  \"severity\": 1-5,\n  \"key_insights\": [\"æ´å¯Ÿ1\", \"æ´å¯Ÿ2\"],\n  \"sentiment\": \"positive|negative|neutral\",\n  \"actionable_suggestions\": [\"å»ºè®®1\", \"å»ºè®®2\"]\n}"
            },
            {
              "role": "user", 
              "content": "æ ‡é¢˜: {{ $json.title }}\nå†…å®¹: {{ $json.content }}\nç‚¹èµæ•°: {{ $json.score }}\nè¯„è®ºæ•°: {{ $json.num_comments }}\næ¥æº: r/{{ $json.subreddit }}"
            }
          ]
        },
        "options": {
          "temperature": 0.3
        }
      },
      "id": "ai-analyzer",
      "name": "AIåˆ†æå™¨",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.3,
      "position": [900, 300]
    },
    {
      "parameters": {
        "operation": "insert",
        "table": "reddit_posts",
        "columns": "id, title, content, score, num_comments, created_utc, subreddit, url, author, collected_at, pain_point_category, user_group, severity, sentiment",
        "additionalFields": {
          "mode": "upsert",
          "upsertFields": ["id"]
        }
      },
      "id": "database-insert",
      "name": "æ•°æ®åº“å­˜å‚¨",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.4,
      "position": [1120, 300],
      "credentials": {
        "postgres": {
          "id": "postgres-aloha",
          "name": "Aloha PostgreSQL"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "high-priority",
              "leftValue": "={{ $json.severity }}",
              "rightValue": 4,
              "operator": {
                "type": "number",
                "operation": "gte"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "priority-filter",
      "name": "ä¼˜å…ˆçº§è¿‡æ»¤",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1340, 300]
    },
    {
      "parameters": {
        "authentication": "accessToken",
        "resource": "page",
        "operation": "append",
        "pageId": "notion-page-id-here",
        "blockUi": {
          "blockValues": [
            {
              "type": "paragraph",
              "richText": [
                {
                  "textType": "text",
                  "text": "ğŸš¨ é«˜ä¼˜å…ˆçº§å‘ç° ({{ new Date().toLocaleString('zh-CN', {timeZone: 'Pacific/Honolulu'}) }})\n\nğŸ“Š **æ•°æ®æ¦‚è§ˆ**:\n- æ ‡é¢˜: {{ $json.title }}\n- ç—›ç‚¹ç±»åˆ«: {{ $json.pain_point_category }}\n- ç”¨æˆ·ç¾¤ä½“: {{ $json.user_group }}\n- ä¸¥é‡ç¨‹åº¦: {{ $json.severity }}/5\n- å‚ä¸åº¦: {{ $json.score }}ç‚¹èµ, {{ $json.num_comments }}è¯„è®º\n- æ¥æº: r/{{ $json.subreddit }}\n\nğŸ’¡ **å…³é”®æ´å¯Ÿ**:\n{{ $json.key_insights.join('\\n- ') }}\n\nğŸ¯ **è¡ŒåŠ¨å»ºè®®**:\n{{ $json.actionable_suggestions.join('\\n- ') }}\n\nğŸ”— [æŸ¥çœ‹åŸå¸–]({{ $json.url }})\n\n---"
                }
              ]
            }
          ]
        }
      },
      "id": "notion-update",
      "name": "NotionæŠ¥å‘Šæ›´æ–°",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [1560, 200],
      "credentials": {
        "notionApi": {
          "id": "notion-aloha",
          "name": "Aloha Notion"
        }
      }
    },
    {
      "parameters": {
        "chatId": "telegram-chat-id-here",
        "text": "ğŸï¸ **Alohaæ•°æ®ç›‘æ§è­¦æŠ¥**\n\nå‘ç°é«˜ä¼˜å…ˆçº§ç”¨æˆ·éœ€æ±‚ï¼\n\nğŸ“Š **è¯¦æƒ…**:\nâ€¢ ç—›ç‚¹: {{ $json.pain_point_category }}\nâ€¢ ç¾¤ä½“: {{ $json.user_group }}\nâ€¢ ä¸¥é‡ç¨‹åº¦: {{ $json.severity }}/5\nâ€¢ å‚ä¸åº¦: {{ $json.score }}ğŸ‘ {{ $json.num_comments }}ğŸ’¬\n\nğŸ’­ **å†…å®¹**: {{ $json.title }}\n\nğŸ”— [æŸ¥çœ‹è¯¦æƒ…]({{ $json.url }})\n\nâ° {{ new Date().toLocaleString('zh-CN', {timeZone: 'Pacific/Honolulu'}) }} HST",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "id": "telegram-alert",
      "name": "Telegramè­¦æŠ¥",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [1560, 400],
      "credentials": {
        "telegramApi": {
          "id": "telegram-aloha",
          "name": "Aloha Telegram Bot"
        }
      }
    }
  ],
  "connections": {
    "å®šæ—¶è§¦å‘å™¨": {
      "main": [
        [
          {
            "node": "Reddit r/Hawaii",
            "type": "main",
            "index": 0
          },
          {
            "node": "Reddit r/Honolulu", 
            "type": "main",
            "index": 0
          },
          {
            "node": "Reddit r/VisitingHawaii",
            "type": "main", 
            "index": 0
          }
        ]
      ]
    },
    "Reddit r/Hawaii": {
      "main": [
        [
          {
            "node": "æ•°æ®å¤„ç†å™¨",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Reddit r/Honolulu": {
      "main": [
        [
          {
            "node": "æ•°æ®å¤„ç†å™¨",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Reddit r/VisitingHawaii": {
      "main": [
        [
          {
            "node": "æ•°æ®å¤„ç†å™¨",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ•°æ®å¤„ç†å™¨": {
      "main": [
        [
          {
            "node": "AIåˆ†æå™¨",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AIåˆ†æå™¨": {
      "main": [
        [
          {
            "node": "æ•°æ®åº“å­˜å‚¨",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ•°æ®åº“å­˜å‚¨": {
      "main": [
        [
          {
            "node": "ä¼˜å…ˆçº§è¿‡æ»¤",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ä¼˜å…ˆçº§è¿‡æ»¤": {
      "main": [
        [
          {
            "node": "NotionæŠ¥å‘Šæ›´æ–°",
            "type": "main",
            "index": 0
          },
          {
            "node": "Telegramè­¦æŠ¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2025-01-04T12:00:00.000Z",
      "updatedAt": "2025-01-04T12:00:00.000Z", 
      "id": "aloha-automation",
      "name": "Alohaè‡ªåŠ¨åŒ–"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2025-01-04T12:00:00.000Z",
  "versionId": "1"
}
