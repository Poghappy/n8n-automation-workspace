# N8N 外网访问配置指南

## 概述

本指南介绍如何在工作场所安全访问本地运行的 N8N 自动化服务。经过测试，推荐使用 Tailscale VPN 方案作为主要访问方式。

## 当前系统状态

### N8N 服务配置
- **服务状态**: 正常运行
- **本地端口**: 5678
- **认证方式**: 基础认证 (Basic Auth)
- **用户名**: admin
- **密码**: ewz61dhA8gMC81+Af/0kJQ==
- **数据库**: PostgreSQL
- **公网IP**: 76.39.9.1 (IPv4)

### 网络环境
- **容器状态**: n8n-automation 运行中
- **端口映射**: 0.0.0.0:5678->5678/tcp
- **Docker网络**: 正常

## 推荐方案：Tailscale VPN

### 优势
- ✅ **安全性高**: 端到端加密，零信任网络架构
- ✅ **配置简单**: 一次配置，多设备使用
- ✅ **免费额度**: 个人使用免费，支持最多3个用户和100台设备
- ✅ **跨平台**: 支持 Windows、macOS、Linux、iOS、Android
- ✅ **无需端口转发**: 不需要修改路由器设置

### 配置步骤

#### 1. 服务器端配置（已完成）
```bash
# 1. 安装 Tailscale（已安装）
brew install tailscale

# 2. 启动系统守护进程
sudo tailscaled install-system-daemon

# 3. 登录并连接到网络
tailscale up
# 访问提供的链接完成认证: https://login.tailscale.com/a/1618098b01ef00

# 4. 检查连接状态
tailscale status
# 输出: 100.117.189.73  zhiledemacbook-pro   denzhile3@   macOS   -

# 5. 获取 Tailscale IP
tailscale ip -4
# 输出: 100.117.189.73
```

#### 2. 客户端配置

##### Windows 客户端
1. 下载并安装 Tailscale: https://tailscale.com/download/windows
2. 启动应用并使用相同账户登录
3. 连接成功后，可通过 `100.117.189.73:5678` 访问 N8N

##### macOS 客户端
1. 下载并安装 Tailscale: https://tailscale.com/download/mac
2. 启动应用并登录
3. 连接成功后访问 N8N

##### 移动设备
1. 在 App Store 或 Google Play 下载 Tailscale
2. 登录相同账户
3. 通过移动浏览器访问 N8N

### 访问方式

#### 通过浏览器访问
```
URL: http://100.117.189.73:5678
用户名: admin
密码: ewz61dhA8gMC81+Af/0kJQ==
```

#### 通过 API 访问
```bash
# 基础认证示例
curl -u "admin:ewz61dhA8gMC81+Af/0kJQ==" "http://100.117.189.73:5678/rest/workflows"
```

## 备用方案分析

### ngrok 内网穿透（不推荐）
- ❌ **限制**: 免费账户只能同时运行1个隧道
- ❌ **稳定性**: 免费版本连接不稳定
- ❌ **安全性**: 公网暴露，需要额外安全措施
- ✅ **配置简单**: 一条命令即可启动

### 路由器端口转发（不推荐）
- ❌ **安全风险**: 直接暴露到公网
- ❌ **配置复杂**: 需要路由器管理权限
- ❌ **动态IP**: 家庭网络IP可能变化

### 云服务部署（备选）
- ✅ **稳定性**: 云服务商保证可用性
- ❌ **成本**: 需要支付云服务费用
- ❌ **迁移复杂**: 需要重新配置环境

## 安全建议

### 1. 网络安全
- 使用 Tailscale 的 ACL 功能限制访问权限
- 定期检查连接的设备列表
- 及时移除不再使用的设备

### 2. 认证安全
- 定期更换 N8N 基础认证密码
- 考虑启用双因素认证（如果支持）
- 监控登录日志

### 3. 数据安全
- 定期备份 N8N 工作流和数据
- 确保敏感数据加密存储
- 限制工作流中的敏感操作权限

## 故障排除

### Tailscale 连接问题
```bash
# 检查服务状态
tailscale status

# 重新连接
tailscale down
tailscale up

# 检查网络连通性
ping 100.117.189.73
```

### N8N 访问问题
```bash
# 检查容器状态
docker ps --filter "name=n8n-automation"

# 检查端口监听
lsof -i :5678

# 测试本地访问
curl -I http://localhost:5678
```

## 监控和维护

### 定期检查项目
- [ ] Tailscale 连接状态
- [ ] N8N 服务运行状态
- [ ] 数据库连接正常
- [ ] 备份任务执行
- [ ] 安全日志审查

### 更新维护
- 定期更新 Tailscale 客户端
- 关注 N8N 版本更新
- 监控系统资源使用情况

## 联系信息

如有问题，请检查：
1. Tailscale 官方文档: https://tailscale.com/kb/
2. N8N 官方文档: https://docs.n8n.io/
3. 本项目 GitHub Issues

---

**配置完成时间**: 2025年9月17日  
**测试状态**: ✅ 通过  
**推荐使用**: Tailscale VPN 方案