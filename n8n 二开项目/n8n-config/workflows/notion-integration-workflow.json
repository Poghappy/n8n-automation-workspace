{
  "name": "ç«é¸Ÿé—¨æˆ·æ–°é—»å·¥ä½œæµ-Notioné›†æˆç‰ˆ",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 */30 * * * *"
            }
          ]
        }
      },
      "id": "cron-trigger",
      "name": "å®šæ—¶è§¦å‘å™¨",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [
        240,
        300
      ]
    },
    {
      "parameters": {
        "url": "={{$json.rss_url}}",
        "options": {
          "timeout": 30000
        }
      },
      "id": "rss-collector",
      "name": "RSSå†…å®¹é‡‡é›†",
      "type": "n8n-nodes-base.rss",
      "typeVersion": 1,
      "position": [
        460,
        300
      ]
    },
    {
      "parameters": {
        "jsCode": "// åŸºäºç°æœ‰çš„HuoNiaoContentProcessorè¿›è¡Œæ™ºèƒ½å†…å®¹å¤„ç†\nconst items = $input.all();\nconst processedItems = [];\n\nfor (const item of items) {\n  try {\n    // åŸºç¡€æ•°æ®æå–å’Œæ¸…ç†\n    const processedItem = {\n      æ ‡é¢˜: item.json.title?.substring(0, 60) || '',\n      çŸ­æ ‡é¢˜: item.json.title?.substring(0, 36) || '',\n      å†…å®¹: item.json.content || item.json.description || '',\n      æ‘˜è¦: item.json.description?.substring(0, 255) || '',\n      \n      // æ¥æºä¿¡æ¯\n      æ¥æº: item.json.source || 'RSSé‡‡é›†',\n      ä½œè€…: item.json.author || 'AIé‡‡é›†',\n      åŸå§‹URL: item.json.link || '',\n      æ¥æºç½‘å€: item.json.link || '',\n      å‘å¸ƒæ—¥æœŸ: item.json.pubDate || new Date().toISOString(),\n      \n      // åˆ†ç±»å’Œæ ‡ç­¾\n      åˆ†ç±»ID: 1, // é»˜è®¤ç§‘æŠ€èµ„è®¯\n      åˆ†ç±»åç§°: 'ç§‘æŠ€èµ„è®¯',\n      å…³é”®è¯: item.json.categories || [],\n      \n      // åª’ä½“èµ„æº\n      ç¼©ç•¥å›¾URL: item.json.enclosure?.url || '',\n      å›¾ç‰‡é›†åˆ: '',\n      \n      // çŠ¶æ€å’Œè´¨é‡\n      è´¨é‡åˆ†æ•°: 85, // é»˜è®¤åˆ†æ•°ï¼Œåç»­AIè¯„ä¼°\n      å¤„ç†çŠ¶æ€: 'å¾…å¤„ç†',\n      å®¡æ ¸çŠ¶æ€: 'æœªå®¡æ ¸',\n      \n      // æ˜¾ç¤ºå±æ€§\n      æ ‡é¢˜é¢œè‰²: '',\n      é™„åŠ å±æ€§: ['æ¨è'],\n      æ’åºæƒé‡: 1,\n      \n      // ç³»ç»Ÿå­—æ®µ\n      åŸå¸‚ID: 1,\n      è¯„è®ºå¼€å…³: true,\n      è·³è½¬åœ°å€: '',\n      \n      // ç«é¸Ÿé—¨æˆ·ä¸“ç”¨å­—æ®µ\n      ç«é¸Ÿæ–‡ç« ID: 0,\n      é˜…è¯»æ¬¡æ•°: 0,\n      å‘å¸ƒäººID: 1,\n      \n      // å¤„ç†è®°å½•\n      é”™è¯¯ä¿¡æ¯: '',\n      å¤„ç†æ—¶é—´: Date.now(),\n      AIè¯„ä¼°ç»“æœ: '',\n      é‡å¤æ£€æŸ¥ç»“æœ: '',\n      \n      // åŸå§‹æ•°æ®ä¿ç•™\n      _åŸå§‹æ•°æ®: item.json\n    };\n    \n    // å†…å®¹è´¨é‡æ£€æŸ¥\n    if (processedItem.æ ‡é¢˜.length > 10 && processedItem.å†…å®¹.length > 50) {\n      processedItems.push({ json: processedItem });\n    }\n    \n  } catch (error) {\n    console.error('å¤„ç†é¡¹ç›®æ—¶å‡ºé”™:', error);\n    // è®°å½•é”™è¯¯ä½†ç»§ç»­å¤„ç†å…¶ä»–é¡¹ç›®\n  }\n}\n\nreturn processedItems;"
      },
      "id": "content-processor",
      "name": "æ™ºèƒ½å†…å®¹å¤„ç†",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        680,
        300
      ]
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "create",
        "databaseId": "f352dd44-bdcc-4a20-85da-84361489a1e0",
        "title": "={{$json.æ ‡é¢˜}}",
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "çŸ­æ ‡é¢˜",
              "type": "rich_text",
              "richTextValue": "={{$json.çŸ­æ ‡é¢˜ || ''}}"
            },
            {
              "key": "å†…å®¹",
              "type": "rich_text",
              "richTextValue": "={{$json.å†…å®¹}}"
            },
            {
              "key": "æ‘˜è¦",
              "type": "rich_text",
              "richTextValue": "={{$json.æ‘˜è¦ || ''}}"
            },
            {
              "key": "æ¥æº",
              "type": "select",
              "selectValue": "={{$json.æ¥æº || 'APIé‡‡é›†'}}"
            },
            {
              "key": "ä½œè€…",
              "type": "rich_text",
              "richTextValue": "={{$json.ä½œè€… || 'AIé‡‡é›†'}}"
            },
            {
              "key": "åŸå§‹URL",
              "type": "url",
              "urlValue": "={{$json.åŸå§‹URL || ''}}"
            },
            {
              "key": "æ¥æºç½‘å€",
              "type": "url",
              "urlValue": "={{$json.æ¥æºç½‘å€ || ''}}"
            },
            {
              "key": "å‘å¸ƒæ—¥æœŸ",
              "type": "date",
              "dateValue": "={{$json.å‘å¸ƒæ—¥æœŸ || new Date().toISOString()}}"
            },
            {
              "key": "åˆ†ç±»ID",
              "type": "number",
              "numberValue": "={{$json.åˆ†ç±»ID || 1}}"
            },
            {
              "key": "åˆ†ç±»åç§°",
              "type": "select",
              "selectValue": "={{$json.åˆ†ç±»åç§° || 'ç§‘æŠ€èµ„è®¯'}}"
            },
            {
              "key": "å…³é”®è¯",
              "type": "multi_select",
              "multiSelectValue": "={{$json.å…³é”®è¯ && Array.isArray($json.å…³é”®è¯) ? $json.å…³é”®è¯ : []}}"
            },
            {
              "key": "ç¼©ç•¥å›¾URL",
              "type": "url",
              "urlValue": "={{$json.ç¼©ç•¥å›¾URL || ''}}"
            },
            {
              "key": "å›¾ç‰‡é›†åˆ",
              "type": "rich_text",
              "richTextValue": "={{$json.å›¾ç‰‡é›†åˆ || ''}}"
            },
            {
              "key": "è´¨é‡åˆ†æ•°",
              "type": "number",
              "numberValue": "={{$json.è´¨é‡åˆ†æ•° || 0}}"
            },
            {
              "key": "å¤„ç†çŠ¶æ€",
              "type": "select",
              "selectValue": "å·²å­˜å‚¨"
            },
            {
              "key": "å®¡æ ¸çŠ¶æ€",
              "type": "select",
              "selectValue": "æœªå®¡æ ¸"
            },
            {
              "key": "æ ‡é¢˜é¢œè‰²",
              "type": "rich_text",
              "richTextValue": "={{$json.æ ‡é¢˜é¢œè‰² || ''}}"
            },
            {
              "key": "é™„åŠ å±æ€§",
              "type": "multi_select",
              "multiSelectValue": "={{$json.é™„åŠ å±æ€§ && Array.isArray($json.é™„åŠ å±æ€§) ? $json.é™„åŠ å±æ€§ : ['æ¨è']}}"
            },
            {
              "key": "æ’åºæƒé‡",
              "type": "number",
              "numberValue": "={{$json.æ’åºæƒé‡ || 1}}"
            },
            {
              "key": "åŸå¸‚ID",
              "type": "number",
              "numberValue": "={{$json.åŸå¸‚ID || 1}}"
            },
            {
              "key": "è¯„è®ºå¼€å…³",
              "type": "checkbox",
              "checkboxValue": "={{$json.è¯„è®ºå¼€å…³ !== false}}"
            },
            {
              "key": "è·³è½¬åœ°å€",
              "type": "url",
              "urlValue": "={{$json.è·³è½¬åœ°å€ || ''}}"
            },
            {
              "key": "ç«é¸Ÿæ–‡ç« ID",
              "type": "number",
              "numberValue": "={{$json.ç«é¸Ÿæ–‡ç« ID || 0}}"
            },
            {
              "key": "é˜…è¯»æ¬¡æ•°",
              "type": "number",
              "numberValue": "={{$json.é˜…è¯»æ¬¡æ•° || 0}}"
            },
            {
              "key": "å‘å¸ƒäººID",
              "type": "number",
              "numberValue": "={{$json.å‘å¸ƒäººID || 1}}"
            },
            {
              "key": "é”™è¯¯ä¿¡æ¯",
              "type": "rich_text",
              "richTextValue": "={{$json.é”™è¯¯ä¿¡æ¯ || ''}}"
            },
            {
              "key": "å¤„ç†æ—¶é—´",
              "type": "number",
              "numberValue": "={{$json.å¤„ç†æ—¶é—´ || Date.now()}}"
            },
            {
              "key": "AIè¯„ä¼°ç»“æœ",
              "type": "rich_text",
              "richTextValue": "={{$json.AIè¯„ä¼°ç»“æœ || ''}}"
            },
            {
              "key": "é‡å¤æ£€æŸ¥ç»“æœ",
              "type": "rich_text",
              "richTextValue": "={{$json.é‡å¤æ£€æŸ¥ç»“æœ || ''}}"
            }
          ]
        },
        "options": {
          "iconType": "emoji",
          "iconEmoji": "ğŸ“°"
        }
      },
      "id": "notion-storage",
      "name": "Notionå­˜å‚¨èŠ‚ç‚¹",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2,
      "position": [
        900,
        300
      ],
      "credentials": {
        "notionApi": {
          "id": "20a4bada-9d03-4343-af6d-cd77f5a72bac",
          "name": "Notion APIå‡­æ®"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "// å‡†å¤‡ç«é¸Ÿé—¨æˆ·å‘å¸ƒæ•°æ®\nconst items = $input.all();\nconst publishItems = [];\n\nfor (const item of items) {\n  try {\n    // ä»Notionå­˜å‚¨ç»“æœä¸­æå–æ•°æ®\n    const notionData = item.json;\n    \n    // æ„å»ºç«é¸Ÿé—¨æˆ·APIæ•°æ®\n    const firebird_data = {\n      // APIåŸºç¡€å‚æ•°\n      service: \"article\",\n      action: \"put\",\n      \n      // å†…å®¹å­—æ®µ - ä¸¥æ ¼æŒ‰ç…§å®˜æ–¹APIæ–‡æ¡£\n      title: notionData.properties?.æ ‡é¢˜?.title?.[0]?.plain_text?.substring(0, 60) || '',\n      typeid: notionData.properties?.åˆ†ç±»ID?.number || 1,\n      body: notionData.properties?.å†…å®¹?.rich_text?.[0]?.plain_text || '',\n      writer: notionData.properties?.ä½œè€…?.rich_text?.[0]?.plain_text || 'AIé‡‡é›†',\n      source: notionData.properties?.æ¥æº?.select?.name || 'AIé‡‡é›†',\n      sourceurl: notionData.properties?.åŸå§‹URL?.url || '',\n      keywords: notionData.properties?.å…³é”®è¯?.multi_select?.map(k => k.name).join(',').substring(0, 50) || '',\n      description: notionData.properties?.æ‘˜è¦?.rich_text?.[0]?.plain_text?.substring(0, 255) || '',\n      litpic: notionData.properties?.ç¼©ç•¥å›¾URL?.url || '',\n      \n      // ç³»ç»Ÿå­—æ®µ\n      cityid: 1,\n      arcrank: 1,\n      weight: notionData.properties?.æ’åºæƒé‡?.number || 1,\n      notpost: notionData.properties?.è¯„è®ºå¼€å…³?.checkbox ? 0 : 1,\n      color: notionData.properties?.æ ‡é¢˜é¢œè‰²?.rich_text?.[0]?.plain_text || '',\n      flag: 'r', // æ¨èæ ‡è®°\n      \n      // ç§»åŠ¨ç«¯å†…å®¹\n      mbody: notionData.properties?.å†…å®¹?.rich_text?.[0]?.plain_text || '',\n      \n      // å¯é€‰å­—æ®µ\n      subtitle: notionData.properties?.çŸ­æ ‡é¢˜?.rich_text?.[0]?.plain_text?.substring(0, 36) || '',\n      redirecturl: notionData.properties?.è·³è½¬åœ°å€?.url || '',\n      \n      // ä¿å­˜Notioné¡µé¢IDç”¨äºåç»­æ›´æ–°\n      _notion_page_id: notionData.id\n    };\n    \n    publishItems.push({ json: firebird_data });\n    \n  } catch (error) {\n    console.error('å‡†å¤‡å‘å¸ƒæ•°æ®æ—¶å‡ºé”™:', error);\n  }\n}\n\nreturn publishItems;"
      },
      "id": "publish-prep",
      "name": "å‘å¸ƒæ•°æ®å‡†å¤‡",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1120,
        300
      ]
    },
    {
      "parameters": {
        "url": "https://hawaiihub.net/include/ajax.php",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "httpMethod": "POST",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/x-www-form-urlencoded"
            },
            {
              "name": "Cookie",
              "value": "={{$env.HUONIAO_FULL_COOKIES}}"
            },
            {
              "name": "User-Agent",
              "value": "n8n-automation/1.0"
            },
            {
              "name": "Accept",
              "value": "application/json, text/plain, */*"
            },
            {
              "name": "X-Requested-With",
              "value": "XMLHttpRequest"
            }
          ]
        },
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "service",
              "value": "={{$json.service}}"
            },
            {
              "name": "action",
              "value": "={{$json.action}}"
            },
            {
              "name": "title",
              "value": "={{$json.title}}"
            },
            {
              "name": "typeid",
              "value": "={{$json.typeid}}"
            },
            {
              "name": "body",
              "value": "={{$json.body}}"
            },
            {
              "name": "writer",
              "value": "={{$json.writer}}"
            },
            {
              "name": "source",
              "value": "={{$json.source}}"
            },
            {
              "name": "sourceurl",
              "value": "={{$json.sourceurl}}"
            },
            {
              "name": "keywords",
              "value": "={{$json.keywords}}"
            },
            {
              "name": "description",
              "value": "={{$json.description}}"
            },
            {
              "name": "litpic",
              "value": "={{$json.litpic}}"
            },
            {
              "name": "cityid",
              "value": "={{$json.cityid}}"
            },
            {
              "name": "arcrank",
              "value": "={{$json.arcrank}}"
            },
            {
              "name": "weight",
              "value": "={{$json.weight}}"
            },
            {
              "name": "notpost",
              "value": "={{$json.notpost}}"
            },
            {
              "name": "color",
              "value": "={{$json.color}}"
            },
            {
              "name": "flag",
              "value": "={{$json.flag}}"
            },
            {
              "name": "mbody",
              "value": "={{$json.mbody}}"
            },
            {
              "name": "subtitle",
              "value": "={{$json.subtitle}}"
            },
            {
              "name": "redirecturl",
              "value": "={{$json.redirecturl}}"
            }
          ]
        },
        "options": {
          "timeout": 30000,
          "retry": {
            "enabled": true,
            "maxTries": 3,
            "waitBetweenTries": 5000
          },
          "response": {
            "responseFormat": "json"
          }
        }
      },
      "id": "firebird-publish",
      "name": "ç«é¸Ÿé—¨æˆ·å‘å¸ƒ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [
        1340,
        300
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "huoniao_api_credentials",
          "name": "ç«é¸Ÿé—¨æˆ·APIå‡­æ®"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "// æ›´æ–°Notionè®°å½•çŠ¶æ€\nconst items = $input.all();\nconst updateItems = [];\n\nfor (const item of items) {\n  try {\n    const publishResult = item.json;\n    \n    // æ£€æŸ¥å‘å¸ƒç»“æœ\n    if (publishResult.state === 100) {\n      // å‘å¸ƒæˆåŠŸï¼Œå‡†å¤‡æ›´æ–°NotionçŠ¶æ€\n      updateItems.push({\n        json: {\n          notion_page_id: publishResult._notion_page_id,\n          update_data: {\n            å¤„ç†çŠ¶æ€: 'å·²å‘å¸ƒ',\n            ç«é¸Ÿæ–‡ç« ID: publishResult.info || 0,\n            é”™è¯¯ä¿¡æ¯: ''\n          }\n        }\n      });\n    } else {\n      // å‘å¸ƒå¤±è´¥ï¼Œè®°å½•é”™è¯¯\n      updateItems.push({\n        json: {\n          notion_page_id: publishResult._notion_page_id,\n          update_data: {\n            å¤„ç†çŠ¶æ€: 'å·²æ‹’ç»',\n            é”™è¯¯ä¿¡æ¯: `å‘å¸ƒå¤±è´¥: ${publishResult.info || 'æœªçŸ¥é”™è¯¯'}`\n          }\n        }\n      });\n    }\n    \n  } catch (error) {\n    console.error('å¤„ç†å‘å¸ƒç»“æœæ—¶å‡ºé”™:', error);\n  }\n}\n\nreturn updateItems;"
      },
      "id": "status-update-prep",
      "name": "çŠ¶æ€æ›´æ–°å‡†å¤‡",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1560,
        300
      ]
    },
    {
      "parameters": {
        "resource": "page",
        "operation": "update",
        "pageId": "={{$json.notion_page_id}}",
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "å¤„ç†çŠ¶æ€",
              "type": "select",
              "selectValue": "={{$json.update_data.å¤„ç†çŠ¶æ€}}"
            },
            {
              "key": "ç«é¸Ÿæ–‡ç« ID",
              "type": "number",
              "numberValue": "={{$json.update_data.ç«é¸Ÿæ–‡ç« ID}}"
            },
            {
              "key": "é”™è¯¯ä¿¡æ¯",
              "type": "rich_text",
              "richTextValue": "={{$json.update_data.é”™è¯¯ä¿¡æ¯}}"
            }
          ]
        }
      },
      "id": "notion-status-update",
      "name": "NotionçŠ¶æ€æ›´æ–°",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2,
      "position": [
        1780,
        300
      ],
      "credentials": {
        "notionApi": {
          "id": "20a4bada-9d03-4343-af6d-cd77f5a72bac",
          "name": "Notion APIå‡­æ®"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// å·¥ä½œæµæ‰§è¡Œæ—¥å¿—è®°å½•\nconst items = $input.all();\nconst logData = {\n  workflow_id: 'notion-integration-workflow',\n  execution_time: new Date().toISOString(),\n  total_items: items.length,\n  success_count: 0,\n  error_count: 0,\n  items: []\n};\n\nfor (const item of items) {\n  try {\n    if (item.json.update_data?.å¤„ç†çŠ¶æ€ === 'å·²å‘å¸ƒ') {\n      logData.success_count++;\n    } else {\n      logData.error_count++;\n    }\n    \n    logData.items.push({\n      notion_page_id: item.json.notion_page_id,\n      status: item.json.update_data?.å¤„ç†çŠ¶æ€,\n      error: item.json.update_data?.é”™è¯¯ä¿¡æ¯\n    });\n    \n  } catch (error) {\n    logData.error_count++;\n    console.error('è®°å½•æ—¥å¿—æ—¶å‡ºé”™:', error);\n  }\n}\n\n// è®¡ç®—æˆåŠŸç‡\nlogData.success_rate = logData.total_items > 0 ? \n  (logData.success_count / logData.total_items * 100).toFixed(2) + '%' : '0%';\n\nconsole.log('å·¥ä½œæµæ‰§è¡Œå®Œæˆ:', JSON.stringify(logData, null, 2));\n\nreturn [{ json: logData }];"
      },
      "id": "workflow-logger",
      "name": "å·¥ä½œæµæ—¥å¿—è®°å½•",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2000,
        300
      ]
    }
  ],
  "connections": {
    "å®šæ—¶è§¦å‘å™¨": {
      "main": [
        [
          {
            "node": "RSSå†…å®¹é‡‡é›†",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "RSSå†…å®¹é‡‡é›†": {
      "main": [
        [
          {
            "node": "æ™ºèƒ½å†…å®¹å¤„ç†",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ™ºèƒ½å†…å®¹å¤„ç†": {
      "main": [
        [
          {
            "node": "Notionå­˜å‚¨èŠ‚ç‚¹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notionå­˜å‚¨èŠ‚ç‚¹": {
      "main": [
        [
          {
            "node": "å‘å¸ƒæ•°æ®å‡†å¤‡",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å‘å¸ƒæ•°æ®å‡†å¤‡": {
      "main": [
        [
          {
            "node": "ç«é¸Ÿé—¨æˆ·å‘å¸ƒ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ç«é¸Ÿé—¨æˆ·å‘å¸ƒ": {
      "main": [
        [
          {
            "node": "çŠ¶æ€æ›´æ–°å‡†å¤‡",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "çŠ¶æ€æ›´æ–°å‡†å¤‡": {
      "main": [
        [
          {
            "node": "NotionçŠ¶æ€æ›´æ–°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "NotionçŠ¶æ€æ›´æ–°": {
      "main": [
        [
          {
            "node": "å·¥ä½œæµæ—¥å¿—è®°å½•",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2025-08-23T10:14:00.000Z",
      "updatedAt": "2025-08-23T10:14:00.000Z",
      "id": "notion-integration",
      "name": "Notioné›†æˆ"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2025-08-23T10:14:00.000Z",
  "versionId": "1"
}