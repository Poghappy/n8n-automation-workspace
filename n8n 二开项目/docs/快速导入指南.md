# n8n工作流快速导入指南

## ⚠️ **重要提醒**

**不能直接导入就运行！** 需要先完成以下配置步骤。

## 📋 **导入前必须准备的东西**

### 1. **API密钥和凭据**
你需要准备这些API密钥：

```bash
# Notion API
NOTION_API_TOKEN=secret_xxxxxxxxxxxx
NOTION_DATABASE_ID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx

# OpenAI API  
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# 火鸟门户会话
HUONIAO_SESSION_ID=xxxxxxxxxxxxxxxxxxxxxxxxxx
```

### 2. **环境配置文件**
创建 `.env` 文件：
```bash
cp .env.template .env
# 然后编辑 .env 文件，填入上面的API密钥
```

## 🚀 **正确的导入步骤**

### 步骤1: 启动n8n服务
```bash
# 启动Docker容器
docker-compose -f docker-compose-n8n.yml up -d

# 检查服务状态
docker-compose -f docker-compose-n8n.yml ps
```

### 步骤2: 访问n8n界面
打开浏览器访问: `http://localhost:5678`

### 步骤3: 配置凭据
在n8n界面中，先配置这些凭据：

#### 3.1 Notion API凭据
- 类型: `Notion API`
- 名称: `notion_api`
- API Key: 你的Notion API令牌

#### 3.2 OpenAI API凭据
- 类型: `OpenAI API`
- 名称: `openai_api`
- API Key: 你的OpenAI API密钥

#### 3.3 火鸟门户凭据
- 类型: `HTTP Header Auth`
- 名称: `huoniao_session`
- Header Name: `Cookie`
- Header Value: `PHPSESSID=你的会话ID`

### 步骤4: 导入工作流
1. 在n8n界面点击 "Import from file"
2. 选择文件: `火鸟门户_新闻采集工作流_增强版.json`
3. 点击导入

### 步骤5: 配置工作流节点
导入后需要检查这些节点的配置：

#### 5.1 检查凭据绑定
确保每个节点都绑定了正确的凭据：
- Notion节点 → `notion_api`
- OpenAI节点 → `openai_api`
- 火鸟API节点 → `huoniao_session`

#### 5.2 检查Notion数据库ID
在Notion节点中，确保数据库ID正确设置

#### 5.3 检查火鸟API端点
确认火鸟API节点的URL是: `https://hawaiihub.net/include/ajax.php`

### 步骤6: 测试工作流
1. 点击工作流右上角的"Execute Workflow"
2. 观察每个节点的执行结果
3. 检查是否有错误信息

## 🔧 **常见配置问题**

### 问题1: "模块未找到"错误
**原因**: 工作流引用了本地的JavaScript模块
**解决**: 
```bash
# 确保这些文件在正确位置
ls -la 火鸟门户_内容处理核心模块*.js
```

### 问题2: API凭据无效
**症状**: 节点显示红色错误
**解决**: 
1. 检查API密钥是否正确
2. 确认API密钥是否有足够权限
3. 重新创建凭据

### 问题3: Notion数据库访问失败
**症状**: Notion节点报错403
**解决**:
1. 确认Notion集成已添加到数据库
2. 检查数据库ID是否正确
3. 验证API权限

### 问题4: 火鸟门户会话过期
**症状**: 火鸟API返回登录页面
**解决**:
```bash
# 重新获取会话ID
node scripts/setup-huoniao-cookies.js
```

## 📝 **推荐的完整部署方式**

虽然可以手动导入，但推荐使用自动化部署脚本：

```bash
# 一键部署（推荐）
node scripts/deploy-automated-news-workflow.js --env=development

# 这个脚本会自动：
# 1. 验证环境配置
# 2. 创建必要的凭据
# 3. 导入工作流
# 4. 配置所有节点
# 5. 运行测试验证
```

## ✅ **验证导入成功**

导入完成后，检查这些指标：

1. **工作流状态**: 显示为"Active"
2. **所有节点**: 没有红色错误标识
3. **测试执行**: 能够成功运行
4. **日志输出**: 没有错误信息

## 🆘 **如果遇到问题**

1. **查看错误日志**: 点击失败的节点查看详细错误
2. **检查凭据**: 确认所有API密钥都正确配置
3. **运行诊断**: 
   ```bash
   node scripts/test-credentials.js
   ```
4. **查看故障排除指南**: `docs/故障排除指南.md`

## 💡 **小贴士**

- **第一次导入建议用开发环境测试**
- **确保所有API密钥都有效且有足够配额**
- **建议先阅读 `docs/部署指南.md` 了解完整流程**
- **遇到问题时，日志文件在 `logs/` 目录下**

---

**记住**: 直接导入只是第一步，正确配置才是关键！