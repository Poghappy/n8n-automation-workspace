# 🔥 火鸟门户新闻模块完整指南

> **适用版本**：HuoNiaoCMS v8.x（hawaiihub.net 当前部署）  
> **更新时间**：2025-01-20  
> **用途**：本地调试 / n8n 工作流 / 采集与发布自动化  
> **认证方式**：涉及写入/修改/删除/评论的接口需要登录 Cookie（`PHPSESSID=...`）

## 📝 更新记录
- [2025-01-20] 合并数据库字典新闻模块内容，形成完整指南

---

## 🔧 使用前准备

### 环境变量设置
```bash
# 登录后台或前台后，从浏览器复制 PHPSESSID
export HNSESS="PHPSESSID=你的session值"
```

### 📋 系统配置信息

#### 🌐 服务器配置
- **主要API地址**: `https://hawaiihub.net/include/ajax.php`
- **新版API处理器**: `https://hawaiihub.net/api/handlers/article.class.php`
- **服务器IP**: 154.40.47.153
- **系统版本**: HuoNiaoCMS v8.6 Release
- **PHP版本**: 7.4.33
- **数据库**: MySQL 5.7.44

#### 📂 新闻分类配置
| 分类ID | 分类名称 | 用途说明 |
|--------|----------|----------|
| **1** | 科技资讯 | 科技、AI、互联网新闻 |
| **2** | 本地新闻 | 夏威夷本地新闻、社区动态 |
| **3** | 生活资讯 | 生活服务、实用信息 |

#### 👤 系统用户配置
- **城市ID**: 1 (夏威夷)
- **管理员ID**: 1 (admin)
- **审核状态**: 1 (已审核)

---

## 📖 基础说明

### API 调用规范
- **基址（Base URL）**：`https://hawaiihub.net/include/ajax.php`
- **调用方式**：`GET`（查询类） / `POST`（写入类）
- **必备参数**：`service=article` + `action=<方法名>`
- **鉴权（Auth）**：登录后携带 `Cookie: PHPSESSID=<你的会话>`（非公开接口）
- **分页**：`page` 从 1 开始，`pageSize` 默认 10
- **排序（orderby）**：
  - `1`=按发布时间；`2`=总浏览量；`2.1/2.2/2.3/2.4`=今日/昨日/本周/本月浏览量
  - `3`=随机；`4.1/4.2/4.3/4.4`=今日/昨日/本周/本月评论热度

### 状态码与返回格式
- 统一返回：`{ state: <int>, info: <数据或错误字符串> }`
- `100`=成功；`102`=无数据（`"No data!"`）；`200`=错误；`101`=权限/校验失败

### 常用筛选参数
- `typeid` 分类ID，`title` 标题模糊，`notid` 排除ID，`cityid` 城市，`litpic/thumb` 是否有图
- `flag=h,r,b,t,p`（头条/推荐/加粗/置顶/图片），可多值逗号分隔，如 `flag=h,p`

### 网关与安全过滤
- **RSA 解密**：长度 172 或包含 `||rsa||` 的值自动解密
- **ID 强制数值化**：`id/cityid/sid/state` 被转换为仅逗号分隔的数字序列（防注入）
- **XSS 清理**：键名与字符串值统一做 `RemoveXSS(...)`

---

## 📋 基础信息查询（READ 操作）

### 1. 获取新闻模块基础配置
```bash
curl "https://hawaiihub.net/include/ajax.php?service=article&action=config"
```

**返回参数信息**：
- `channelName` 模块名称
- `logoUrl` logo地址
- `subDomain` 访问方式（0：主域名 1：子域名 2：子目录）
- `channelDomain` 绑定的域名
- `channelSwitch` 模块开关（0：启用 1：禁用）
- `title/keywords/description` SEO信息
- `hotline` 咨询热线
- `atlasMax` 图集数量限制
- `template` 风格模板
- `softSize/thumbSize/atlasSize` 各类文件上传限制

### 2. 获取城市列表
```bash
curl "https://hawaiihub.net/include/ajax.php?service=article&action=city"
```

### 3. 获取新闻分类列表
```bash
# 获取所有分类（包含子级）
curl "https://hawaiihub.net/include/ajax.php?service=article&action=type&son=1"

# 按内容形态过滤（mold：0=图文，1=图集，2=视频）
curl "https://hawaiihub.net/include/ajax.php?service=article&action=type&mold=0&son=1"

# 分页获取
curl "https://hawaiihub.net/include/ajax.php?service=article&action=type&mold=0&page=1&pageSize=50"
```

**参数说明**：
- `mold`：分类模型（数字；通常传 0 或按站点约定）
- `type`：父级ID（0 为顶级）
- `son`：是否包含子级（1=是，0=否）
- `page`，`pageSize`：分页参数

### 4. 获取指定分类详细信息
```bash
curl "https://hawaiihub.net/include/ajax.php?service=article&action=typeDetail&id=1"
```

### 5. 获取新闻列表

#### 基础查询
```bash
curl "https://hawaiihub.net/include/ajax.php?service=article&action=alist&page=1&pageSize=10"
```

#### 高级筛选
```bash
curl "https://hawaiihub.net/include/ajax.php?service=article&action=alist&typeid=1&title=测试&flag=r&thumb=1&orderby=1&state=1&page=1&pageSize=5"
```

#### 查询参数表
| 参数 | 类型 | 说明 |
|------|------|------|
| `mold` | int | 分类模型（与栏目模型关联） |
| `typeid` | int/CSV | 分类ID（支持逗号多个） |
| `notid` | int/CSV | 排除的资讯ID |
| `title` | string | 标题关键词（模糊） |
| `flag` | string | 自定义属性，`h,r,b,t,p` 多值逗号 |
| `thumb`/`litpic` | int/bool | 是否要求有封面图 |
| `orderby` | string | 排序（见基础说明） |
| `u` | int | `1` 仅当前登录人的稿件；否则取公开稿件 |
| `uid` | int | 指定会员ID的稿件 |
| `state` | int | 管理端过滤 `arcrank`（仅 `u=1` 时有效） |
| `page`/`pageSize` | int | 分页，从 1 开始 |
| `media` | string | `is`=有媒体号；`no`=无媒体号；或传具体 `media` ID |
| `cityid` | int | 城市ID |

### 6. 获取新闻详细信息
```bash
curl "https://hawaiihub.net/include/ajax.php?service=article&action=detail&id=10086"
```

**返回字段**：
`id,title,cityid,subtitle,flag,redirecturl,litpic,litpicSource,source,sourceurl,writer,typeid,admin,prop,article_prop,admin_nickname,keywords,keywordsList,description,color,click,arcrank,pubdate,body,mbody,imglist,videotype,videotype_,videourl,realVideoUrl,videotime,video_hour,video_minute,video_second`

### 7. 获取新闻评论列表
```bash
curl "https://hawaiihub.net/include/ajax.php?service=article&action=common&newsid=1&page=1&pageSize=10"
```

---

## 🚀 新版API处理器调用（推荐）

### 发布新闻（推荐方式）
```bash
curl -X POST "https://hawaiihub.net/api/handlers/article.class.php" \
  -H "Content-Type: application/json" \
  -d '{
    "service": "article",
    "action": "add",
    "param": {
      "cityid": 1,
      "typeid": 1,
      "title": "通过新版API发布的新闻",
      "body": "这是通过新版API处理器发布的新闻内容",
      "writer": "API测试",
      "source": "火鸟API",
      "keywords": "API,测试,新闻",
      "description": "新版API测试新闻描述",
      "admin": 1,
      "arcrank": 1,
      "pubdate": 1640995200
    }
  }'
```

### 获取新闻列表（新版API）
```bash
curl -X POST "https://hawaiihub.net/api/handlers/article.class.php" \
  -H "Content-Type: application/json" \
  -d '{
    "service": "article",
    "action": "list",
    "param": {
      "page": 1,
      "pageSize": 10,
      "typeid": 1
    }
  }'
```

---

## ✏️ 内容管理（CREATE/UPDATE/DELETE 操作）

**注意：以下操作需要登录会话，请先获取 PHPSESSID**

### 📝 发布新闻（PUT）

#### 发布参数详解
**必填校验**：`cityid`、`title`、`typeid`、`writer`  
**内容要求**：
- `mold=0`（图文）需要 `body`
- `mold=1`（图集）需要 `imglist`
- `mold=2`（视频）需要 `video` 或 `videourl`

**可选参数**：`keywords`、`description`、`litpic`、`source`、`sourceurl`、`flag`、`pubdate`、`arcrank`（状态）等

#### A) 图文发布
```bash
curl -X POST "https://hawaiihub.net/include/ajax.php?service=article&action=put" \
  -H "Cookie: $HNSESS" \
  -d "cityid=1" \
  -d "typeid=1" \
  -d "mold=0" \
  -d "title=API 发布测试：图文" \
  -d "writer=HawaiiHub Bot" \
  -d "source=HawaiiHub" \
  -d "sourceurl=https://hawaiihub.net/" \
  -d "keywords=夏威夷,新闻" \
  -d "description=这是通过API发布的测试图文新闻" \
  -d "litpic=https://hawaiihub.net/static/cover.jpg" \
  -d "body=<p>正文HTML内容</p>"
```

#### B) 图集发布
```bash
curl -X POST "https://hawaiihub.net/include/ajax.php?service=article&action=put" \
  -H "Cookie: $HNSESS" \
  -d "cityid=1&typeid=1&mold=1" \
  -d "title=API 发布测试：图集" \
  -d "writer=HawaiiHub Bot" \
  -d "imglist=https://a.com/1.jpg,https://a.com/2.jpg,https://a.com/3.jpg" \
  -d "description=图集说明文字"
```

#### C) 视频发布
```bash
curl -X POST "https://hawaiihub.net/include/ajax.php?service=article&action=put" \
  -H "Cookie: $HNSESS" \
  -d "cityid=1&typeid=1&mold=2&videotype=1" \
  -d "title=API 发布测试：视频" \
  -d "writer=HawaiiHub Bot" \
  -d "videourl=https://video.example.com/abc.mp4" \
  -d "litpic=https://hawaiihub.net/static/video-cover.jpg" \
  -d "description=视频简介"
```

### ✏️ 修改新闻（EDIT）
```bash
curl -X POST "https://hawaiihub.net/include/ajax.php?service=article&action=edit" \
  -H "Cookie: $HNSESS" \
  -d "id=12345" \
  -d "title=标题修订版" \
  -d "description=更新后的摘要" \
  -d "arcrank=1"
```

### 🗑️ 删除新闻（DELETE）
```bash
curl -X POST "https://hawaiihub.net/include/ajax.php?service=article&action=del" \
  -H "Cookie: $HNSESS" \
  -d "id=12345"
```

### 💬 评论管理

#### 发表评论
```bash
curl -X POST "https://hawaiihub.net/include/ajax.php?service=article&action=sendCommon" \
  -H "Cookie: $HNSESS" \
  -d "aid=12345" \
  -d "content=这是来自API的评论"
```

**参数说明**：
- `aid`：文章ID（必填）
- `content`：评论内容（必填）
- `id`：回复某条评论的ID（可选）

---

## 🗄️ 数据库字典

### 核心表结构

#### huoniao_articlelist （新闻信息主表）
| 字段名 | 数据类型 | 默认值 | 允许非空 | 自动递增 | 备注 |
|---|---|---:|---:|---:|---|
| id | mediumint(8) unsigned |  | NO | 是 | 新闻ID（主键） |
| cityid | smallint(5) unsigned | 0 | NO |  | 城市ID |
| title | char(60) |  | NO |  | 信息标题 |
| subtitle | char(36) |  | NO |  | 短标题 |
| flag | set('h','r','b','p','t') |  | NO |  | 附加属性（头条/推荐/加粗/图片/置顶） |
| redirecturl | varchar(255) |  | YES |  | 跳转地址 |
| weight | smallint(4) unsigned | 1 | NO |  | 排序 |
| litpic | char(255) |  | YES |  | 缩略图 |
| source | char(30) |  | NO |  | 来源 |
| sourceurl | char(200) |  | NO |  | 来源网址 |
| writer | char(20) |  | NO |  | 作者 |
| typeid | int(5) unsigned | 0 | NO |  | 分类ID |
| keywords | char(50) |  | NO |  | 关键字 |
| description | varchar(255) |  | NO |  | 描述 |
| mbody | text |  | NO |  | 手机端内容 |
| notpost | tinyint(1) unsigned | 0 | NO |  | 评论开关 |
| click | int(8) unsigned | 0 | NO |  | 阅读次数 |
| color | char(7) |  | NO |  | 标题颜色 |
| arcrank | tinyint(1) unsigned | 0 | NO |  | 信息状态 |
| pubdate | int(10) unsigned | 0 | NO |  | 创建时间 |
| admin | int(8) unsigned | 0 | NO |  | 发布人 |
| del | tinyint(1) unsigned | 0 | NO |  | 是否已删除 |
| waitpay | tinyint(1) unsigned | 0 | NO |  | 等待支付 |
| alonepay | tinyint(1) unsigned | 0 | NO |  | 单独支付 |
| audit_log | text |  | NO |  | 审核记录 |
| audit_state | char(20) |  | NO |  | 审核状态 |
| audit_edit | text |  | NO |  | 审核修改记录 |
| reward_switch | tinyint(1) unsigned | 0 | NO |  | 打赏开关 |
| zan | int(6) unsigned | 0 | NO |  | 赞 |
| videotype | tinyint(1) unsigned | 0 | NO |  | 视频类型 |
| videourl | varchar(255) |  | NO |  | 视频地址 |
| media_state | tinyint(1) unsigned | 1 | NO |  | 自媒体账号状态 |
| typeset | tinyint(1) unsigned | 0 | NO |  | 排版方式 0小图 1大图 |
| zhuanti | int(10) unsigned | 0 | NO |  | 专题 id |
| media | int(10) unsigned | 0 | NO |  | 媒体号 id |

#### huoniao_article （新闻内容）
| 字段名 | 数据类型 | 默认值 | 允许非空 | 自动递增 | 备注 |
|---|---|---:|---:|---:|---|
| id | int(10) unsigned |  | NO | 是 |  |
| aid | int(10) unsigned |  | NO |  | 信息ID |
| body | mediumtext |  | NO |  | 信息内容 |

#### huoniao_articlecommon （新闻评论）
| 字段名 | 数据类型 | 默认值 | 允许非空 | 自动递增 | 备注 |
|---|---|---:|---:|---:|---|
| id | int(10) unsigned |  | NO | 是 |  |
| aid | int(8) unsigned | 0 | NO |  | 信息ID |
| floor | int(8) unsigned | 0 | NO |  | 楼层 |
| userid | int(8) unsigned | 0 | NO |  | 会员ID |
| content | char(255) |  | NO |  | 评论内容 |
| dtime | int(10) |  | NO |  | 评论时间 |
| ip | char(15) |  | NO |  | 评论IP |
| ipaddr | char(30) |  | NO |  | IP归属地 |
| good | int(8) unsigned | 0 | NO |  | 顶 |
| bad | int(8) unsigned | 0 | NO |  | 踩 |
| ischeck | smallint(1) unsigned | 0 | NO |  | 状态 |
| duser | text |  | NO |  | 顶过的会员 |

#### huoniao_articlepic （新闻图集）
| 字段名 | 数据类型 | 默认值 | 允许非空 | 自动递增 | 备注 |
|---|---|---:|---:|---:|---|
| id | int(8) unsigned |  | NO | 是 |  |
| aid | int(8) unsigned |  | NO |  | 信息ID |
| picPath | varchar(255) |  | NO |  | 图片路径 |
| piclnfo | text |  | YES |  | 图片注释 |

### 自媒体相关表

#### huoniao_article_selfmedia （新闻自媒体）
| 字段名 | 数据类型 | 默认值 | 允许非空 | 自动递增 | 备注 |
|---|---|---:|---:|---:|---|
| id | int(10) unsigned |  | NO | 是 |  |
| cityid | int(10) | 0 | NO |  | 城市 |
| userid | int(10) unsigned | 0 | NO |  | 用户 id |
| type | int(1) unsigned | 0 | NO |  | 入驻类型 |
| ac_name | varchar(15) |  | NO |  | 自媒体名称 |
| ac_profile | varchar(40) |  | NO |  | 自媒体介绍 |
| ac_field | int(2) unsigned | 0 | NO |  | 自媒体领域 |
| ac_addrid | int(10) unsigned | 0 | NO |  | 自媒体所在地 |
| ac_photo | varchar(255) |  | NO |  | 头像 |
| op_name | varchar(20) |  | NO |  | 运营者姓名 |
| op_phone | varchar(13) |  | NO |  | 运营者联系电话 |
| op_email | varchar(30) |  | NO |  | 运营者联系邮箱 |
| state | int(1) unsigned | 0 | NO |  | 状态 |
| pubdate | int(10) | 0 | NO |  | 入驻时间 |
| click | int(10) | 0 | NO |  | 浏览次数 |
| weight | int(10) | 0 | NO |  | 排序 |

### 专题相关表

#### huoniao_article_zhuanti （新闻专题）
| 字段名 | 数据类型 | 默认值 | 允许非空 | 自动递增 | 备注 |
|---|---|---:|---:|---:|---|
| id | smallint(5) |  | NO | 是 |  |
| parentid | int(10) unsigned | 0 | NO |  | 父级 id |
| typename | char(200) |  | NO |  | 分类名称 |
| description | varchar(255) |  | NO |  | SEO 描述 |
| weight | smallint(5) unsigned | 50 | NO |  | 排序 |
| pubdate | int(10) | 0 | NO |  | 创建时间 |
| state | tinyint(1) | 0 | NO |  | 状态 |
| flag_r | tinyint(1) | 0 | NO |  | 推荐 |
| flag_h | tinyint(1) | 0 | NO |  | 头条 |
| litpic | char(100) |  | NO |  | 图片 |
| click | int(10) | 0 | NO |  | 浏览次数 |
| typeid | int(10) unsigned | 0 | NO |  | 分类 id |

#### huoniao_article_zhuantilist （新闻专题文章）
| 字段名 | 数据类型 | 默认值 | 允许非空 | 自动递增 | 备注 |
|---|---|---:|---:|---:|---|
| id | int(10) unsigned |  | NO | 是 |  |
| aid | int(10) unsigned | 0 | NO |  | 信息 id |
| typeid | int(10) unsigned | 0 | NO |  | 专题分类 id |

### 缓存和统计表

#### huoniao_article_historyclick （资讯浏览足迹）
| 字段名 | 数据类型 | 默认值 | 允许非空 | 自动递增 | 备注 |
|---|---|---:|---:|---:|---|
| id | int(11) |  | NO | 是 |  |
| uid | int(10) | 0 | NO |  | 浏览者 id |
| fuid | int(10) | 0 | NO |  | 发布者 id |
| aid | int(10) | 0 | NO |  | 信息 id |
| module | varchar(255) |  | NO |  | 模块 |
| module2 | varchar(255) |  | NO |  | 二级类目 |
| date | char(20) |  | NO |  | 时间 |

#### huoniao_article_pagecount_cache （资讯列表 count 缓存表）
| 字段名 | 数据类型 | 默认值 | 允许非空 | 自动递增 | 备注 |
|---|---|---:|---:|---:|---|
| id | int(11) |  | NO | 是 |  |
| `key` | text |  | YES |  | 缓存键 |
| value | int(30) |  | YES |  | 缓存值 |
| update_at | int(30) |  | YES |  | 更新时间戳 |

---

## 🛠️ 开发建议

### 1. 错误处理
- 始终检查返回的 `state` 字段
- `state=100` 表示成功，其他值需要处理错误
- 记录 `info` 字段中的错误信息

### 2. 安全建议
- 使用 HTTPS 进行所有 API 调用
- 妥善保管 PHPSESSID，避免泄露
- 对用户输入进行适当的验证和清理

### 3. 性能优化
- 合理设置 `pageSize`，避免一次获取过多数据
- 使用适当的缓存策略
- 避免频繁的 API 调用

### 4. n8n 工作流集成
- 使用环境变量存储敏感信息
- 实现适当的重试机制
- 添加日志记录用于调试

---

## 📞 技术支持

- **官方网站**：https://hawaiihub.net
- **技术文档**：参考火鸟门户系统官方文档
- **开发者**：苏州酷曼软件技术有限公司

---

*最后更新：2025-01-20*