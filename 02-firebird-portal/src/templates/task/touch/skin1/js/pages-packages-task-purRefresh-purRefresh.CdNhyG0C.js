import{c as a,a as e,P as t,i as l,j as o,h as n,b as s,n as i,d as r,e as c,r as p,Z as d,k as u,o as m,l as h,w as g,m as f,q as b,A as k,t as y,v,y as x,F as w,x as C,G as _,B as D,C as B,D as F,z as P}from"./index-cF6skFzP.js";import{r as j,_ as I}from"./uni-app.es.J1otcSEF.js";import{p as $}from"./public_pay.CFacMRuw.js";import{p as T}from"./task.9CwFAmAC.js";import{_ as V}from"./_plugin-vue_export-helper.BCo6x5W8.js";let S=f();var U;const L=V({components:{paypop:$},data:()=>({globalData:S.globalData,wh:S.globalData.navTop+S.globalData.appFullWh,bh:0,masterDomain:S.globalData.masterDomain,biasTop_88:S.globalData.biasTop_88,appBack:S.globalData.appBack,imgurl:S.globalData.imgPath+"/task/",themedata:{},userdata:{level:{}},listdata:[{}],leveldata:{},showPayPop:!1,privateb:!1,brefresh:!1,activeIndex:0,payInfo:{},imgVersion:"",id:"",pages:"",platForm:S.globalData.platForm,appBoolean:S.globalData.appBoolean,channelDomain:S.globalData.channelDomain,appFullScreen:S.globalData.appFullScreen}),onLoad(a){U=this,-1==S.globalData.wxprivate?S.watchG("wxprivate",(function(e){U.wxprivate=e,e?U.privateb=!0:U.onLoadClone3389(a)})):S.globalData.wxprivate?U.privateb=!0:U.onLoadClone3389(a)},onReady(){},onShow(){let e=a();e.select(".botbtn").boundingClientRect(),e.exec((a=>{U.bh=a[0].height})),this.brefresh&&this.onLoadClone3389({}),U.brefresh=!0},onHide(){},onUnload(){},onPullDownRefresh(){},onReachBottom(){},onShareAppMessage(a){return{title:this.themedata.title,imageUrl:this.themedata.sharePic,path:"/pages/packages/task/my/my"}},onShareTimeline(){return{title:this.themedata.title,imageUrl:this.themedata.sharePic,path:"/pages/packages/task/my/my"}},methods:{onLoadClone3389(a){e({title:"加载中",mask:!0,success:()=>{t({key:"warnColor",success:a=>{t({key:"warnColor",success:a=>{U.themedata=a.data.themeDate,U.setBgColor(this.themedata.themeBackgroundColor),a.data.outtime<Date.parse(new Date)&&l({key:"warnColor",success:()=>{U.$ajax.post({url:"include/ajax.php?service=task&action=config"}).then((a=>{null!=a.data.info.themeBackgroundColor?(U.themedata=a.data.info,o({key:"warnColor",data:{themeDate:this.themedata,outtime:Date.parse(new Date)+36e5}}),U.setBgColor(this.themedata.themeBackgroundColor),n()):(n(),s({title:"服务器出错",icon:"error",mask:!0,duration:5e3}))}))}})}}),n()},fail:a=>{U.$ajax.post({url:"include/ajax.php?service=task&action=config"}).then((a=>{null!=a.data.info.themeBackgroundColor?(U.themedata=a.data.info,o({key:"warnColor",data:{themeDate:this.themedata,outtime:Date.parse(new Date)+36e5}}),U.setBgColor(this.themedata.themeBackgroundColor),n()):(n(),s({title:"服务器出错",icon:"error",mask:!0,duration:5e3}))}))}})}}),U.$ajax.post({url:"include/ajax.php?"+S.encodeUrl("service=task&action=refreshPackage")}).then((a=>{for(let e=0;e<a.data.info.length;e++)a.data.info[e].oprice=(a.data.info[e].mprice/a.data.info[e].count).toFixed(2);U.listdata=a.data.info})),U.$ajax.post({url:"include/ajax.php?"+S.encodeUrl("service=task&action=memberInfo")}).then((a=>{U.userdata=a.data.info,U.$ajax.post({url:"include/ajax.php?"+S.encodeUrl("service=task&action=memberLevel")}).then((a=>{for(let e=0;e<a.data.info.length;e++)if(a.data.info[e].id==U.userdata.level.id){U.leveldata=a.data.info[e];break}this.leveldata||(U.leveldata=a.data.info[a.data.info.length-1])}))})),U.pages=S.pageFn(T)},linkTo(a){if(a)if("web"==U.platForm){if(window.appBoolean)return window.setupWebViewJavascriptBridge((function(e){e.callHandler("redirectNative",{name:"",code:"",link:a},(function(){}))})),!1;a.indexOf("http")>-1?location.href=a:i({url:a})}else{if(a.includes("tomini")){let e=a.split("?")[1].split("&");for(let t=0;t<e.length;t++)if(e[t].includes("tomini")){a=e[t].replace("tomini=",""),e.splice(t,1);break}a+=`?${e.join("&")}`}i({url:a.indexOf("http")>-1?"/pages/redirect/index?url="+encodeURIComponent(a):a})}},backFn(){if(U.appBoolean)return window.setupWebViewJavascriptBridge((function(a){a.callHandler("goBack",{},(function(a){}))})),!1;{let a=r();a&&a.length>1?c({delta:1}):"web"==U.platForm?location.href=`${U.masterDomain}${window.pathname}${U.pages.index}`:p({url:"/pages/packages/task/index/index"})}},setBgColor(a){"web"!=U.platForm&&uni.setBackgroundColor({backgroundColor:a,fail:a=>{console.log(a)}})},selectFn(a){let e=a.currentTarget.dataset.index;U.activeIndex=e},confirmFn(){let a=this.listdata[this.activeIndex].id;U.$ajax.post({url:"include/ajax.php?"+S.encodeUrl("service=task&action=buyRefreshPackage"),data:{id:a}}).then((a=>{100==a.data.state&&(U.payInfo=a.data.info,U.showPayPop=!0,U.$refs.pay.payCutDown(a.data.info,a.data.info.timeout))}))},keepToCall(a,e){setTimeout((()=>{this.backFn()}),1e3)}}},[["render",function(a,e,t,l,o,n){const s=b,i=B,r=F,c=d("paypop"),p=j(u("private_tip"),I);return m(),h(s,{style:{height:"100%"}},{default:g((()=>[o.appBack?(m(),k(w,{key:0},[y(s,{style:v("height:"+o.wh+"px;background-color: "+o.themedata.themeBackgroundColor+";position: sticky;top: 0rpx;z-index: 99;padding-bottom: 88rpx;"),catchtouchmove:""},null,8,["style"]),y(s,{class:"rec-title",style:v("background-color: "+o.themedata.themeBackgroundColor+";top: "+(o.wh+o.biasTop_88)+"px;")},{default:g((()=>[y(i,{src:o.imgurl+"bl-arrow.png?v="+o.imgVersion,onClick:n.backFn,mode:"aspectFill"},null,8,["src","onClick"]),y(s,null,{default:g((()=>[x("购买刷新")])),_:1})])),_:1},8,["style"])],64)):C("",!0),y(s,{class:"reNumber"},{default:g((()=>[y(s,{class:"number"},{default:g((()=>[x(_(o.userdata.refresh_coupon),1)])),_:1}),y(s,{class:"text"},{default:g((()=>[x("我的刷新道具数量(个)")])),_:1})])),_:1}),y(s,{class:"setMeal",style:v("padding-bottom:"+o.bh+"px;")},{default:g((()=>[y(s,{class:"s-title"},{default:g((()=>[x("刷新套餐包购买")])),_:1}),o.userdata.level.id?C("",!0):(m(),h(s,{key:0,class:"bpc-label",style:v("background-image: url("+o.imgurl+"linerbgc3.png?v="+o.imgVersion+");"),onClick:e[0]||(e[0]=a=>n.linkTo(`${o.appBoolean?o.channelDomain:""}${o.pages.vip}?index=0&${o.appFullScreen}`))},{default:g((()=>[y(i,{class:"crown",src:o.imgurl+"crownBl.png?v="+o.imgVersion,mode:"aspectFill"},null,8,["src"]),y(s,{class:"text"},{default:g((()=>[x(" 您还不是会员，开通会员最低可享 "),y(r,null,{default:g((()=>[x("8折")])),_:1}),x(" 购买刷新包套餐 ")])),_:1}),y(s,{class:"btn"},{default:g((()=>[y(s,null,{default:g((()=>[x("立即开通")])),_:1}),y(i,{src:o.imgurl+"rArrowBr.png?v="+o.imgVersion,mode:"aspectFill"},null,8,["src"])])),_:1})])),_:1},8,["style"])),o.userdata.level.id?(m(),h(s,{key:1,class:"bpc-label",style:v("background-image: url("+o.imgurl+"linerbgc3.png?v="+o.imgVersion+");height:68rpx;")},{default:g((()=>[y(i,{class:"crown",src:o.imgurl+"crownBl.png?v="+o.imgVersion,mode:"aspectFill"},null,8,["src"]),y(s,{class:"text"},{default:g((()=>[x(" 尊敬的"+_(o.userdata.level.name)+"你好，您可享 ",1),y(r,null,{default:g((()=>[x(_(o.leveldata.refresh_discount/10)+"折",1)])),_:1}),x(" 购买刷新包优惠 ")])),_:1})])),_:1},8,["style"])):C("",!0),y(s,{class:"s-items"},{default:g((()=>[(m(!0),k(w,null,D(o.listdata,((a,e)=>(m(),h(s,{class:P("item "+(o.activeIndex==e?"active":"")),"data-index":e,onClick:n.selectFn,key:e},{default:g((()=>[y(s,{class:"allprice"},{default:g((()=>[y(r,null,{default:g((()=>[x(_(o.globalData.appConfig.currency?o.globalData.appConfig.currency.symbol:"￥"),1)])),_:1}),x(" "+_(a.price),1)])),_:2},1024),y(s,{class:"times"},{default:g((()=>[x(_(a.count)+"次刷新",1)])),_:2},1024),y(s,{class:"price"},{default:g((()=>[x("单价"+_(a.unitprice)+_(o.globalData.appConfig.currency?o.globalData.appConfig.currency.short:"元")+"/次",1)])),_:2},1024),o.userdata.level.id?(m(),h(s,{key:0,class:"oprice"},{default:g((()=>[x("原单价"+_(a.oprice)+_(o.globalData.appConfig.currency?o.globalData.appConfig.currency.short:"元")+"/次",1)])),_:2},1024)):C("",!0),o.activeIndex==e?(m(),h(i,{key:1,class:"selected",src:o.imgurl+"selected.png?v="+o.imgVersion,mode:"aspectFill"},null,8,["src"])):C("",!0)])),_:2},1032,["class","data-index","onClick"])))),128))])),_:1})])),_:1},8,["style"]),y(s,{class:"botbtn"},{default:g((()=>[y(s,{class:"price"},{default:g((()=>[x(" 应付金额: "),y(r,null,{default:g((()=>[y(r,null,{default:g((()=>[x(_(o.globalData.appConfig.currency?o.globalData.appConfig.currency.symbol:"￥"),1)])),_:1}),x(" "+_(o.listdata[o.activeIndex].price),1)])),_:1})])),_:1}),y(s,{style:v("background-color: "+o.themedata.themeBackgroundColor+";"),class:"btn",onClick:n.confirmFn},{default:g((()=>[x("确认支付 ")])),_:1},8,["style","onClick"])])),_:1}),y(c,{id:"paypop",showPayPop:o.showPayPop,service:"task",action:"pay",payInfo:o.payInfo,onKeepToCall:e[1]||(e[1]=a=>n.keepToCall(a,{tagId:"paypop"})),ref:"pay",onPaypopb:e[2]||(e[2]=a=>o.showPayPop=!1)},null,8,["showPayPop","payInfo"]),y(p,{privateShow:o.privateb},null,8,["privateShow"])])),_:1})}],["__scopeId","data-v-8bbcbb6e"]]);export{L as default};
