import{a0 as e,J as t,b as s,U as a,V as i,a as o,h as n,o as l,l as r,w as c,t as p,v as d,y as u,G as m,A as h,F as b,B as v,H as f,m as g,q as y,W as w,C as _,K as F,E as T}from"./index-cF6skFzP.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";let C=g();const k=x({name:"previewMedia",props:{staticSrc:{type:Array,default:[]},previewb:{type:Boolean,default:!1},currentIndex:{type:Number,default:-1}},data:()=>({pageNumber:1,navTop:C.globalData.navTop,animationb:!0,platForm:C.globalData.platForm,biasTop:0}),mounted(){"mp-weixin"==this.platForm&&(this.biasTop=C.globalData.biasTop_88)},methods:{closeFn(){this.$emit("previewClose",!1);for(let t=0;t<this.staticSrc.length;t++){if("video"==this.staticSrc[t].type){e(`video_${t}`).pause()}}},changeFn(t){let s=t.detail.current;this.pageNumber=s+1;for(let a=0;a<this.staticSrc.length;a++){if("video"==this.staticSrc[a].type&&s!=a){e(`video_${a}`).pause()}}},saveVideoFn(e){t({title:"web"==_this.platForm?"是否下载视频？":"是否将视频保存到相册？",content:"web"==_this.platForm?"此操作需要在浏览器内才能执行，如不在浏览器内请先打开浏览器":"",success:t=>{t.confirm&&("web"==_this.platForm?_this.webVideo(e,(function(){s({title:"保存成功",icon:"success"})})):uni.authorize({scope:"scope.writePhotosAlbum",success:t=>{_this.upVideo(e)},fail:e=>{s({title:"保存失败，相册存储权限获取失败",icon:"fail"})}}))}})},upVideo(e){a({url:e,success:e=>{200===e.statusCode?i({filePath:e.tempFilePath,success:e=>{s({title:"保存成功",icon:"success"})},fail:e=>{s({title:"保存失败，请刷新页面重试",icon:"error"})}}):s({title:"保存失败，请刷新页面重试",icon:"error"})},fail:e=>{s({title:"保存失败，请刷新页面重试",icon:"error"})}})},webVideo(e,t){o({title:"下载中"});var s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="blob",s.onload=function(){if(4===s.readyState&&200===s.status){const e=new Blob([this.response],{type:"video/mp4"}),s=document.createElement("a");s.href=window.URL.createObjectURL(e),s.download="video",s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(s.href),n(),t()}},s.send()}},watch:{currentIndex(e,t){this.pageNumber=e,this.animationb=!1,setTimeout((e=>{this.animationb=!0}),0)}}},[["render",function(e,t,s,a,i,o){const n=y,g=w,x=_,C=F,k=T;return l(),r(n,{class:"preview",style:d(`display: ${s.previewb?"block":"none"};padding-top:${i.navTop+i.biasTop}px`),onClick:o.closeFn},{default:c((()=>[p(n,{class:"p-pages",style:d(`top:${i.navTop+i.biasTop}px`)},{default:c((()=>[u(m(i.pageNumber)+"/"+m(s.staticSrc.length),1)])),_:1},8,["style"]),p(k,{class:"p-swiper",style:d(" height:calc(100% - 100rpx - env(safe-area-inset-bottom))"),current:i.pageNumber<=s.staticSrc.length?i.pageNumber-1:0,circular:!0,onChange:o.changeFn,duration:i.animationb?200:0},{default:c((()=>[(l(!0),h(b,null,v(s.staticSrc,((e,s)=>(l(),r(C,{class:"item",key:s},{default:c((()=>["video"==e.type?(l(),r(g,{key:0,src:e.value,"enable-progress-gesture":!1,"show-mute-btn":!0,class:"p-media",onLongpress:t=>o.saveVideoFn(e.value),onClick:t[0]||(t[0]=f((()=>{}),["stop"])),id:`video_${s}`,"enable-play-gesture":!0},null,8,["src","onLongpress","id"])):(l(),r(x,{key:1,src:e.value,mode:"widthFix",class:"p-media",onClick:t[1]||(t[1]=f((()=>{}),["stop"])),"show-menu-by-longpress":!0},null,8,["src"]))])),_:2},1024)))),128))])),_:1},8,["style","current","onChange","duration"])])),_:1},8,["style","onClick"])}],["__scopeId","data-v-27fdd8e4"]]);export{k as _};
