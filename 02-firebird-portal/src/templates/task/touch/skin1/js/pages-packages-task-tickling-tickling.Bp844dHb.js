import{a,P as t,i as e,j as s,h as l,b as o,d as n,e as i,r,R as d,k as c,o as m,l as h,w as p,m as g,q as u,A as f,t as k,v as x,y as b,F as y,x as w,B as C,H as v,G as F,C as _,X as D,D as B}from"./index-cF6skFzP.js";import{r as T,_ as j}from"./uni-app.es.J1otcSEF.js";import{_ as S}from"./_plugin-vue_export-helper.BCo6x5W8.js";let $=g();var I;const P=S({data:()=>({wh:$.globalData.navTop+$.globalData.appFullWh,masterDomain:$.globalData.masterDomain,biasTop_88:$.globalData.biasTop_88,appBack:$.globalData.appBack,imgurl:$.globalData.imgPath+"/task/",warningb:!1,privateb:!1,themedata:{},selIndex:0,formdata:{images:""},info:"",minlength:10,maxlength:100,tid:-1,imgVersion:"",platForm:$.globalData.platForm,appFullWh:$.globalData.appFullWh}),onLoad(a){I=this,-1==$.globalData.wxprivate?$.watchG("wxprivate",(function(t){I.wxprivate=t,t?I.privateb=!0:I.onload(a)})):$.globalData.wxprivate?I.privateb=!0:I.onload(a)},onReady(){},onShow(){},onHide(){},onUnload(){},onPullDownRefresh(){},onReachBottom(){},onShareAppMessage(a){return{title:this.themedata.title,imageUrl:this.themedata.sharePic,path:"/pages/packages/task/my/my"}},onShareTimeline(){return{title:this.themedata.title,imageUrl:this.themedata.sharePic,path:"/pages/packages/task/my/my"}},methods:{onload(n){a({title:"加载中",mask:!0,success:()=>{t({key:"warnColor",success:a=>{t({key:"warnColor",success:a=>{this.formdata.type=a.data.themeDate.feedback[0],I.themedata=a.data.themeDate,I.setBgColor(this.themedata.themeBackgroundColor),a.data.outtime<Date.parse(new Date)&&e({key:"warnColor",success:()=>{I.$ajax.post({url:"include/ajax.php?service=task&action=config"}).then((a=>{this.formdata.type=a.data.info.feedback[0],null!=a.data.info.themeBackgroundColor?(I.themedata=a.data.info,s({key:"warnColor",data:{themeDate:this.themedata,outtime:Date.parse(new Date)+36e5}}),I.setBgColor(this.themedata.themeBackgroundColor),l()):(l(),o({title:"服务器出错",icon:"error",mask:!0,duration:5e3}))}))}})}}),l()},fail:a=>{I.$ajax.post({url:"include/ajax.php?service=task&action=config"}).then((a=>{this.formdata.type=a.data.info.feedback[0],null!=a.data.info.themeBackgroundColor?(I.themedata=a.data.info,s({key:"warnColor",data:{themeDate:this.themedata,outtime:Date.parse(new Date)+36e5}}),I.setBgColor(this.themedata.themeBackgroundColor),l()):(l(),o({title:"服务器出错",icon:"error",mask:!0,duration:5e3}))}))}})}}),I.tid=n.tid},backFn(){if(I.appBoolean)return window.setupWebViewJavascriptBridge((function(a){a.callHandler("goBack",{},(function(a){}))})),!1;{let a=n();a&&a.length>1?i({delta:1}):"web"==I.platForm?location.href=`${I.masterDomain}${window.pathname}${I.pages.index}`:r({url:"/pages/packages/task/index/index"})}},setBgColor(a){"web"!=I.platForm&&uni.setBackgroundColor({backgroundColor:a,fail:a=>{console.log(a)}})},warningFn(){I.warningb=!this.warningb,setTimeout((()=>{I.warningb=!this.warningb}),2e3)},selFn(a){let t=a.currentTarget.dataset.index;this.formdata.type=a.currentTarget.dataset.type,I.selIndex=t},textFn(a){this.formdata.content=a.detail.value},pictureFn(){this.formdata.images||(this.formdata.images=[]);let a=this.formdata.images.length,t={count:6-this.formdata.images.length,sizeType:[],sourceType:[]};this.$ajax.upMedia({seFile:!0,type:"image",formData:{mod:"task",type:"atlas"},upConfig:t}).then((t=>{for(let e=0;e<t.length;e++){let s=JSON.parse(t[e].data);"SUCCESS"!=s.state?(I.info=s.state,this.warningFn()):this.formdata.images[a+e]=s.turl}}))},delFn(a){let t=a.currentTarget.dataset.index;this.formdata.images.splice(t,1),I.formdata=this.formdata},clickimgFn(a){let t=a.currentTarget.dataset.index;d({urls:this.formdata.images,current:this.formdata.images[t]})},verifyFn(){let a=JSON.parse(JSON.stringify(this.formdata));if(a.images&&(a.pics=a.images.join("||"),delete a.images),this.formdata.content&&this.formdata.content.length<this.minlength)return I.info=`具体原因至少${this.minlength}个字`,this.warningFn(),!1;a.id=this.tid,I.$ajax.post({url:"include/ajax.php?"+$.encodeUrl("service=task&action=feedback"),data:a}).then((a=>{I.info=a.data.info,this.warningFn(),setTimeout((()=>{i()}),2200)}))}}},[["render",function(a,t,e,s,l,o){const n=u,i=_,r=D,d=B,g=T(c("private_tip"),j);return m(),h(n,{style:{height:"100%"}},{default:p((()=>[l.appBack?(m(),f(y,{key:0},[k(n,{style:x("height:"+l.wh+"px;background-color: "+l.themedata.themeBackgroundColor+";position: sticky;top: 0rpx;z-index: 99;padding-bottom: 88rpx;"),catchtouchmove:""},null,8,["style"]),k(n,{class:"rec-title",style:x("background-color: "+l.themedata.themeBackgroundColor+";top: "+(l.wh+l.biasTop_88)+"px;")},{default:p((()=>[k(i,{src:l.imgurl+"bl-arrow.png?v="+l.imgVersion,onClick:o.backFn,mode:"aspectFill"},null,8,["src","onClick"]),k(n,null,{default:p((()=>[b("反馈问题")])),_:1})])),_:1},8,["style"])],64)):w("",!0),k(n,{class:"content"},{default:p((()=>[k(n,{class:"c-title"},{default:p((()=>[b("请认真选择原因")])),_:1}),k(n,{class:"c-reason"},{default:p((()=>[(m(!0),f(y,null,C(l.themedata.feedback,((a,t)=>(m(),h(n,{class:"cr-item",onClick:v(o.selFn,["stop","prevent"]),"data-index":t,"data-type":a,key:t},{default:p((()=>[k(n,{class:"dot",style:x("border-color: "+(l.selIndex==t?l.themedata.themeBackgroundColor:"")+";")},{default:p((()=>[k(n,{style:x("background-color: "+(l.selIndex==t?l.themedata.themeBackgroundColor:"")+";")},null,8,["style"])])),_:2},1032,["style"]),k(n,{class:"item"},{default:p((()=>[b(F(a),1)])),_:2},1024)])),_:2},1032,["onClick","data-index","data-type"])))),128))])),_:1}),k(r,{class:"c-text","auto-height":"",placeholder:"若有额外原因请在此补充，"+l.minlength+"-"+l.maxlength+"个字",maxlength:l.maxlength,onInput:o.textFn},null,8,["placeholder","maxlength","onInput"]),k(n,{class:"c-picture"},{default:p((()=>[k(n,{class:"title"},{default:p((()=>[b(" 证据图片 "),k(d,null,{default:p((()=>[b("( 最多添加6张 )")])),_:1})])),_:1}),k(n,{class:"picture"},{default:p((()=>[l.formdata.images?(m(!0),f(y,{key:0},C(l.formdata.images,((a,t)=>(m(),h(n,{style:{position:"relative"},key:t},{default:p((()=>[k(i,{src:a,class:"exhibition",mode:"aspectFill","data-index":t,onClick:v(o.clickimgFn,["stop","prevent"])},null,8,["src","data-index","onClick"]),k(i,{src:l.imgurl+"circleClose.png?v="+l.imgVersion,class:"close",onClick:v(o.delFn,["stop","prevent"]),"data-index":t,mode:"aspectFill"},null,8,["src","onClick","data-index"])])),_:2},1024)))),128)):w("",!0),l.formdata.images.length<6||!l.formdata.images?(m(),h(n,{key:1,class:"add",onClick:o.pictureFn},{default:p((()=>[k(i,{src:l.imgurl+"crossadd.png?v="+l.imgVersion,mode:"aspectFill"},null,8,["src"]),k(n,null,{default:p((()=>[b("添加图片")])),_:1})])),_:1},8,["onClick"])):w("",!0)])),_:1})])),_:1})])),_:1}),k(n,{class:"submit"},{default:p((()=>[k(n,{class:"s-btn",style:x("background-color:"+l.themedata.themeBackgroundColor+";"),onClick:v(o.verifyFn,["stop","prevent"])},{default:p((()=>[b("确认提交")])),_:1},8,["style","onClick"])])),_:1}),k(n,{class:"pop-warning",style:x(l.warningb?"transform:scale(1);":"transform:scale(0);z-index:-1;")},{default:p((()=>[k(n,{class:"text",style:{transform:"translate(-50%, -50%)"}},{default:p((()=>[b(F(l.info),1)])),_:1})])),_:1},8,["style"]),k(g,{privateShow:l.privateb},null,8,["privateShow"])])),_:1})}],["__scopeId","data-v-0be15f7e"]]);export{P as default};
