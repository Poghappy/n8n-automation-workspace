<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{#$langData['info'][3][93]#}</title>  {#* 添加定位 *#}
    <meta name="keywords" content="{#$article_keywords#}">
    <meta name="description" content="{#$article_description#}">
    <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <link rel="stylesheet" type="text/css" href="{#$cfg_staticPath#}css/core/touchBase.css?v={#$cfg_staticVersion#}" />
    <link rel="stylesheet" type="text/css" href="{#$templets_skin#}css/mapPosi.css?v={#$cfg_staticVersion#}">
    <script type="text/javascript" src="{#$cfg_staticPath#}js/core/touchScale.js?v={#$cfg_staticVersion#}"></script>
    <script type="text/javascript" src="{#$cfg_staticPath#}js/vue/vue.js?v={#$cfg_staticVersion#}"></script>
    <script type="text/javascript" src="{#$cfg_staticPath#}js/core/zepto.min.js?v={#$cfg_staticVersion#}"></script>
    <script>
        var masterDomain = '{#$cfg_basehost#}', channelDomain = '{#$car_channelDomain#}', staticPath = '{#$cfg_staticPath#}', templets_skin = '{#$templets_skin#}';
        var site_map = '{#$site_map#}';
        var city = "{#$siteCityInfo['name']#}";
        var siteCityInfo_cityid = "{#$siteCityInfo['cityid']#}";
        var siteCityInfo_lng = "{#$siteCityInfo['lng']#}";
        var siteCityInfo_lat = "{#$siteCityInfo['lat']#}";
        var siteCityInfo_name = "{#$siteCityInfo['name']#}";
        var radius = '99999';
        var site_map_key = '{#$site_map_key#}'; //地图key
        var fabuMapConfig = {#$info_fabuMapConfig|default:0#}; //发布信息时定位功能配置  0系统默认 不限制  1用户当前位置没有开通分站，强制不允许发布信息  2用户当前位置没有开通分站，提示用户需调整地图位置为所在分站，否则不允许发布信息,  设置1,2时限制地图在2公里以内
        var fabuMapDisplayLocation = {#$info_fabuMapDisplayLocation|default:0#}
        var chanelIndex = '{#$info_channelDomain#}'
    </script>
</head>
<body>
{#include file="../../siteConfig/touch_top.html"   pageTitle="{#$langData['info'][3][93]#}"#} {#* 添加定位 *#}
<div id="pageMap">
  <div class="searchAddrBox" v-cloak >
    <div class="cityChose" @click="showCity"><span>{{city}}</span></div>
    <div :class="['searchInp',{'hideClear':search_key == ''}]" v-cloak><input type="text" placeholder="{#$langData['info'][3][94]#}" enterkeyhint="search" class="addrInp" @focus="showList" id="searchInp" @blur="hideList" v-model="search_key"> <s @click="search_key = '',searchList = []"></s></div>{#* 搜索位置 *#}
  </div>
  <div class="loadImg" v-show="loading"></div>
  <!-- 地图 -->
  <div class="topMap" >
    <div id="mapdiv"></div>
    <span class="mapcenter"></span>
  </div>

  <!-- 地址列表 -->
  <!-- moreHeight -->
  <div :data-type="typing" :class="['addrListBox',{'moreHeight':(searchList.length > 0 || search_key!='' || typing)},{'padTop':noPosi_val}] "  v-cloak>
    <div class="remark" @click="rePosi"></div>
    <div class="addrTit" v-show="!noPosi_val">
      <a href="javascript:;" class="noPosi" @click="noPosi" v-if="!fabuMapDisplayLocation || modelType != 'info'" >{#$langData['info'][3][95]#}</a>  {#* 不显示位置 *#}
      <a href="javascript:;" class="sure"  v-else>选择定位</a>  {#* 不显示位置 *#}
      <a href="javascript:;" class="sure" @click="choseArea">{#$langData['info'][2][43]#}</a>  {#* 确定 *#}
    </div>
    <div class="addrList" v-show="searchList.length == 0 && search_key=='' && !typing">
      <ul>
        <li  v-for="(item,index) in surroundingPois" @click="choseAddr(item)" :data-noAddress="item.noDistance" :key="index" :class="{'chosed': !index && !noPosi_val}" v-if="!item.noDistance || (item.noDistance && !noPosi_val)" >
          <a :href="posiFinish && returnUrl && returnUrl != 'javascript:;' ? (`${returnUrl.replace('?','&')}&currentPageOpen=1`.replace('&','?')) : 'javascript:;'" v-if="item.title || item.address">
            <div class="addrInfo">
              <h3>{{item.title}}</h3>
              <p>{{item.address}}&nbsp;</p>
            </div>
            <div class="addrDistance" v-if="!item.noDistance">{{mapDistance(item.point&&(item.point.lat) || item.lat,item.point&&(item.point.lng) || item.lng,lat,lng)}}</div>
          </a>
        </li>
        <li class="toDefine" v-show="loadEnd">
          <a :href="'{#$member_userDomain|replace:$cfg_basehost:''#}/mapDefine.html?cityid='+cityid+'&city='+city+'&currentPageOpen=1'">
            <div class="addrInfo">
              <h3>以上都不是</h3>
              <p>点击添加自定义位置</p>
            </div>
          </a>
        </li>
      </ul>
      <div class="loadingTip">{{loadingb?'地址信息加载中....':surroundingPois.length==0&&('定位失败！')||''}}</div>
    </div>
    <div class="addrList searchList" v-show="searchList.length || search_key!=''" >
      <ul>
        <li  v-for="(item,index) in searchList" @click="choseAddr(item)" :key="index">
          <a :href="returnUrl">
            <div class="addrInfo">
              <h3>{{item.name}}</h3>
              <p>{{item.address}}&nbsp;</p>
            </div>
            <div class="addrDistance">{{mapDistance(item.lat,item.lng,lat,lng)}}</div>
          </a>
        </li>
        <li class="toDefine"  v-show="loadEnd || searchList.length > 0　">
          <a :href="'{#$member_userDomain|replace:$cfg_basehost:''#}/mapDefine.html?cityid='+cityid+'&currentPageOpen=1&city='+city">
            <div class="addrInfo">
              <h3 v-if="searchList.length > 0">以上都不是</h3>
              <h3 v-else>暂无相关地址</h3>
              <p>点击添加自定义位置</p>
            </div>
          </a>
        </li>
      </ul>
    </div>
    <div class="backMap"></div>
  </div>

  <!-- 城市选择 -->
  <div class="cityMask" @click="hideCity"></div>
  <div class="siteCityListBox">
    <div class="cityTitle">
      <a href="javascript:;" class="city_back" @click="hideCity">{#$langData['info'][2][42]#}</a>   {#* 取消 *#}
      <h4>{#$langData['info'][3][96]#}</h4>   {#* 城市选择 *#}
      <a href="javascript:;" class="city_sure"></a>
    </div>
    <div class="jump_szm"></div>
    <div class="cityList">
      <ul class="right_szm">
        <li @click="go_szm(0)" data-id="hot">{#$langData['info'][3][97]#}</li>{#* 热门 *#}
        <li v-for="(szm,ind) in szmArr" @click="go_szm(ind+1)"  :data-id="szm">{{szm}}</li>
      </ul>
      <div class="cityUl">
        <dl class="hot" id="hot" v-if="hotCity.length > 0">
          <dt>{#$langData['info'][3][98]#}</dt>  {#* 热门城市 *#}
          <dd @click="chose_city(city)" v-for="city in hotCity"  :data-cityid="city.cityid">{{city.name}}</dd>
        </dl>
        <dl v-for="szm in szmArr" :id="szm">
          <dt>{{szm}}</dt>
          <dd @click="chose_city(city)"  v-for="city in orderBy(szm)":data-cityid="city.cityid">{{city.name}}</dd>
        </dl>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
    var wxconfig = {
        "appId": '{#$wxjssdk_appId#}',
        "timestamp": '{#$wxjssdk_timestamp#}',
        "nonceStr": '{#$wxjssdk_nonceStr#}',
        "signature": '{#$wxjssdk_signature#}',
        "description": '添加定位',
        "title": '添加定位',
        "imgUrl": '{#$cfg_weblogo#}',
        "link": '{#getUrlPath service='member' type='user' template='mapPosi'#}',
    };

    document.write(unescape("%3Cscript src='{#$cfg_staticPath#}js/publicShare.js?v="+~(-new Date())+"'type='text/javascript'%3E%3C/script%3E"));
</script>
{#include file="{#$HUONIAOROOT#}/templates/siteConfig/public_location.html"#}

<script type='text/javascript' src='{#$cfg_basehost#}/include/json.php?action=lang'></script>
<script src="{#$templets_skin#}js/mapPosi.js?v={#$cfg_staticVersion#}" type="text/javascript"></script>
</body>
</html>
