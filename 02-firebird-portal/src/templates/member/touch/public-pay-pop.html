
{#* 不需要加载vue.js *#}
{#if !$noVue#}
<script type="text/javascript" src="{#$cfg_staticPath#}js/vue/vue.min.js"></script>
<script type="text/javascript" src="{#$cfg_staticPath#}js/ui/noscroll.js"></script>
{#/if#}
<script type="text/javascript" src="{#$cfg_staticPath#}js/vue/axios.min.js"></script>
<script>
	var staticPath = "{#$cfg_staticPath#}"
	var totalPoint = 0;
	var masterDomain = "{#$cfg_basehost#}", totalBalance = {#$userinfo.money|default:0#}, pointRatio = {#$cfg_pointRatio#}, pointName = '{#$cfg_pointName#}',service='{#$service#}',usepoint ='{#$usepoint#}';
	if(service == 'awardlegou' &&usepoint !=0){
		totalPoint = {#$usepoint|default:0#};
	}else{
		totalPoint = {#$userinfo.point|default:0#}
	}
	var curDown = true; //无倒计时
  var serviceTime = '{#$smarty.now#}';
  var jsTime = (new Date()).valueOf();
  var timeOffset = serviceTime*1000 - jsTime;
	var usermoney = '{#$userinfo.money#}';
	var orderurl = '';
	var checkpay = false;
	var monBonus = '{#$userinfo.surplusbonus#}'
	var bonus = '{#$userinfo.bonus#}';
	var infoManage = '{#$member_userDomain#}/manage-info.html';
    var ordernum = '{#if $ordernum#}{#$ordernum#}{#elseif $detail_ordernum#}{#$detail_ordernum#}{#/if#}';
</script>
<style>
	/* 新版支付样式 */
	/*#payPage{position: relative; z-index: 10000000}*/
	.popErrAlert{top: 20%}
	.payMask,.payCancelMask{position: fixed; top: 0; left: 0; bottom: 0;;right: 0; background: rgba(0,0,0,.8); z-index: 1000003; display:none;}
	.payPop{position: fixed; left: 0; right: 0; bottom: 0;  border-radius: .4rem .4rem 0 0; background: #fff; z-index: 1000004; transform: translateY(100%); transition:transform .3s ease-in-out; min-height:6.2rem;}
    .payPop.payPhonePop::before {content: ''; position: absolute; left: 0; top: 0; right: 0; height: 1.8rem; z-index: -1; background-image: linear-gradient(to bottom, #FFEFF1 0%, #fff 100%); border-radius: .4rem .4rem 0 0;}
	.payPop .payInfoShow{height: 2.62rem; box-sizing: border-box; display: flex; align-items: center; justify-content: center; flex-direction: column; position: absolute; left: 0; right: 0;top: 0;}
    .payPop.payPhonePop .payInfoShow {height: 3rem;}
	.payPop .payInfoShow h2{font-size: .36rem; color: #000; font-weight: bold; text-align: center;}
    .payPop.payPhonePop .payInfoShow h2::before {content: '获取当前联系方式需支付'; display: block; font-size: .3rem; color: #FF6B2B; margin-bottom: .3rem;}
	.payPop .payInfoShow h2 b{font-size: .64rem; font-family: moneyNumber}
	.payPop .payInfoShow p{color: #666; font-size: .26rem;}
	.payPop .payListBox{padding-top: 2.62rem; max-height: 5.12rem; overflow: hidden; padding-bottom: 1.5rem;}
    .payPop.payPhonePop .payListBox {padding-top: 3rem;}
	.payPop .payListBox ul{max-height: 5.12rem; overflow: auto;}
    .payPop.payPhonePop .payListBox ul {max-height: 4.3rem;}
	.payPop .payListBox li{margin: 0 .4rem; border-top: solid 1px #f5f5f7; display: flex; align-items: center; height:.96rem; color: #151515; font-size: .28rem; justify-content: space-between;}
	.payPop .payListBox li .check-item-img{width: .4rem; height: .4rem; margin-right: .13rem;}
	.payPop .payListBox li .check-item-img img{display: block; width: .4rem; height: .4rem; object-fit: cover;}
	.payPop .payListBox li .left_item{display: flex; align-items: center; }
	.payPop .payListBox li .check-item-right,.payPop .payListBox li .check-item-disabled{position: relative; pointer-events: none}
	.payPop .payListBox li .check-item-right input[type="radio"],.payPop .payListBox li .check-item-disabled input[type="radio"]{opacity: 0; position: absolute; left: 0;right: 0; bottom: 0; top: 0;}
	.payPop .payListBox li .check-item-right .checkbox-icon-round,.payPop .payListBox li .check-item-disabled .checkbox-icon-round{display: block; width: .4rem; height: .4rem; box-sizing: border-box; border: solid 1px #ddd; border-radius: 50%}
	.payPop .payListBox li.paychosed .check-item-right .checkbox-icon-round{background: url(/static/images/chosed.png) no-repeat center/cover; border: none}
	.payPop .btn_pay{position: absolute; left: .3rem; right: .3rem; bottom: .4rem; border-radius: .44rem; height: .88rem;background: linear-gradient(-90deg, #F6252F 0%, #FF4621 100%); font-size: .32rem; color: #fff; font-weight: bold; text-align: center; line-height: .88rem;}
	.payPop .close_pay_pop{position: absolute; display: block; width: .44rem; height: .44rem; background: url(/templates/member/touch/images/pay/close.png) no-repeat center/cover; top: .36rem; left: .36rem;}
	.payPop .payListBox li:not(.disabled_pay) .investMoney,	.payPop .payListBox li:not(.disabled_pay) .check-item-disabled{display: none;}
	.payPop .disabled_pay .investMoney{font-size: .3rem ;color: #F82C2C; font-weight: bold; display: block;}
	,	.payPop .payListBox li:not(.disabled_pay) .check-item-disabled{display: block;}
	.payPop .disabled_pay.check-item .check-item-right{display: none;}
	.payPop .disabled_pay.check-item .left_item{opacity: .6;}
	.payCancelMask{background:rgba(0,0,0,.3);display: none;}
	.payCancelPop{width: 6.2rem; height: 3.3rem; border-radius: .3rem; box-shadow: 0 .1rem .5rem 0 rgba(0, 0, 0, 0.06); z-index: 1000006;  position: absolute; left: 0; right: 0; margin: auto; top:-1.7rem; background: #fff; display: none; animation:popup .3s; transform-origin:center !impotrant;}
	.payCancelPop h4{font-size: .34rem; color: #151515; font-weight: bold; text-align: center; padding-top: .44rem; margin-bottom: .24rem;}
	.payCancelPop p{color: #97989C; font-size: .24rem; margin: 0 .66rem .42rem; text-align: center; }
	.payCancelPop .payBtns{display: flex; align-items: center; justify-content: center;}
	.payCancelPop a{ width: 2.3rem; height: .76rem; border-radius: .38rem; text-align: center; font-size: .28rem; color: #F6252F; font-weight: bold; display: flex; align-items: center; justify-content: center; margin: 0 .1rem}
	.payCancelPop a.cancelPay{border: solid 1px #F6262E}
	.payCancelPop a.keepPay{ background: linear-gradient(-90deg, #F6252F 0%, #FF4621 100%); color: #fff;}


	/* 密码支付弹窗 */
	.payPwdPop{min-height: 8.8rem; border-radius: .4rem .4rem 0 0; background: #fff; position: fixed; left: 0; right: 0; bottom: 0; z-index: 100001;padding-bottom: env(safe-area-inset-bottom); transform: translateY(100%);transition: transform .3s;}
	.setPwdPop{min-height: 10.4rem;}
	.payPwdPop>h4{font-size: .48rem; color: #212121; font-weight: bold; text-align: center; padding-top: .4rem;}
	.payPwdPop a.payBackBtn{display: block; width: .44rem; height: .44rem; background: url(/templates/member/touch/images/pay/arr_back.png) no-repeat center/cover; position: absolute; left: .5rem; top: .5rem;}
	.payPwdPop .payPwdBox{margin: 0 .62rem; margin-top: .8rem;}
	.payPwdPop .payPwdBox p{color: #151515; font-size: .26rem; margin-bottom: .12rem;}
	.payPwdPop .payPwdBox .payPwdInp ul{display: flex; align-items: center; border-radius: 6px; border: solid 1px #E2E2E2;}
	.payPwdPop .payPwdBox .payPwdInp ul li{width: 1.06rem;height: 1.04rem; border-right: solid 1px #E2E2E2;display: flex; align-items: center; justify-content: center; font-size: .48rem; color: #333; font-weight: bold;}
	.payPwdPop .payPwdBox .payPwdInp ul li:last-of-type{border: none;}
	.payPwdPop .payPwdBox .fpwtbox{text-align: right; font-size:.26rem;  margin-top: .1rem}
	.payPwdPop .payPwdBox .fpwtbox a{color:#97989C;}
	.payPwdPop .payPwdBox .spwtbox{margin-top: .28rem}
	.payPwdPop .payPwdBox .spwtbox p{color: #999; font-size: .22rem; line-height: .3rem;}
	.payPwdPop .setPwdUp{display: block; margin: 0 .55rem; line-height: .88rem; border-radius: .44rem; background: linear-gradient(-90deg, #F6252F 0%, #FF4621 100%); color: #fff; font-weight: bold; font-size: .32rem; text-align: center; margin-top: .4rem;}
	.num_keyboard{height: 3.98rem; background-color: #eee;  padding-top: .3rem; position: fixed; left: 0; right: 0; bottom: 0; padding-bottom: env(safe-area-inset-bottom); z-index: 100001;  transition: transform .3s;transform: translateY(150%);}
	.num_ul {display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; margin: 0 .23rem; }
	.num_ul li{display: flex; font-size: .5rem; color: #333; align-items: center; justify-content: center; width: 2.29rem; height: .88rem; border-radius: .1rem; background-color: #fff; margin-bottom: .09rem; box-shadow: 0 .02rem 0 0 rgba(109, 109, 109, 0.14); -webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}
	.num_ul li.nobg{background: none; box-shadow: none;}
	.num_ul li:active{background-color: #ccc !important;}
	.num_ul li.del{background: url(/templates/member/touch/images/pay/del_num.png) no-repeat center/.6rem;}
	.payLoading{display: block; width: 1.1rem; height: 1.1rem; border-radius: .3rem;  background: rgba(0,0,0,.9) ; background-size: .5rem; position: fixed; left: 0; right: 0; margin: auto; top: 50%; z-index: 100001}
	.payLoading::before{content: ''; background: url(/templates/member/touch/images/login/loading.png) no-repeat center; background-size: .5rem; position: absolute; left: 0; right: 0; margin: auto; top: 0; bottom: 0; animation:rotate_ 1s infinite linear;}
	.popErrAlert p{border-radius:.2rem; background:rgba(0,0,0,.95);}
	.payBeforeLoading{display: none; width: 1.1rem; height: 1.1rem; border-radius: .3rem;  background: rgba(0,0,0,.9) ; background-size: .5rem; position: fixed; left: 0; right: 0; margin: auto; top: 50%; z-index: 999999999;}
	.payBeforeLoading::before{content: ''; background: url(/templates/member/touch/images/loading.png) no-repeat center; background-size: .5rem; position: absolute; left: 0; right: 0; margin: auto; top: 0; bottom: 0; animation:rotate_ 1s infinite linear;}


    /* 协议弹窗 */
    .pop_mask{position: fixed; height:100vh; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,.57); z-index: 100001; }
    .pop_agree .box{text-align: center; margin: 0 .5rem; padding-top: .5rem; margin-bottom: .3rem;  font-size: .28rem;}
    .pop_agree{width: 5.9rem; height: 3rem; border-radius: .2rem; background-color: #fff; position: fixed; left: 0; right: 0; top: -1.7rem; margin: auto; z-index: 100001;  animation: popup .3s; transform-origin: center !important;}
    .pop_agree .btn_group{display: flex; align-items: center; justify-content: center;}
    .pop_agree .btn_group a{display: flex; width: 2.3rem; height: .7rem; font-size: .28rem; color: #333; text-align: center; align-items: center; justify-content: center; margin: .07rem; border: solid 1px #E1E1E1; box-sizing: border-box; border-radius: .35rem; font-weight: bold;}
    .pop_agree .btn_group a.keep_login{color: #fff; background: linear-gradient(-90deg, #F6252F 0%, #FF4621 100%); border: none;}

    /* 付费查看电话号码成功提示 */
    .payPhoneSuccessTips {display: none; position: fixed; left: 50%; top: 50%; width: 2.8rem; height: 1rem; line-height: 1rem; text-align: center; color: #fff; background-color: #1a1a1a; z-index: 1000005; margin: 0 0 0 -1.4rem; border-radius: .2rem;}
    .payPhoneSuccessTips::before {content: ''; display: inline-block; width: .5rem; height: .5rem; vertical-align: middle; background: url('/static/images/payPhoneSuccess.png') no-repeat center; background-size: cover; margin-right: .1rem;}

	@keyframes rotate_{
		0%{ transform: rotate(0deg);}
		50%{ transform: rotate(180deg);}
		100%{ transform: rotate(360deg);}
	}
</style>
<div id="payPage">
	<div class="payBeforeLoading"></div>
	<!-- 支付遮罩 -->
	<div class="payMask"></div>
	<!-- 支付弹窗 -->
	<div class="payPop" >
		<!-- <div class="payLoading" v-show="loading"></div> -->
		<!-- 支付金额 -->
		<div class="payInfoShow">
			<h2><span>{#echoCurrency type="symbol"#}</span><b id="amout">0.00</b></h2>
			<p>支付时间:<span class="payCutDown"><em>00</em>:<em>00</em>:<em>00</em></span></p>
		</div>
		<div class="payListBox">
			<input type="hidden" name="paypwd" :value="paypwd" id="paypwd">
			<ul>
				<!-- disabled_pay 余额不足时 -->
				{#if $userinfo.money > 0#}
				<li class="check-item" id="balance" data-balance="{#$userinfo.money#}" data-code="money">
					<div class="left_item">
						<div class="check-item-img"><img src="{#$cfg_basehost#}/templates/member/touch/images/pay/balance.png"></div>
						<div class="check-item-txt"><h3>{#$langData['siteConfig'][46][53]#} ({#$langData['siteConfig'][26][76]#}: {#echoCurrency type="symbol"#}<span class="count_num">{#$userinfo.money#}</span>)</h3></div>

					</div>
					<div class="check-item-right"><input type="radio" name="paytype" value="balance"><span class="checkbox-icon-round"></span></div>
					<a class="investMoney" href="{#$member_userDomain#}/deposit.html?paytype=deposit">充值</a>
				</li>
				{#/if#}

				{#loop service="siteConfig" action="payment"#}
				{#if $userinfo.surplusbonus > 0 && $row.pay_code == 'huoniao_bonus' #}
				<li class="check-item" id="monBonus" data-balance="{#$userinfo.surplusbonus#}" data-code="huoniao_bonus">
					<div class="left_item">
						<div class="check-item-img"><img src="{#$cfg_basehost#}/templates/member/touch/images/pay/bonus_pay.png"></div>
						<div class="check-item-txt"><h3>{#$row.pay_name#} (<em id="bonusinfo"></em>{#$langData['siteConfig'][26][76]#}余额: {#echoCurrency type="symbol"#}<span class="count_num">{#$userinfo.bonus#}</span>)</h3></div>

					</div>
					<div class="check-item-right"><input type="radio" name="paytype" value="balance"><span class="checkbox-icon-round"></span></div>
					{#if $userinfo.surplusbonus < $userinfo.bonus#}
					<div class="check-item-disabled"><input type="radio" name="paytype" value="balance"><span class="checkbox-icon-round"></span></div>
					{#else#}
					 <a class="investMoney" href="{#$member_userDomain#}/recharge.html" style="color: #151515; opacity: 0.5; font-weight: normal;">充值</a>
					{#/if#}
				</li>
				{#/if#}
				
				{#if $row.pay_code == "fomopay_wxpay"#}
				<li class="check-item" id="fomopaypObj" data-code="{#$row.pay_code#}">
					<div class="left_item">
						<div class="check-item-img"><img src="{#$cfg_basehost#}/templates/member/touch/images/wxpay.png"></div>
						<div class="check-item-txt"><h3>{#$row.pay_name#}</h3></div>  {#* 推荐智慧城市用户使用  *#}
					</div>
					<div class="check-item-right"><input type="radio" name="paytype" value="{#$row.pay_code#}"><span class="checkbox-icon-round"></span></div>
				</li>
				{#/if#}
				{#if $row.pay_code == "fomopay_paynow"#}
				<li class="check-item" id="fomopaypObj" data-code="{#$row.pay_code#}">
					<div class="left_item">
						<div class="check-item-img"><img src="{#$cfg_basehost#}/api/payment/fomopay_paynow/images/fomopay_paynow.png"></div>
						<div class="check-item-txt"><h3>{#$row.pay_name#}</h3></div>  {#* 推荐智慧城市用户使用  *#}
					</div>
					<div class="check-item-right"><input type="radio" name="paytype" value="{#$row.pay_code#}"><span class="checkbox-icon-round"></span></div>
				</li>
				{#/if#}

				{#if $row.pay_code == 'bytemini'#}
				<li class="check-item" id="bytemini" data-code="{#$row.pay_code#}">
					<div class="left_item">
						<div class="check-item-img"><img src="{#$cfg_basehost#}/api/payment/bytemini/bytemini.png"></div>
						<div class="check-item-txt"><h3>{#$row.pay_name#}</h3></div>
					</div>
					<div class="check-item-right"><input type="radio" name="paytype" value="bytemini"><span class="checkbox-icon-round"></span></div>
				</li>
				{#/if#}
				{#if $row.pay_code == "devpay"#}
				<li class="check-item" id="devpayObj" data-code="{#$row.pay_code#}">
					<div class="left_item">
						<div class="check-item-img"><img src="{#$cfg_basehost#}/api/payment/devpay/devpay.png"></div>
						<div class="check-item-txt"><h3>{#$row.pay_name#}</h3></div>  {#* 推荐智慧城市用户使用  *#}
					</div>
					<div class="check-item-right"><input type="radio" name="paytype" value="devpay"><span class="checkbox-icon-round"></span></div>
				</li>
				{#/if#}
				{#if $row.pay_code == "rfbp_icbc"#}
				<li class="check-item" id="rfbp_icbcObj" data-code="{#$row.pay_code#}">
					<div class="left_item">
						<div class="check-item-img"><img src="{#$cfg_basehost#}/api/payment/rfbp_icbc/rfbp_icbc.png"></div>
						<div class="check-item-txt"><h3>{#$row.pay_name#}</h3></div>
					</div>
					<div class="check-item-right"><input type="radio" name="paytype" value="rfbp_icbc"><span class="checkbox-icon-round"></span></div>
				</li>
				{#/if#}
				{#if $row.pay_code == "baidumini"#}
				<li class="check-item" id="baiduminiObj" data-code="{#$row.pay_code#}">
					<div class="left_item">
						<div class="check-item-img"><img src="{#$cfg_basehost#}/api/payment/baidumini/baidumini.png"></div>
						<div class="check-item-txt"><h3>{#$row.pay_name#}</h3></div>
					</div>
					<div class="check-item-right"><input type="radio" name="paytype" value="baidumini"><span class="checkbox-icon-round"></span></div>
				</li>
				{#/if#}
				{#if $row.pay_code == "qqmini"#}
				<li class="check-item" id="qqminiObj" data-code="{#$row.pay_code#}">
					<div class="left_item">
						<div class="check-item-img"><img src="{#$cfg_basehost#}/templates/member/touch/images/pay/wxpay.png"></div>
						<div class="check-item-txt"><h3>{#$row.pay_name#}</h3></div>
					</div>
					<div class="check-item-right"><input type="radio" name="paytype" value="qqmini"><span class="checkbox-icon-round"></span></div>
				</li>
				{#/if#}
				{#if $row.pay_code == "wxpay"#}
				<li class="check-item" id="wxpayObj" data-code="{#$row.pay_code#}">
					<div class="left_item">
						<div class="check-item-img"><img src="{#$cfg_basehost#}/templates/member/touch/images/pay/wxpay.png"></div>
						<div class="check-item-txt"><h3>{#$langData['siteConfig'][19][712]#}</h3></div>
					</div>
					<div class="check-item-right"><input type="radio" name="paytype" value="wxpay"><span class="checkbox-icon-round"></span></div>
				</li>
				{#elseif $row.pay_code == "globalalipay"#}
				<li class="check-item" id="alipayObj" data-code="{#$row.pay_code#}">
					<div class="left_item">
						<div class="check-item-img"><img src="{#$cfg_basehost#}/templates/member/touch/images/pay/alipay.png"></div>
						<div class="check-item-txt"><h3>{#$langData['siteConfig'][19][713]#}</h3></div>
					</div>
					<div class="check-item-right"><input type="radio" name="paytype" value="globalalipay"><span class="checkbox-icon-round"></span></div>
				</li>
				{#elseif $row.pay_code == "alipay"#}
				<li class="check-item" id="alipayObj" data-code="{#$row.pay_code#}">
					<div class="left_item">
						<div class="check-item-img"><img src="{#$cfg_basehost#}/templates/member/touch/images/pay/alipay.png"></div>
						<div class="check-item-txt"><h3>{#$langData['siteConfig'][19][713]#}</h3></div>
					</div>
					<div class="check-item-right"><input type="radio" name="paytype" value="alipay"><span class="checkbox-icon-round"></span></div>
				</li>
				{#elseif $row.pay_code == "paypal"#}
				<li class="check-item" id="paypalObj" data-code="{#$row.pay_code#}">
					<div class="left_item">
						<div class="check-item-img"><img src="{#$cfg_basehost#}/templates/member/touch/images/pay/paypal.png"></div>
						<div class="check-item-txt"><h3>{#$langData['siteConfig'][19][714]#}</h3></div>
					</div>
					<div class="check-item-right"><input type="radio" name="paytype" value="paypal"><span class="checkbox-icon-round"></span></div>
				</li>
				{#elseif $row.pay_code == "yabandpay_wxpay"#}
				<li class="check-item" id="wxpayObj" data-code="{#$row.pay_code#}">
					<div class="left_item">
						<div class="check-item-img"><img src="{#$cfg_basehost#}/templates/member/touch/images/pay/wxpay.png"></div>
						<div class="check-item-txt"><h3>{#$langData['siteConfig'][19][712]#}</h3></div>
					</div>
					<div class="check-item-right"><input type="radio" name="paytype" value="yabandpay_wxpay"><span class="checkbox-icon-round"></span></div>
				</li>
				{#elseif $row.pay_code == "yabandpay_alipay"#}
				<li class="check-item" id="alipayObj" data-code="{#$row.pay_code#}">
					<div class="left_item">
						<div class="check-item-img"><img src="{#$cfg_basehost#}/templates/member/touch/images/pay/alipay.png"></div>
						<div class="check-item-txt"><h3>{#$langData['siteConfig'][19][713]#}</h3></div>
					</div>
					<div class="check-item-right"><input type="radio" name="paytype" value="yabandpay_alipay"><span class="checkbox-icon-round"></span></div>
				</li>
				{#elseif $row.pay_code == "xorpay_wxpay"#}
				<li class="check-item" id="wxpayObj" data-code="{#$row.pay_code#}">
					<div class="left_item">
						<div class="check-item-img"><img src="{#$cfg_basehost#}/templates/member/touch/images/pay/wxpay.png"></div>
						<div class="check-item-txt"><h3>{#$row.pay_name#}</h3></div>
					</div>
					<div class="check-item-right"><input type="radio" name="paytype" value="xorpay_wxpay"><span class="checkbox-icon-round"></span></div>
				</li>
				{#elseif $row.pay_code == "xorpay_alipay"#}
				<li class="check-item" id="alipayObj" data-code="{#$row.pay_code#}">
					<div class="left_item">
						<div class="check-item-img"><img src="{#$cfg_basehost#}/templates/member/touch/images/pay/alipay.png"></div>
						<div class="check-item-txt"><h3>{#$row.pay_name#}</h3></div>
					</div>
					<div class="check-item-right"><input type="radio" name="paytype" value="xorpay_alipay"><span class="checkbox-icon-round"></span></div>
				</li>
				{#/if#}
				{#/loop#}

			</ul>
		</div>
		<a href="javascript:;" class="close_pay_pop" @click="closePayPop"></a>
		<a href="javascript:;" class="btn_pay" @click="paySubmit(0)"><span style="display: block;">立即付款</span></a>

		<!-- 取消支付 -->
		<div class="payCancelMask"></div>
		<div class="payCancelPop">
			<h4>确定放弃本次付款？</h4>
			<p>您的订单在<span class="daojs_order"></span>内未支付将被取消， 请尽快完成支付</p>
			<div class="payBtns"><a href="javascript:;" class="cancelPay" @click="cancelpay">放弃</a><a href="javascript:;" class="keepPay" @click="keeppay">继续支付</a></div>
		</div>
        
		<!-- 密码弹窗 -->
		{#if $userinfo.paypwdCheck != 0#}
		<div class="payPwdPop">
			<a href="javascript:;" class="payBackBtn" @click="payBack"></a>
			<h4>输入支付密码</h4>
			<div class="payPwdBox">
				<p>请输入6位数字密码确认支付</p>
				<div class="payPwdInp">
					<ul>
						<li v-for="n in 6">
							<em v-if="paypwd[n-1]">•</em>
						</li>
					</ul>
				</div>
				<div class="fpwtbox">
                    {#if $userinfo.emailCheck == 1 || $userinfo.phoneCheck == 1#}
                    <a href="{#getUrlPath service='member' type='user' template='security-paypwdEdit' param="step=2"#}" class="fpwt">{#$langData['siteConfig'][5][2]#}?</a></div>{#* 忘记密码 *#}
                    {#else#}
                    <a href="javascript:;" class="fpwt" @click="bindTip = true">{#$langData['siteConfig'][5][2]#}?</a></div>
                    
                    {#/if#}
			</div>
		</div>
		{#else#}
		<div class="payPwdPop setPwdPop">
			<a href="javascript:;" class="payBackBtn" @click="payBack"></a>
			<h4>设置支付密码</h4>
			<div class="payPwdBox">
				<p>请设置6位数字支付密码</p>
				<div class="payPwdInp">
					<ul>
						<li v-for="n in 6">
							<em v-if="paypwd[n-1]">•</em>
						</li>
					</ul>
				</div>
				<div class="spwtbox">
					<p>·避免使用连续或重复数字，类似“123456”“112233”</p>
					<p>·避免使用手机号、证件号中的连续数字</p>
				</div>
			</div>
			<a href="javascript:;" class="setPwdUp" @click="setPayPwd">确定并支付</a>
		</div>
		{#/if#}
       
		<div class="num_keyboard">
			<ul class="num_ul">
				<li>1</li>
				<li>2</li>
				<li>3</li>
				<li>4</li>
				<li>5</li>
				<li>6</li>
				<li>7</li>
				<li>8</li>
				<li>9</li>
				<li class="nobg"></li>
				<li>0</li>
				<li class="del nobg" @click="delNum"></li>
			</ul>
		</div>

        <div class="pop_mask" v-show="bindTip" v-cloak></div>
        <div class="pop_agree" v-show="bindTip"  v-cloak>
            <div class="box">
                <p>为了您的账户安全，请先绑定手机号后再修改支付密码</p>
            </div> 
            <div class="btn_group">
                <a href="javascript:;" class="cancel" @click="bindTip = false;">取消</a> 
                <a href="{#$member_userDomain#}/security-chphone.html" class="keep_login">去绑定</a>
            </div>
        </div>
	</div>

	<form action="{#$cfg_basehost#}/include/ajax.php" method="get" id="publicpayform">
		<input type="hidden" name="service"  id="pservice" value="" />
		<input type="hidden" name="action"   id="paction" value="pay" />
		<input type="hidden" name="ordertype"   id="pordertype" value="" />
		<input type="hidden" name="paytype"   id="ppaytype" value="" />
		<input type="hidden" name="ordernum" id="pordernum" value="" />
		<input type="hidden" name="final" id="pfinal" value="" />
		<input type="hidden" name="peerpay"  id="ppeerpay" value="" />
		<input type="hidden" name="buytype"  id="buytype" value="" />

		<!--会员充值相关-->
		<input type="hidden" name="level"  id="plevel" value="" />
		<input type="hidden" name="day"  id="pday" value="" />
		<input type="hidden" name="daytype"  id="pdaytype" value="" />

		<!--商家入驻相关-->

		<input type="hidden" name="action_1"  id="action_1" value="" />
		<input type="hidden" name="action_2"  id="action_2" value="" />

		<!--保障金相关-->
		<input type="hidden" name="amount"  id="pamount" value="" />
	</form>

    <div class="payPhoneSuccessTips">支付成功</div>
</div>
<script>
    var monBonus = '{#$userinfo.surplusbonus#}';
    var bonus = '{#$userinfo.bonus#}'
    var pwdCheck = '{#$userinfo.paypwdCheck#}';

    var payDevice = navigator.userAgent;

    // 倒计时
    var payPopCutDown = null;
    var classAdd = false;
    $('body').delegate('.publicpaybtn', 'touchstart', function (e) {
        if (payPopCutDown) {
            clearInterval(payPopCutDown)
        }
        if (!$(this).hasClass('paotuipaybtn')) {
            if ((typeof (depositPrice) != "undefined" && depositPrice != 0) || typeof (depositPrice) == "undefined") {
                $(".payBeforeLoading").show();
            }
        }
        setTimeout(function () {
            var block = $(".payMask").css('display') == 'block';
            var block2 = $(".payBeforeLoading").css('display') == 'block';
            if (!block && $(".confirmPop").length == 0 && block2) {
                $('.publicpaybtn').click();
            }
        }, 1000)

    })

    if (navigator.userAgent.toLowerCase().match(/micromessenger/)) {
        $("#alipayObj").remove();
    }

    if (navigator.userAgent.toLowerCase().match(/Alipay/i) == "alipay") {
        $("#qqminiObj ,#wxpayObj").remove();
    }

    $(".payListBox ul li").eq(0).addClass('paychosed');  //默认第一个选中


    



    var payVue = new Vue({
        el: "#payPage",
        data: {
            paypwd: [],
            loading: false,
            pwdCheck: Number(pwdCheck), //是否设置过支付密码
            bindTip:false, //绑定手机提示
            paySuccessCall:'', //支付成功之后的回调
            closePayPopCall:'', //关闭支付的回调
            payFailCall:'', //支付失败的回调
            isPaying:false, //正在请求  防止多次触发
        },
        mounted() {
            var tt = this;
            // 切换支付方式
            $('.payListBox li').click(function () {
                var t = $(this);
                if (!t.hasClass('disabled_pay')) {
                    t.addClass('paychosed').siblings('li').removeClass('paychosed');
                }
            });
            // 数字键
            $(".num_keyboard li:not(.nobg)").off('click').bind('click', function () {
                var t = $(this), txt = t.text();
                if (tt.paypwd.length <= 6) {
                    tt.paypwd.push(txt);
                }
            })

        },
        methods: {
            // 关闭支付弹窗
            closePayPop: function () {
                var tt = this;
                if(tt.closePayPopCall){
                    tt.closePayPopCall();
                    // tt.cancelpay()
                    return false;
                }
                $(".payCancelMask,.payCancelPop").css('display', 'block');
                if ($('.publicpaybtn').hasClass('disabled') || $('.publicpaybtn').attr('disabled')) {
                    $('.publicpaybtn').removeClass('disabled').text('去支付')
                    $('.publicpaybtn').removeAttr('disabled')
                }
                if ($('.daojs_order').text() == '') {
                    // payCutDown(1,);
                }


            },

            // 继续支付
            keeppay: function () {
                $(".payCancelMask,.payCancelPop").css('display', 'none');
            },

            // 取消支付
            cancelpay: function () {
                $(".payCancelMask,.payCancelPop").css('display', 'none');
                $(".payMask").hide();
                $('.payPop').css('transform', 'translateY(100%)');
                $("html").removeClass('noscroll');
                if (typeof (timer_trade) != 'undefined') {
                    clearInterval(timer_trade);
                }
                $('.check-item').removeAttr('style').removeClass('disabled_pay').find('h3 em').text(''); //新增  取消支付时 将之前隐藏的支付方式显示出来
                $(".check-item").eq(0).click()
                classAdd = false;
                
                clearInterval(payPopCutDown);

                if (payPopBtnObj) {
                    payPopBtnObj.removeClass('disabled');
                }

                if (orderurl != '') {
                    window.location.replace(orderurl);
                }
            },

            // 返回上一页
            payBack: function () {
                var tt = this;
                $(".payPwdPop,.num_keyboard").css("transform", "translateY(100%)");
                tt.paypwd = [];
            },
            // 支付提交
            paySubmit: function (check, appCashier, orderinfo) {
                var tt = this;
                // var et = event.currentTarget;
                // check是否需要验证密码
                var useBalance = 0;
                var addressid = '';
                var payType = $(".payListBox li.paychosed").attr('data-code');
                $("#payPage .btn_pay").attr('href', 'javascript:;'); //去除链接
                var alertpopOptions = {
                    btnCancel: '确定',
                    title: langData['shop'][2][23],
                    btnColor: '#222',
                    noSure: true,
                    isShow: true
                }

                if(appCashier){
                    payType = 'wxpay';
                }

                if (typeof (payType) == 'undefined') {
                    alertpopOptions['title'] = '请选择支付方式';
                    confirmPop(alertpopOptions);
                    return false;
                }
                if (!check && $("#balance").hasClass('paychosed')) {
                    tt.checkPwdPopShow();
                    if (typeof (ordertype) != 'undefined' && ordertype != '') {

                        $("#pordertype").val(ordertype);
                    }
                    $("#payform input[name='useBalance']").val(1)
                } else {

                    var ordertypestr = '&action=pay';

                    var param = '';
                    if (typeof (ordertype) != 'undefined' && ordertype != '') {

                        ordertypestr = '&action=' + ordertype + '&ordertype=' + ordertype;
                        console.log(ordertypestr)
                        if (ordertype == 'promotion') {
                            ordertypestr += '&amount=' + order_amount;
                        }

                        //跑腿支付
                        if (ordertype == 'paotuipay') {
                            $("#paction").val('paotuipay');
                        }

                        if (ordertype == 'refreshTop') {
                            service = 'siteConfig';
                            /*用户充值*/
                            ordertypestr = '&ordertype=' + ordertype + '&action=' + ordertype;

                            /*刷新置顶*/
                            var module = $("#refreshTopForm input[name='module']").val();
                            var act = $("#refreshTopForm input[name='act']").val();
                            var aid = $("#refreshTopForm input[name='aid']").val();
                            var amount = $("#refreshTopForm input[name='amount']").val();
                            var config = $("#refreshTopForm input[name='config']").val();
                            var type = $("#refreshTopForm input[name='type']").val();
                            var tourl = $("#refreshTopForm input[name='tourl']").val();
                            var titleblod = $("#refreshTopForm input[name='titleblod']").val();
                            var titlered = $("#refreshTopForm input[name='titlered']").val();
                            titleblod = titleblod != undefined ? titleblod : '';
                            titlered = titlered != undefined ? titlered : '';

                            $("#paction").val('refreshTop');

                            $("#publicpayform").append(
                                '<input type="hidden" name="module"  value="' + module + '" />' +
                                '<input type="hidden" name="act"   	  value="' + act + '" />' +
                                '<input type="hidden" name="aid"   value="' + aid + '" />' +
                                '<input type="hidden" name="amount"   value="' + amount + '" />' +
                                '<input type="hidden" name="config"   value="' + config + '" />' +
                                '<input type="hidden" name="type"   value="' + type + '" />' +
                                '<input type="hidden" name="tourl"  value="' + tourl + '" />'
                            );

                            ordertypestr += '&module=' + module + '&act=' + act + '&aid=' + aid + '&amount=' + amount + '&config=' + config + '&type=' + type + '&tourl=' + encodeURIComponent(tourl) + '&titleblod=' + titleblod + '&titlered=' + titlered;
                        } else if (ordertype == 'payEncourage') {
                            service = 'siteConfig';
                            /*用户充值*/
                            ordertypestr = '&ordertype=' + ordertype + '&action=' + ordertype;

                            /*刷新置顶*/
                            var module = $("#payEncourage input[name='module']").val();
                            var act = $("#payEncourage input[name='act']").val();
                            var aid = $("#payEncourage input[name='aid']").val();
                            var amount = $("#payEncourage input[name='amount']").val();
                            var config = $("#payEncourage input[name='config']").val();
                            var type = $("#payEncourage input[name='type']").val();
                            var tourl = $("#payEncourage input[name='tourl']").val();
                            var titleblod = $("#payEncourage input[name='titleblod']").val();
                            var titlered = $("#payEncourage input[name='titlered']").val();
                            titleblod = titleblod != undefined ? titleblod : '';
                            titlered = titlered != undefined ? titlered : '';

                            $("#paction").val('payEncourage');

                            $("#publicpayform").append(
                                '<input type="hidden" name="module"  value="' + module + '" />' +
                                '<input type="hidden" name="act"   	  value="' + act + '" />' +
                                '<input type="hidden" name="aid"   value="' + aid + '" />' +
                                '<input type="hidden" name="amount"   value="' + amount + '" />' +
                                '<input type="hidden" name="config"   value="' + config + '" />' +
                                '<input type="hidden" name="type"   value="' + type + '" />' +
                                '<input type="hidden" name="tourl"  value="' + tourl + '" />'
                            );

                            ordertypestr += '&module=' + module + '&act=' + act + '&aid=' + aid + '&amount=' + amount + '&config=' + config + '&type=' + type + '&tourl=' + tourl + '&titleblod=' + titleblod + '&titlered=' + titlered;
                            console.log(ordertypestr);
                        } else if (ordertype == 'fabuPay') {

                            /*发布支付*/
                            service = 'member';
                            $("#payform input[name='createtype']").val(0);
                            $("#payform input[name='paytype']").val(payType);
                            param = $("#payform ").serialize();

                            ordertypestr += '&ordertype=fabuPay';


                            /*发布分类信息、延长有效期*/
                            if ($("#payform").length && $("#payform input[name='module']").val() == 'info') {

                                var module = $("#payform input[name='module']").val();
                                var act = $("#payform input[name='act']").val();
                                var aid = $("#payform input[name='aid']").val();
                                var amount = $("#payform input[name='amount']").val();
                                var type = $("#payform input[name='type']").val();
                                var tourl = $("#payform input[name='tourl']").val();


                                $("#publicpayform").append(
                                    '<input type="hidden" name="module"  value="' + module + '" />' +
                                    '<input type="hidden" name="act"   	  value="' + act + '" />' +
                                    '<input type="hidden" name="aid"   value="' + aid + '" />' +
                                    '<input type="hidden" name="amount"   value="' + amount + '" />' +
                                    '<input type="hidden" name="type"   value="' + type + '" />' +
                                    '<input type="hidden" name="tourl"  value="' + tourl + '" />'
                                );
                            }

                        }

                        ordertypestr += '&final=1';
                    }

                    if (typeof (upordertype) != 'undefined' && upordertype != '') {
                        /*用户升级*/
                        var level = $("#plevel").val();
                        var day = $("#pday").val();
                        var daytype = $("#pdaytype").val();


                        ordertypestr += '&level=' + level + '&day=' + day + '&daytype=' + daytype + '&ordertype=' + upordertype + '&final=1';

                        if (upordertype == 'upgrade_filter_user') {
                            ordertypestr += '&action=upgrade';
                        }
                    }

                    if ($('#action_1').val() != '') {
                        /*商家入驻*/
                        ordertypestr = "&action=joinBusinessPay&action_1=checkJoinPayAmount&action_2=joinBusinessPay";

                    }

                    if ($("#pordertype").val() == 'paotui') {
                        ordertypestr = '&action=paotuipay'
                    }

                    var peerpay = $("#ppeerpay").val();
                    if (peerpay == 1) {
                        ordertypestr += '&peerpay=1&peerpayfinal=1';
                    }

                    if (service == 'shop') {
                        var addressid = $("#address").val() || '';
                        var buytype = $("#buytype").val();
                        var ctype = typeof (confirmtype) != 'undefined' ? confirmtype : ($("#confirmtype").length ? $("#confirmtype").val() : "")
                        ordertypestr += '&final=1&addressid=' + addressid + '&confirmtype=' + ctype+'&buytype='+buytype;
                    }

                    var appcall = payType == 'wxpay' ? 'wechatPay' : (payType == 'alipay' ? 'aliPay' : '')
                    if (service == 'waimai' && typeof (shopid) != "undefined") {
                        console.log('清除购物车')
                        utils.removeStorage("wm_cart_" + shopid)
                    }
                    if ( //余额、购物卡、微信、支付宝支付
                        payType == 'money' || 
                        payType == 'huoniao_bonus' || 
                        (
                            (
                                payType == 'wxpay' && 
                                !navigator.userAgent.toLowerCase().match(/micromessenger/)  && 
                                navigator.userAgent.toLowerCase().indexOf('huoniao') > -1
                            ) 
                            || 
                            (
                                payType == 'alipay' && 
                                navigator.userAgent.toLowerCase().indexOf('huoniao') > -1
                            )
                        )
                    ) {

                        if (payType == 'money') {
                            payType = "money&useBalance=1&balance=" + order_amount + "&paypwd=" + tt.paypwd.join('');
                        }
                        if (payType == 'huoniao_bonus') {
                            payType = "huoniao_bonus&useBalance=0";
                        }

                        var if_app = '';
                        if (navigator.userAgent.toLowerCase().indexOf('huoniao') > -1) {
                            if_app = '&app=1';
                        }

                        //调用APP收银台
                        if(appCashier){
                            setupWebViewJavascriptBridge(function (bridge) {
                                bridge.callHandler('cashier', {
                                    'service': service,
                                    'module': typeof(module) == "undefined" || module == null ? service : module,
                                    'type': typeof (ordertype) != 'undefined' ? ordertype : '',
                                    'orderinfo': orderinfo,
                                    'ordertype': ordertypestr.slice(1) + "&addressid=" + addressid + '&' + param
                                }, function (responseData) {
                                    // alert(responseData)
                                    //返回ok，需要刷新页面
                                    if(responseData == 'ok' && orderinfo.orderurl == 'stay'){
                                        if(tt.paySuccessCall){  //支付成功之后的回调  ,如果不需要页面跳转，可设置这个方法
                                            tt.paySuccessCall();
                                            return false;
                                        }else{
                                            bridge.callHandler('pageReload', {}, function(responseData){});  //刷新页面
                                        }
                                    }

                                    //返回end_countdown，说明支付倒计时已经结束，如果是订单类型并且在下单页面的，需要通过currentPageOpen打开orderurl
                                    if(responseData == 'end_countdown'){
                                        //后期增加判断支付的业务，像充值、打赏、升级等操作，不需要对页面有任何操作
                                        alert('支付超时！');

                                        if(orderinfo.orderurl.indexOf('orderdetail') > -1){
                                            location.href = orderinfo.orderurl + (orderinfo.orderurl.indexOf('?') > -1 ? '&' : '?') + 'currentPageOpen=1';
                                        }
                                    }

                                });
                            });
                            return false;
                        }
                        $(".payBeforeLoading").show();
                        checkpay = true;
                        if(tt.isPaying) return false;
                        tt.isPaying = true;
                        $.ajax({
                            url: "/include/ajax.php?service=" + service + ordertypestr + "&addressid=" + addressid + "&paytype=" + payType + "&ordernum=" + ordernum + if_app,
                            type: "POST",
                            data: param,
                            dataType: "json",
                            success: function (data) {
                                tt.isPaying = false;
                                if (data && data.state == 100) {
                                	tt.paypwd = []
                                    $(".payCancelMask,.payCancelPop").css('display', 'none');
                                    $(".payMask").hide();
                                    $('.payPop,.payPwdPop,.num_keyboard').css('transform', 'translateY(100%)');
                                    $("html").removeClass('noscroll');
                                    $(".payBeforeLoading").hide();

                                    
                                    if(if_app == ''){
                                        if ($("#ordertype").val() == 'payPhone' || $("#payform input[name='action']").val() == 'payPhone'  || (typeof ordertype != 'undefined' && ordertype == 'payPhone')) {
                                            return;
                                        }
                                    }

                                    //去除阻止点击的样式
                                    if (payPopBtnObj) {
                                        payPopBtnObj.removeClass('disabled');
                                    }
                                    
                                    if (navigator.userAgent.toLowerCase().indexOf('huoniao') <= -1) {
                                        if(tt.paySuccessCall){  //支付成功之后的回调  ,如果不需要页面跳转，可设置这个方法
                                            tt.paySuccessCall();
                                            return false;
                                        }

                                        // !不注释掉会导致分类信息发布使用余额付款费，页面不跳转的问题 by gz 20220128  
                                        if ($('#module').val() == 'info' && ordertype == 'fabuPay' && payType != 'wxpay') {
                                            tt.cancelpay()
                                            window.location.replace(infoManage); //由于data.info里没有给返回的url 指定跳转分类信息管理页
                                        } else {
                                            window.location.replace(data.info);
                                        }
                                        // if(data.info != '发布成功'){
                                        // 		 window.location.replace(data.info);
                                        // 	 }else{
                                        // 		 tt.cancelpay()
                                        // 	 }

                                    } else {
                                        if ($('.publicpaybtn').hasClass('disabled')) {
                                            $('.publicpaybtn').removeClass('disabled').text('去支付')
                                        }
                                        if ((payType.indexOf('money') <= -1 || payType.indexOf('huoniao_bonus') <= -1) && order_amount > 0) {
                                            tt.appPay(data.info, appcall)
                                        } else {
                                            if(tt.paySuccessCall){  //支付成功之后的回调  ,如果不需要页面跳转，可设置这个方法
                                                tt.paySuccessCall();
                                                return false;
                                            }
                                            if ($('#module').val() == 'info' && ordertype == 'fabuPay' && payType != 'wxpay') {
                                                tt.cancelpay();
                                                // setupWebViewJavascriptBridge(function (bridge) {
                                                //      bridge.callHandler('pageClose', {}, function (responseData) {
                                                //      });
                                                //  });
                                            } else {
                                                // if(data.info != '发布成功'){
                                                // 	window.location.replace(data.info);
                                                // }else{
                                                tt.cancelpay()
                                                // }

                                                // if(data.info != '发布成功'){
                                                // 	window.location.replace(data.info);
                                                // }else{
                                                // 	tt.cancelpay()
                                                // }
                                            }
                                        }
                                    }

                                } else {
                                    $(".payBeforeLoading").hide();
                                    showErrAlert(data.info);//订单不存在
                                    $(".pay_check_pwd").addClass('noClick');
                                }
                            },
                            error: function (data) {
                                tt.isPaying = false;
                                $(".payBeforeLoading").hide();
                                showErrAlert(langData['siteConfig'][6][203]);//网络错误，请重试！
                            }
                        });

                    } else { //其他支付方式
                        $("#pservice").val(service);
                        if (typeof (ordertype) != 'undefined') {
                            /*用户充值*/
                            $("#pordertype").val(ordertype);
                            $("#pfinal").val(1);
                        }

                        if (typeof (upordertype) != 'undefined') {
                            /*用户升级*/
                            $("#pordertype").val(upordertype);
                            $("#pfinal").val(1);
                        }
                        $("#ppaytype").val(payType);
                        if(typeof ordernum != 'undefined'){
                            $("#pordernum").val(ordernum);
                        }

                        // $("#publicpayform").submit();
                        var addressid = $("#address").val() || '';
                        $(".payCancelMask,.payCancelPop").css('display', 'none');
                        $(".payMask").hide();
                        $('.payPop').css('transform', 'translateY(100%)');
                        $("html").removeClass('noscroll');
                        var housetypestr = '';
                        if (typeof (ordertype) != 'undefined' && ordertype == 'fabuPay') {
                            var housetype = $("#payform input[name='type']").val();
                            housetypestr = "&type=" + housetype;
                        }
                        console.log($("#publicpayform").serialize())
                        $("#payPage .btn_pay").attr('href', masterDomain + "/include/ajax.php?" + $("#publicpayform").serialize() + "&addressid=" + addressid + housetypestr)
                        setTimeout(function () {
                            $("#payPage .btn_pay").attr('href', 'javascript:;')
                        }, 1500)
                        if (payType != 'money') {
                            setTimeout(function () {
                                window.location.href = orderurl;
                            }, 3000)
                        }
                    }

                }

            },
            // 余额支付 验证密码
            checkPwdPopShow: function () {
                $(".payPwdPop").css('transform', "translateY(0)");
                setTimeout(function () {
                    $(".num_keyboard").css('transform', "translateY(0)");
                }, 100)
            },

            // 清除输入的密码
            delNum: function () {
                var tt = this;
                tt.paypwd.pop();
            },

            // 设置支付密码
            setPayPwd: function () {
                var tt = this;
                if (tt.loading) return false;
                if (tt.paypwd.length != 6) {
                    showErrAlert('请输入新密码');
                    return false;
                }
                tt.loading = true;
                param = "pay1=" + tt.paypwd.join('') + "&pay2=" + tt.paypwd.join('');
                axios({
                    method: 'post',
                    url: "/include/ajax.php?service=member&action=updateAccount&do=paypwdAdd", // 加随机数防止缓存,
                    data: param,
                }).then((response) => {
                    $(".payBeforeLoading").hide();
                    var data = response.data;
                    if (data && data.state == 100) {
                        // tt.payBack()
                        $(".payPwdPop,.num_keyboard").css("transform", "translateY(100%)");

                        // showErrAlert(data.info);
                        showErrAlert('支付密码设置成功');
                        tt.paySubmit(1);
                        tt.payBack()

                    } else {
                        showErrAlert(data.info);
                        tt.loading = false;
                    }
                })
            },

            // 微信或者小程序
            jsApiCall: function (jsApiParameters) {
                var tt = this;
                var wx_miniprogram;
                wx.miniProgram.getEnv(function (res) {
                    wx_miniprogram = res.miniprogram;
                });

                var jsApiParameters = tt.jsApiParameters

                //小程序
                if (window.__wxjs_environment == 'miniprogram' || wx_miniprogram) {
                    var params = '?timestamp=' + jsApiParameters.timeStamp + '&nonceStr=' + jsApiParameters.nonceStr + '&signType=' + jsApiParameters.signType + '&paySign=' + encodeURIComponent(jsApiParameters.paySign) + '&prepay_id=' + (jsApiParameters.package).replace('prepay_id=', '') + '&returnUrl=' + encodeURIComponent('{#$returnUrl#}');
                    var path = '/pages/pay/pay' + params;
                    wx.miniProgram.redirectTo({ url: path });

                    //公众号
                } else {
                    tt.onBridgeReady()
                }
            },

            // 微信支付
            onBridgeReady: function () {
                var tt = this;
                var jsApiParameters = tt.jsApiParameters
                WeixinJSBridge.invoke(
                    'getBrandWCPayRequest', {
                    "appId": jsApiParameters.appId,     //公众号ID，由商户传入
                    "timeStamp": jsApiParameters.timeStamp,         //时间戳，自1970年以来的秒数
                    "nonceStr": jsApiParameters.nonceStr, //随机串
                    "package": jsApiParameters.package,
                    "signType": jsApiParameters.signType,         //微信签名方式：
                    "paySign": jsApiParameters.paySign //微信签名
                },
                    function (res) {
                        if (res.err_msg == "get_brand_wcpay_request:ok") {
                            // 使用以上方式判断前端返回,微信团队郑重提示：
                            //res.err_msg将在用户支付成功后返回ok，但并不保证它绝对可靠。
                        }
                    });

            },

            // 支付宝支付
            tradePay: function (tradeNO) {
                var tt = this;
                tt.ready(function () {
                    // 通过传入交易号唤起快捷调用方式(注意tradeNO大小写严格)
                    AlipayJSBridge.call("tradePay", {
                        tradeNO: tradeNO
                    }, function (data) {
                        log(JSON.stringify(data));
                        if ("9000" == data.resultCode) {
                            log("支付成功");
                        }
                    });
                });
            },

            // 调起客户端支付
            appPay(orderInfo, appCall) {
                var tt = this;
                setupWebViewJavascriptBridge(function (bridge) {
                    isOpen = true;
                    bridge.callHandler(appCall, {
                        "orderInfo": orderInfo
                    }, function (responseData) {
                        // if(responseData == 'fail'){
                        // 	window.location.href = orderurl;
                        // }
                    });
                });

                setTimeout(function () {
                    window.location.href = orderurl;
                }, 3000)
            },


            // 绑定手机的弹窗
            showConfirmPop(){

            },
        },
        watch: {
            paypwd: function () {
                var tt = this;
                if (tt.pwdCheck && tt.paypwd.length == 6) {  //密码输入6位
                    $("#paypwd").val(tt.paypwd.join(''));
                    $('.payBeforeLoading').show();
                    var paramstr = '';
                    ordertype = $("#pordertype").val();

                    if (typeof (siteservice) != 'undefined') {
                        if (ordertype == 'refreshTop') {
                            var type = $("#refreshTopForm input[name='type']").val();
                            var module = $("#refreshTopForm input[name='module']").val();
                            var act = $("#refreshTopForm input[name='act']").val();
                            var aid = $("#refreshTopForm input[name='aid']").val();
                            var amount = $("#refreshTopForm input[name='amount']").val();
                            var ordertype = $("#refreshTopForm input[name='action']").val();

                            service = siteservice;
                            paramstr = "&type=" + type + "&module=" + module + "&act=" + act + "&aid=" + aid + "&amount=" + amount + "&ordertype=" + ordertype;
                        }

                    }
                    ordertype = $("#pordertype").val();

                    if (ordertype != '' && typeof (ordertype) != 'undefined') {

                        paramstr = '&ordertype=' + ordertype;
                    }

                    if (ordertype == 'fabuPay') {

                        service = 'member';
                        module = $("#module").val();
                        /*发布支付*/

                        paramstr = '&module=' + module + '&ordertype=fabuPay';
                    }
                    if (service == 'member') {

                        if (typeof (upordertype) != 'undefined') {

                            paramstr = "&ordertype=" + upordertype;
                        }
                    }

                    var actionstr = 'checkPayAmount';
                    if ($('#action_1').val() != '') {
                        /*商家入驻*/
                        paramstr = "&action_1=checkJoinPayAmount&action_2=joinBusinessPay";

                        actionstr = 'checkJoinPayAmount';
                    }

                    var peerpay = $("#ppeerpay").val();
                    var addressid = $("#address").val() || '';
					var buytype = $("#buytype").val();

                    if (peerpay == 1) {
                        actionstr += '&peerpay=1';
                    }
                    if (ordertype == 'paotui') {

                        actionstr += '&paotui=1';
                    }
                    $.ajax({
                        url: "/include/ajax.php?service=" + service + "&action=" + actionstr + "&ordernum=" + ordernum + "&paypwd=" + tt.paypwd.join('') + "&useBalance=1&buytype="+buytype+"&addressid=" + addressid + "&balance=" + order_amount + paramstr,
                        type: "POST",
                        dataType: "json",
                        success: function (data) {
                            $('.payBeforeLoading').hide();
                            if (data && data.state == 100) {
                                // $.ajax({
                                // 	url: "/include/ajax.php?service="+service+"&action=pay&paytype=money&ordernum="+ordernum+"&useBalance=1&balance="+order_amount+"&paypwd="+tt.paypwd,
                                // 	type: "POST",
                                // 	dataType: "json",
                                // 	success: function (data) {
                                // 		if(data && data.state == 100){
                                //
                                // 			window.location.href = data.info;
                                // 		}else{
                                // 			alert(data.info);//订单不存在
                                // 			$(".pay_check_pwd").addClass('noClick');
                                // 		}
                                // 	},
                                // 	error: function(){
                                // 		alert(langData['siteConfig'][6][203]);//网络错误，请重试！
                                // 	}
                                // });
                                tt.paySubmit(1)
                            } else {
                                if (actionstr == 'checkPayAmount') {
                                    tt.paypwd = [];
                                }
                                $(".payBeforeLoading").hide();
                                showErrAlert(data.info);//订单不存在

                            }
                        },
                        error: function () {
                            showErrAlert(langData['siteConfig'][6][203]);//网络错误，请重试！
                            $(".pay_check_pwd").addClass('noClick');
                        }
                    });

                }
            }
        }

    })


    function payCutDown(type, EndDate, orderinfo) {


        //调起APP收银台，暂只支持安卓APP6.1以上版本
        if(
            device.indexOf('huoniao') > -1 && 
            device.indexOf('Android') > -1 && 
            appInfo && appInfo.version != '' && 
            compare('6.1.1', appInfo.version) && 
            orderinfo != undefined
        ) {
            $(".payBeforeLoading").hide();
            $('.payMask, .payPop').remove();
            payVue.paySubmit(0, 1, orderinfo);
            return false;
        }

        if(orderinfo && orderinfo.ordernum && orderinfo.order_amount){
            ordernum = orderinfo.ordernum;
            order_amount = orderinfo.order_amount;
        }

        if (type != 'reward') {
            if (EndDate == 0) {
                $(".payCutDown").parent().hide();
                return;
            } else {
                $(".payCutDown").parent().show();
            }
            $('.payCancelPop h4').text('确定放弃本次付款？');
            $('.payCancelPop p').html('您的订单在<span class="daojs_order"></span>内未支付将被取消， 请尽快完成支付');
        } else {
            $(".payCutDown").parent('p').html('打赏支持');
            $('.payCancelPop h4').text('确定放弃本次打赏？');
            $('.payCancelPop p').html('觉得内容不错，就打赏支持一下吧!');
        }


        if (EndDate == 0) {
            $(".payCutDown").parent().hide();
            clearInterval(payPopCutDown)
            return;
        } else {
            $(".payCutDown").parent().show();
        }

        //验证是否支付成功，如果成功跳转到指定页面
        // if (navigator.userAgent.toLowerCase().indexOf('huoniao') > -1) {
            setTimeout(function () {
                timer_trade = setInterval(function () {
                    $.ajax({
                        type: 'POST',
                        async: false,
                        url: '/include/ajax.php?service=member&action=tradePayResult&order=' + ordernum,
                        dataType: 'json',
                        success: function (str) {
                            if (str.state == 100 && str.info != "") {
                                clearInterval(timer_trade);

                                if(typeof(payVue) != 'undefined' && payVue.paySuccessCall){  //支付成功之后的回调  ,如果不需要页面跳转，可设置这个方法
                                    payVue.paySuccessCall();
                                    return false;
                                }
                                // if(device.indexOf('huoniao_Android') > -1) {
                                //     setupWebViewJavascriptBridge(function (bridge) {
                                //         bridge.callHandler('pageClose', {}, function (responseData) {
                                //         });
                                //     });
                                //     location.href = str.info;
                                // }else{
                                if ($("#ordertype").val() != 'payPhone' && $("#payform input[name='action']").val() != 'payPhone' && (typeof ordertype == 'undefined' || (typeof ordertype != 'undefined' && ordertype != 'payPhone'))) {
                                    // location.href = str.info + (str.info.indexOf('?') > -1 ? '&' : '?') + 'currentPageOpen=1';
                                }else{
                                    //隐藏收银台
                                    $('.payMask,.payPop').hide();

                                    //显示支付成功提示
                                    $('.payPhoneSuccessTips').show();
                                    setTimeout(function(){
                                        $('.payPhoneSuccessTips').hide();
                                    }, 3000);

                                    //去除阻止点击的样式
                                    if(payPopBtnObj){
                                   	  payPopBtnObj.removeClass('disabled');

                                    }
                
                                    //支付成功并有电话号码返回
                                    if(typeof(str.phone) != 'undefined'){
                                        payPopBtnObj.attr('data-tel', str.phone);

                                        if(payPhoneVue){
                                            payPhoneVue.payPhoneNumber = str.phone;
                                            payPhoneVue.payPhoneTitle = str.title;
                                            payPhoneVue.showPayPhonePop = true;
                                        }else{
                                            window.location.href = 'tel:'+ str.phone;
                                        }
                                        
                                        return false;
                                    }

                                    //如果开启了隐私号码
                                    if(cfg_privateNumber_state == '1'){
                                        payPopBtnObj.removeClass('payPhoneBtn');
                                        payPopBtnObj.click();

                                        if(!phoneCheck){
                                            setTimeout(function(){
                                                $('.private_phone_header h3').html('现在绑定手机，为您使用虚拟号拨出');
                                                $('.private_phone_header p').html('安全保障，保护用户个人隐私');
                                            }, 10);
                                        }
                                    }
                                }
                                // }
                            }
                        }
                    });
                }, 1000);
            }, 3000)
        // }

        $(".payBeforeLoading").hide();
        if ($('#balance').is(':hidden')) {
            $("#balance").removeClass('paychosed').addClass('disabled_pay');
        }
        payPopCutDown = setInterval(function () {
            var nowDate = (new Date()).valueOf() + timeOffset;
            timeArea = EndDate * 1000 - nowDate;
            if (!classAdd) {
                if (Number($("#balance").attr('data-balance')) < Number($("#amout").text())) {
                    $("#balance").removeClass('paychosed').addClass('disabled_pay');
                    $(".payListBox ul li").eq(1).addClass('paychosed').siblings('li').removeClass('paychosed');  //默认第一个选中
                    classAdd = true;

                } else {
                    $("#balance").removeClass('disabled_pay')
                }
            }
            if (timeArea <= 0) {
                if (typeof (cutDown) != 'undefined') {

                    clearInterval(cutDown);
                }
                timeArea = 0;
            }
            leftd = Math.floor(timeArea / (1000 * 60 * 60 * 24)),  //计算天数
                lefth = Math.floor(timeArea / (1000 * 60 * 60) % 24),  //计算小时数
                leftm = Math.floor(timeArea / (1000 * 60) % 60),  //计算分钟数
                lefts = Math.floor(timeArea / 1000 % 60);  //计算秒数

            var dataStr, daojishiStr;

            if (lefth == 0 && leftm == 0) {
                daojishiStr = lefts + '秒'
            } else if (lefth == 0) {
                daojishiStr = leftm + '分';
            } else {
                daojishiStr = lefth + '小时' + leftm + '分';
            }
            $(".daojs_order").html(daojishiStr)

            dataStr = '<em class="phh">' + (lefth > 9 ? lefth : "0" + lefth) + '</em>:<em class="pmm">' + (leftm > 9 ? leftm : "0" + leftm) + '</em>:<em class="pss">' + (lefts > 9 ? lefts : "0" + lefts) + '</em>'
            $(".payCutDown").html(dataStr);


        }, 1000);


        if ($(".payListBox li").length == 1) {
            if ($('.check-item.paychosed').attr('data-code') != 'money') {
                $('.payMask').hide();
                $('.payPop').css('transform', 'translateY(100%)');
            }
            $('.payPop .btn_pay span').click();

            //只有一个支付方式时，直接终止脚本，注释掉的原因，如果没有任何第三方支持，只用余额支付，并且是新账号没有设置过支付密码时，页面会有问题
            // throw new Error("火鸟门户~");
        }

    }
</script>