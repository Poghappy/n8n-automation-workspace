<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset={#$cfg_soft_lang#}" />
<title>外卖统计</title>
{#$cssFile#}
<script>
var action = "{#$action#}", adminPath = "{#$adminPath#}";
var cityid = {#$cityid#}, cityList = {#$cityList#};
</script>
<style media="screen">
.tab-content {overflow: visible;}
</style>
</head>

<div class="main-content">

  <div class="page-content">
    <!-- /section:settings.box -->
    <div class="page-content-area">

      <div class="">
        <div class="col-sm-12">
          <div class="tabbable">
            <ul class="nav nav-tabs" id="myTab">
              <li{#if $action == "chartrevenue"#} class="active"{#/if#}><a href="?action=chartrevenue">商城营业额统计</a></li>
              <li{#if $action == "chartorder"#} class="active"{#/if#}><a href="?action=chartorder">订单按天统计</a></li>
              <!-- <li{#if $action == "chartordertime"#} class="active"{#/if#}><a href="?action=chartordertime">订单按时间段统计</a></li>
              <li{#if $action == "productSale"#} class="active"{#/if#}><a href="?action=productSale">商品销量</a></li>
              <li{#if $action == "chartcourier"#} class="active"{#/if#}><a href="?action=chartcourier">配送员统计</a></li> -->
            </ul>
            <div class="tab-content">
              <div class="tab-pane active">

                {#if $action == "chartrevenue"#}
                <div class="widget-box">
                  <div class="widget-header"><h5>营业额统计-条件选择</h5></div>
                  <div class="widget-body" style="padding:20px;">
                      <form id="exportorder-form" class="clearfix">
                        <input type="hidden" name="action" value="{#$action#}" />
                        <input type="hidden" name="dopost" value="getresults" />
                        <label>统计时间段</label>
                        <input id="beginDate" type="text" class="chooseDate" value="{#$lastMonthDate#}" name="beginDate" />至
                        <input id="endDate" type="text" class="chooseDate" value="{#$nowDate#}" name="endDate" />
                        <br />
                        <br />
                        <label>选择店铺
                          <br>
                          <select class="chosen-select" name="shop_id" id="shop_id">
                            <option value="0">全部店铺</option>
                            {#foreach from=$shopArr item=shop#}
                            <option value="{#$shop.id#}"{#if $shop_id == $shop.id#} selected{#/if#}>{#$shop.shopname#}</option>
                            {#/foreach#}
                          </select>
                        </label>
                        <br />
                        <div class="span12" style="margin-left: 0;"><button type="submit" class="btn btn-success">查看统计</button></div>
                      </form>
                    </div>
                </div>
                <div class="widget-box" style="margin-top: 20px;">
                  <div class="widget-header">
                    <h5>统计图</h5></div>
                  <div class="widget-body" style="padding:20px;">
                    <div id="chartscontainer"></div>
                  </div>
                </div>
                <div class="">
                  <div class="col-xs-10">
                    <div id="shopList" class="grid-view">
                      <table class="table table-striped table-bordered table-hover">
                        <thead>
                          <tr>
                            <th id="shopList_c0">时间</th>
                            <th id="shopList_c1">总营业额</th>
                            <!-- <th id="shopList_c2">货到付款</th> -->
                            <th id="shopList_c3">余额支付</th>
                            <th id="shopList_c4">在线支付</th>
                            <!-- <th id="shopList_c5">餐盒费</th> -->
                            <!-- <th id="shopList_c6">配送费</th> -->
                            <!-- <th id="shopList_c7">增值服务费统计</th> -->
                            <!-- <th id="shopList_c9">首单立减总金额</th></tr> -->
                        </thead>
                        <tbody>
                          {#$total = 0#}
                          {#$money = 0#}
                          {#$online = 0#}
                          {#$peisong = 0#}

                          {#foreach from=$dataArr item=data#}
                          {#$total = $total + $data.total#}
                          {#$money = $money + $data.money#}
                          {#$online = $online + $data.online#}
                          <!-- {#$peisong = $peisong + $data.peisong#} -->
                          <tr>
                            <td style="width: 120px">{#$data.date#}</td>
                            <td>{#$data.total#}</td>
                            <td>{#$data.money#}</td>
                            <td>{#$data.online#}</td>
                          </tr>
                          {#/foreach#}
                          <tr>
                              <td style="width: 120px">总计</td>
                              <td>{#$total|string_format:"%.2f"#}</td>
                              <td>{#$money|string_format:"%.2f"#}</td>
                              <td>{#$online|string_format:"%.2f"#}</td>
                              <!-- <td>{#$peisong|string_format:"%.2f"#}</td> -->
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                  <div class="col-xs-2">
                    <a class="btn btn-success" href="?action={#$action#}&dopost=getresults&do=export&shop_id={#$shop_id#}&beginDate={#$lastMonthDate#}&endDate={#$nowDate#}">导出成excel</a></div>
                </div>
                {#elseif $action == "chartorder"#}
                <div class="widget-box">
                  <div class="widget-header"><h5>订单统计-条件选择</h5></div>
                  <div class="widget-body" style="padding:20px;">
                      <form id="exportorder-form" class="clearfix">
                        <input type="hidden" name="action" value="{#$action#}" />
                        <input type="hidden" name="dopost" value="getresults" />
                        <label>统计时间段</label>
                        <input id="beginDate" type="text" class="chooseDate" value="{#$lastMonthDate#}" name="beginDate" />至
                        <input id="endDate" type="text" class="chooseDate" value="{#$nowDate#}" name="endDate" />
                        <br />
                        <br />
                        <label>选择店铺
                          <br>
                          <select class="chosen-select" name="shop_id" id="shop_id">
                            <option value="0">全部店铺</option>
                            {#foreach from=$shopArr item=shop#}
                            <option value="{#$shop.id#}"{#if $shop_id == $shop.id#} selected{#/if#}>{#$shop.shopname#}</option>
                            {#/foreach#}
                          </select>
                        </label>
                        <br />
                        <div class="span12" style="margin-left: 0;"><button type="submit" class="btn btn-success">查看统计</button></div>
                      </form>
                    </div>
                </div>
                <div class="widget-box" style="margin-top: 20px;">
                  <div class="widget-header">
                    <h5>统计图</h5></div>
                  <div class="widget-body" style="padding:20px;">
                    <div id="chartscontainer"></div>
                  </div>
                </div>
                <div class="">
                  <div class="col-xs-10">
                    <div id="shopList" class="grid-view">
                      <table class="table table-striped table-bordered table-hover">
                        <thead>
                          <tr>
                            <th id="shopList_c0">时间</th>
                            <th id="shopList_c1">成功订单数</th>
                          </tr>
                        </thead>
                        <tbody>
                          {#$success = 0#}

                          {#foreach from=$dataArr item=data#}
                          {#$success = $success + $data.success#}
                          <tr>
                            <td style="width: 120px">{#$data.date#}</td>
                            <td>{#$data.success#}</td>
                          </tr>
                          {#/foreach#}
                          <tr>
                              <td style="width: 120px">总计</td>
                              <td>{#$success#}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                  <div class="col-xs-2">
                    <a class="btn btn-success" href="?action={#$action#}&dopost=getresults&do=export&shop_id={#$shop_id#}&beginDate={#$lastMonthDate#}&endDate={#$nowDate#}">导出成excel</a></div>
                </div>
                {#elseif $action == "chartordertime"#}
                <div class="widget-box">
                  <div class="widget-header"><h5>订单统计-条件选择</h5></div>
                  <div class="widget-body" style="padding:20px;">
                      <form id="exportorder-form" class="clearfix">
                        <input type="hidden" name="action" value="{#$action#}" />
                        <input type="hidden" name="dopost" value="getresults" />
                        <label>统计时间段</label>
                        <input id="beginDate" type="text" class="chooseDateTime" value="{#$lastMonthDate#}" name="beginDate" />至
                        <input id="endDate" type="text" class="chooseDateTime" value="{#$nowDate#}" name="endDate" />
                        <br />
                        <br />
                        <label>选择店铺
                          <br>
                          <select class="chosen-select" name="shop_id" id="shop_id">
                            <option value="0">全部店铺</option>
                            {#foreach from=$shopArr item=shop#}
                            <option value="{#$shop.id#}"{#if $shop_id == $shop.id#} selected{#/if#}>{#$shop.shopname#}</option>
                            {#/foreach#}
                          </select>
                        </label>
                        <br />
                        <div class="span12" style="margin-left: 0;"><button type="submit" class="btn btn-success">查看统计</button></div>
                      </form>
                    </div>
                </div>
                <div class="">
                  <div class="col-xs-10">
                    <div id="shopList" class="grid-view">
                      <table class="table table-striped table-bordered table-hover">
                        <thead>
                          <tr>
                            <th id="shopList_c0">时间段</th>
                            <th id="shopList_c1">成功订单数</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td style="width: 300px">{#$lastMonthDate#} 至 {#$nowDate#}</td>
                            <td>{#$dataArr[0].success#}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
                {#elseif $action == "productSale"#}
                <div class="widget-box">
                  <div class="widget-header"><h5>订单统计-条件选择</h5></div>
                  <div class="widget-body" style="padding:20px;">
                      <form id="exportorder-form" class="clearfix">
                        <input type="hidden" name="action" value="{#$action#}" />
                        <input type="hidden" name="dopost" value="getresults" />
                        <label>统计时间段</label>
                        <input id="beginDate" type="text" class="chooseDateTime" value="{#$lastMonthDate#}" name="beginDate" />至
                        <input id="endDate" type="text" class="chooseDateTime" value="{#$nowDate#}" name="endDate" />
                        <br />
                        <br />
                        <label>选择店铺
                          <br>
                          <select class="chosen-select" name="shop_id" id="shop_id">
                            <option value="0">全部店铺</option>
                            {#foreach from=$shopArr item=shop#}
                            <option value="{#$shop.id#}"{#if $shop_id == $shop.id#} selected{#/if#}>{#$shop.shopname#}</option>
                            {#/foreach#}
                          </select>
                        </label>
                        <br />
                        <div class="span12" style="margin-left: 0;"><button type="submit" class="btn btn-success">查看统计</button></div>
                      </form>
                    </div>
                </div>
                <div class="widget-box">
                  <div class="widget-header">
                    <h5>统计图</h5>
                  </div>
                  <div class="widget-body" style="padding:20px;">
                    <div id="chartscontainer"></div>      
                  </div>
                </div>
                <div class="">
                  <div class="col-xs-10">
                    <div id="shopList" class="grid-view">
                      <table class="table table-striped table-bordered table-hover">
                        <thead>
                          <tr>
                            <th id="shopList_c0">商品名称</th>
                            <th id="shopList_c1">分类</th>
                            <th id="shopList_c2">销售量</th>
                            <th id="shopList_c3">单价</th>
                            <th id="shopList_c4">总价</th>
                          </tr>
                        </thead>
                        <tbody>
                          {#$sale = 0#}
                          {#$money = 0#}
                          {#foreach from=$dataArr item=data#}
                          {#$sale = $sale + $data.sale#}
                          {#$money = $money + $data.totalPrice#}
                          <tr>
                            <td style="width: 400px">{#$data.title#}</td>
                            <td style="width: 120px">{#$data.typename#}</td>
                            <td style="width: 120px">{#$data.sale#}</td>
                            <td style="width: 120px">{#$data.price#}</td>
                            <td style="width: 120px">{#$data.totalPrice#}</td>
                          </tr>
                          {#/foreach#}
                          <tr>
                              <td style="width: 120px">总计</td>
                              <td>&nbsp;</td>
                              <td>{#$sale#}</td>
                              <td>&nbsp;</td>
                              <td>{#$money#}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                  <div class="col-xs-2">
                    <a class="btn btn-success" href="?action={#$action#}&dopost=getresults&do=export&shop_id={#$shop_id#}&beginDate={#$lastMonthDate#}&endDate={#$nowDate#}">导出成excel</a></div>
                </div>
                {#elseif $action == "chartcourier"#}
                <div class="widget-box">
                  <div class="widget-header"><h5>配送员统计-条件选择</h5></div>
                  <div class="widget-body" style="padding:20px;">
                      <form id="exportorder-form" class="clearfix">
                        <input type="hidden" name="action" value="{#$action#}" />
                        <input type="hidden" name="dopost" value="getresults" />
<!--                         <label>城市
                          <br>
                          <select class="chosen-select" id="cityid" name="cityid" style="width: auto; min-width: 150px;"></select>
                        </label> -->
                        <br />
                        <label>统计时间段</label>
                        <input id="beginDate" type="text" class="chooseDateTime" value="{#$lastMonthDate#}" name="beginDate" />至
                        <input id="endDate" type="text" class="chooseDateTime" value="{#$nowDate#}" name="endDate" />
                        <br />
                        <br />
                        <label>选择配送员
                          <br>
                          <select class="chosen-select" name="courier_id" id="courier_id">
                            <option value="0">全部</option>
                            {#foreach from=$courierArr item=courier#}
                            <option value="{#$courier.id#}"{#if $courier_id == $courier.id#} selected{#/if#}>{#$courier.name#}</option>
                            {#/foreach#}
                          </select>
                        </label>
                        <br />
                        <div class="span12" style="margin-left: 0;"><button type="submit" class="btn btn-success">查看统计</button></div>
                      </form>
                    </div>
                </div>
                <div class="widget-box" style="margin-top: 20px;">
                  <div class="widget-header">
                    <h5>统计图</h5></div>
                  <div class="widget-body" style="padding:20px;">
                    <div id="chartscontainer"></div>
                  </div>
                </div>
                <div class="">
                  <div class="col-xs-10">
                    <div id="shopList" class="grid-view">
                      <table class="table table-striped table-bordered table-hover">
                        <thead>
                          <tr>
                            <th id="shopList_c0">配送员</th>
                            <th id="shopList_c2">配送成功</th>
                            <th id="shopList_c3">配送失败</th>
                            <th id="shopList_c4">配送费</th>
                            <th id="shopList_c6">配送成功总金额</th>
                            <!-- <th id="shopList_c7">货到付款总金额</th> -->
                            <th id="shopList_c8">余额付款总金额</th>
                            <th id="shopList_c9">在线支付总金额</th>
                          </tr>
                        </thead>
                        <tbody>
                          {#$totalSuccess = 0#}
                          {#$totalFailed = 0#}
                          {#$peisong = 0#}
                          {#$fuwu = 0#}
                          {#$success = 0#}
                          {#$delivery = 0#}
                          {#$money = 0#}
                          {#$online = 0#}

                          {#foreach from=$dataArr item=data#}

                          {#$totalSuccess = $totalSuccess + $data.totalSuccess#}
                          {#$totalFailed = $totalFailed + $data.totalFailed#}
                          {#$peisong = $peisong + $data.peisong#}
                          {#$fuwu = $fuwu + $data.fuwu#}
                          {#$success = $success + $data.success#}
                          <!-- {#$delivery = $delivery + $data.delivery#} -->
                          {#$money = $money + $data.money#}
                          {#$online = $online + $data.online#}
                          <tr>
                            <td style="width: 120px">{#$data.name#}</td>
                            <td>{#$data.totalSuccess#}</td>
                            <td>{#$data.totalFailed#}</td>
                            <td>{#$data.peisong#}</td>
                            <td>{#$data.success#}</td>
                            <!-- <td>{#$data.delivery#}</td> -->
                            <td>{#$data.money#}</td>
                            <td>{#$data.online#}</td>
                          </tr>
                          {#/foreach#}
                          <tr>
                              <td style="width: 120px">总计</td>
                              <td>{#$totalSuccess#}</td>
                              <td>{#$totalFailed#}</td>
                              <td>{#$peisong|string_format:"%.2f"#}</td>
                              <td>{#$success|string_format:"%.2f"#}</td>
                              <!-- <td>{#$delivery|string_format:"%.2f"#}</td> -->
                              <td>{#$money|string_format:"%.2f"#}</td>
                              <td>{#$online|string_format:"%.2f"#}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                  <div class="col-xs-2">
                    <a class="btn btn-success" href="?action={#$action#}&dopost=getresults&do=export&courier_id={#$courier_id#}&beginDate={#$lastMonthDate#}&endDate={#$nowDate#}&cityid={#$cityid#}">导出成excel</a></div>
                </div>
                {#/if#}
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

{#$jsFile#}

{#if $action == "chartrevenue"#}
<script>$(function() {
    $('#chartscontainer').highcharts({
      title: {
        text: '营业额统计',
        x: -20 //center
      },
      xAxis: {
        categories: {#$timeArr#},
        labels: {
          step: 3,
        }
      },
      yAxis: {
        title: {
          text: '营业额（元）'
        },
        plotLines: [{
          value: 0,
          width: 1,
          color: '#808080'
        }]
      },
      tooltip: {
        valueSuffix: '元'
      },
      series: [{
        name: '营业额',
        data: {#$priceArr#}
      }]
    });
  });
</script>
{#elseif $action == "chartorder"#}
<script>$(function() {
    $('#chartscontainer').highcharts({
      title: {
        text: '订单统计',
        x: -20 //center
      },
      xAxis: {
        categories: {#$timeArr#},
        labels: {
          step: 3,
        }
      },
      yAxis: {
        title: {
          text: '订单数（笔）'
        },
        plotLines: [{
          value: 0,
          width: 1,
          color: '#808080'
        }]
      },
      tooltip: {
        valueSuffix: '笔'
      },
      series: [{
        name: '成功订单',
        data: {#$priceArr#}
      }]
    });
  });
</script>
{#elseif $action == "chartcourier"#}
<script>
  $(function() {
    $('#chartscontainer').highcharts({
      title: {
        text: '配送员统计',
        x: -20 //center
      },
      xAxis: {
        categories: {#$timeArr#},
        labels: {
          step: 3,
        }
      },
      yAxis: {
        title: {
          text: '配送数（件）'
        },
        plotLines: [{
          value: 0,
          width: 1,
          color: '#808080'
        }]
      },
      tooltip: {
        valueSuffix: '件'
      },
      series: [{
        name: '配送成功',
        data: {#$priceArr#}
    },{
      name: '配送失败',
      data: {#$failedArr#}
    }]
    });
  });
</script>
{#elseif $action == "productSale"#}
<script type="text/javascript">
$(function(){
  $('#chartscontainer').highcharts({
      chart: {
          type: 'column'
      },
      title: {
          text: '商品销量排行'
      },
      subtitle: {
      },
      // 销量前十名商品名称
      xAxis: {
          categories: {#$saleTitleTop#}
      },
      yAxis: {
          min: 0,
          title: {
              text: '销售量 (份)'
          },

      },
      tooltip: {
          headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
          pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
              '<td style="padding:0"><b>{point.y:.1f} 份</b></td></tr>',
          footerFormat: '</table>',
          shared: true,
          useHTML: true
      },
      plotOptions: {
          column: {
              pointPadding: 0.2,
              borderWidth: 0
          }
      },
  tooltip: {
         valueSuffix: '份'
    },
      series: [{
          name: '销量',
          data: {#$saleSaleTop#}

      }]
  });
});
</script>
{#/if#}
